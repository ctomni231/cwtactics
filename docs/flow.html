<!DOCTYPE html>

<html>
<head>
  <title>flow.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="doc.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ai.html">
                  ai.js
                </a>
              
                
                <a class="source" href="base.html">
                  base.js
                </a>
              
                
                <a class="source" href="commands.html">
                  commands.js
                </a>
              
                
                <a class="source" href="controller.html">
                  controller.js
                </a>
              
                
                <a class="source" href="datatypes.html">
                  datatypes.js
                </a>
              
                
                <a class="source" href="dependencies.html">
                  dependencies.js
                </a>
              
                
                <a class="source" href="flow.html">
                  flow.js
                </a>
              
                
                <a class="source" href="input.html">
                  input.js
                </a>
              
                
                <a class="source" href="loading.html">
                  loading.js
                </a>
              
                
                <a class="source" href="logic.html">
                  logic.js
                </a>
              
                
                <a class="source" href="model.html">
                  model.js
                </a>
              
                
                <a class="source" href="modification.html">
                  modification.js
                </a>
              
                
                <a class="source" href="renderer.html">
                  renderer.js
                </a>
              
                
                <a class="source" href="test.html">
                  test.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>flow.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

cwt.Gameflow.addState({
  id: <span class="hljs-string">"ERROR_SCREEN"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.activeCmd = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.message = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.where = <span class="hljs-literal">null</span>;
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.rendered = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.activeCmd = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.message = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.where = <span class="hljs-literal">null</span>;
  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>
    <span class="hljs-keyword">switch</span> (lastInput) {

      <span class="hljs-keyword">case</span> cwt.Input.TYPE_LEFT:
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.activeCmd &gt; <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">this</span>.activeCmd--;
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.Input.TYPE_RIGHT:
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.activeCmd &lt; <span class="hljs-number">2</span>) {
          <span class="hljs-keyword">this</span>.activeCmd++;
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.Input.TYPE_ACTION :
        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.activeCmd) {

          <span class="hljs-comment">/* Restart */</span>
          <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
            <span class="hljs-keyword">break</span>;

          <span class="hljs-comment">/* Wipe-Out Content and restart*/</span>
          <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            <span class="hljs-keyword">break</span>;

          <span class="hljs-comment">/* Send report and restart */</span>
          <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">break</span>;
    }
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.rendered) {
      <span class="hljs-keyword">var</span> ctxUI = cwt.Screen.layerUI.getContext();
      <span class="hljs-keyword">this</span>.rendered = <span class="hljs-literal">true</span>;
    }
  }
});

cwt.Gameflow.addState({
  id: <span class="hljs-string">"PORTRAIT_SCREEN"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.lastStateId = <span class="hljs-literal">null</span>;
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lastState)</span> {</span>
    <span class="hljs-keyword">this</span>.rendered = <span class="hljs-literal">false</span>;
  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>
    <span class="hljs-keyword">var</span> isLandscape = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>go back to the last state when the device
is back in landscape mode (donâ€™t fire enter
event when changing back to the last state)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isLandscape) {
      cwt.Gameflow.setState(<span class="hljs-keyword">this</span>.lastStateId, <span class="hljs-literal">false</span>);
      <span class="hljs-keyword">this</span>.lastStateId = <span class="hljs-literal">null</span>;
    }
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.rendered) {
      <span class="hljs-keyword">var</span> ctxUI = cwt.Screen.interfaceLayer.getContext();

      cwt.DrawUtil.cleanContext(ctxUI);

      <span class="hljs-keyword">this</span>.rendered = <span class="hljs-literal">true</span>;
    }
  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"LOADING_SCREEN"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.bar = <span class="hljs-keyword">new</span> cwt.LoadingBar(<span class="hljs-number">10</span>, <span class="hljs-built_in">parseInt</span>(cwt.Screen.height / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>) - <span class="hljs-number">10</span>, cwt.Screen.width - <span class="hljs-number">20</span>, <span class="hljs-number">20</span>);
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.done = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">var</span> bar = <span class="hljs-keyword">this</span>.bar;
    cwt.Loading.startProcess(bar, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      bar.setPercentage(<span class="hljs-number">100</span>);
    });
  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.done) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>push event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      (cwt.createModuleCaller(<span class="hljs-string">"$afterLoad"</span>))();

      cwt.Gameflow.changeState(<span class="hljs-string">"START_SCREEN"</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.bar.process === <span class="hljs-number">100</span>) {
      <span class="hljs-keyword">this</span>.done = <span class="hljs-literal">true</span>;
    }
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>
    <span class="hljs-keyword">var</span> ctx = cwt.Screen.layerUI.getContext();

    <span class="hljs-keyword">this</span>.bar.draw(ctx);
  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"NONE"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.backgroundDrawn = <span class="hljs-literal">false</span>;
  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.backgroundDrawn) {
      cwt.Gameflow.changeState(<span class="hljs-string">"LOADING_SCREEN"</span>);
    }
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.backgroundDrawn) {
      <span class="hljs-keyword">var</span> ctx = cwt.Screen.layerBG.getContext();

      ctx.fillStyle = <span class="hljs-string">"grey"</span>;
      ctx.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, cwt.Screen.width, cwt.Screen.height);

      <span class="hljs-keyword">this</span>.backgroundDrawn = <span class="hljs-literal">true</span>;
    }
  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"START_SCREEN"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.TOOLTIP_TIME = <span class="hljs-number">10000</span>;
    <span class="hljs-keyword">this</span>.tooltip_time = <span class="hljs-keyword">this</span>.TOOLTIP_TIME;

    <span class="hljs-comment">/**
     * @type {HTMLCanvasElement|HTMLImageElement|null}
     */</span>
    <span class="hljs-keyword">this</span>.background = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">this</span>.tooltip = <span class="hljs-keyword">new</span> cwt.UIField(
      <span class="hljs-built_in">parseInt</span>(cwt.Screen.width * <span class="hljs-number">0.1</span>, <span class="hljs-number">10</span>),
      <span class="hljs-built_in">parseInt</span>(cwt.Screen.height * <span class="hljs-number">0.2</span>, <span class="hljs-number">10</span>),
      <span class="hljs-built_in">parseInt</span>(cwt.Screen.width * <span class="hljs-number">0.8</span>, <span class="hljs-number">10</span>),
      <span class="hljs-number">120</span>,
      <span class="hljs-string">""</span>,
      <span class="hljs-number">10</span>,
      cwt.UIField.STYLE_NORMAL
    );

    <span class="hljs-keyword">this</span>.button = <span class="hljs-keyword">new</span> cwt.UIField(
      <span class="hljs-built_in">parseInt</span>(cwt.Screen.width * <span class="hljs-number">0.5</span> - <span class="hljs-number">150</span>, <span class="hljs-number">10</span>),
      <span class="hljs-built_in">parseInt</span>(cwt.Screen.height * <span class="hljs-number">0.8</span>, <span class="hljs-number">10</span>) - <span class="hljs-number">20</span>,
      <span class="hljs-number">300</span>,
      <span class="hljs-number">40</span>,
      <span class="hljs-string">"START"</span>,
      <span class="hljs-number">20</span>,
      cwt.UIField.STYLE_NORMAL
    );
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.Screen.layerUI.clear();

    <span class="hljs-keyword">var</span> numBackgrounds = cwt.Image.sprites.BACKGROUNDS.getNumberOfImages();
    <span class="hljs-keyword">var</span> randBGIndex = <span class="hljs-built_in">parseInt</span>(<span class="hljs-built_in">Math</span>.random() * numBackgrounds, <span class="hljs-number">10</span>);

    <span class="hljs-keyword">this</span>.background = cwt.Image.sprites.BACKGROUNDS.getImage(randBGIndex);
  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>action leads into main menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (lastInput &amp;&amp; lastInput.key === cwt.Input.TYPE_ACTION) {
      cwt.Audio.playNullSound();
      cwt.Gameflow.changeState(<span class="hljs-string">"MAIN_MENU"</span>);

    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.tooltip_time += delta;
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tooltip_time &gt;= <span class="hljs-keyword">this</span>.TOOLTIP_TIME) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>update random tooltip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> randEl = cwt.Tooltips[<span class="hljs-built_in">parseInt</span>(<span class="hljs-built_in">Math</span>.random() * cwt.Tooltips.length, <span class="hljs-number">10</span>)];
        <span class="hljs-keyword">this</span>.tooltip.text = cwt.Localization.forKey(randEl);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tooltip.text.search(<span class="hljs-regexp">/\n/</span>) !== -<span class="hljs-number">1</span>) {
          <span class="hljs-keyword">this</span>.tooltip.text = <span class="hljs-keyword">this</span>.tooltip.text.split(<span class="hljs-string">"\n"</span>);
        }

        <span class="hljs-keyword">this</span>.tooltip_time = <span class="hljs-number">0</span>;
      }
    }
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.background) {
      cwt.Screen.layerBG.getContext().drawImage(
        <span class="hljs-keyword">this</span>.background,
        <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,
        cwt.Screen.width,
        cwt.Screen.height
      );

      <span class="hljs-keyword">this</span>.background = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">this</span>.button.draw(cwt.Screen.layerUI.getContext());
    <span class="hljs-keyword">this</span>.tooltip.draw(cwt.Screen.layerUI.getContext());
  }
});

cwt.Gameflow.addMenuState({

  id: <span class="hljs-string">"MAIN_MENU"</span>,

  last: <span class="hljs-string">"START_SCREEN"</span>,

  doLayout: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(layout)</span> {</span>
    <span class="hljs-keyword">var</span> h = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_HEIGHT - <span class="hljs-number">22</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_WIDTH - <span class="hljs-number">16</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);

    layout

      .addRowGap(h)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">16</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAIN_MENU_SKIRMISH"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">20</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"VERSUS"</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">2</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">16</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAIN_MENU_NETWORK"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">20</span>)
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">16</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAIN_MENU_TEST_WEATHER"</span>, cwt.UIField.STYLE_NEW, <span class="hljs-number">20</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"WEATHER"</span>);
      })
      .breakLine()
      .addColGap(w)
      .addButton(<span class="hljs-number">16</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAIN_MENU_TEST_WEATHER"</span>, cwt.UIField.STYLE_ESW, <span class="hljs-number">20</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"RAIN"</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">16</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAIN_MENU_OPTIONS"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">20</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"OPTIONS"</span>);
      });
  }
});
cwt.Gameflow.addMenuState({

  id: <span class="hljs-string">"PARAMETER_SETUP_SCREEN"</span>,
  last: <span class="hljs-string">"PLAYER_SETUP_SCREEN"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(layout)</span> {</span>
    <span class="hljs-keyword">var</span> ENTRIES_PARAMETERS = <span class="hljs-number">6</span>;

    <span class="hljs-keyword">var</span> state = <span class="hljs-keyword">this</span>;

    state.configAttrPage = <span class="hljs-keyword">new</span> cwt.Pagination(cwt.Config.MULTITON_NAMES, ENTRIES_PARAMETERS, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.entries.length; i &lt; e; i++) {
        state.names()[i].text = (<span class="hljs-keyword">this</span>.entries[i]) ? cwt.Localization.forKey(<span class="hljs-keyword">this</span>.entries[i]) : <span class="hljs-string">""</span>;
        state.values()[i].text = (<span class="hljs-keyword">this</span>.entries[i]) ? cwt.Config.getValue(<span class="hljs-keyword">this</span>.entries[i]).toString() : <span class="hljs-string">""</span>;
      }
      state.pageButton().text = <span class="hljs-keyword">this</span>.page.toString();
    });

    state.pageButton = cwt.lazy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">return</span> layout.getButtonByKey(<span class="hljs-string">"PARAMETER_CONFIG_PAGE"</span>);
    });

    state.changeConfigValue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index, left)</span> {</span>
      <span class="hljs-keyword">if</span> (state.configAttrPage.entries[index]) {
        <span class="hljs-keyword">var</span> name = state.configAttrPage.entries[index];
        <span class="hljs-keyword">var</span> cfg = cwt.Config.getConfig(name);

        <span class="hljs-keyword">if</span> (left) {
          cfg.decreaseValue();
        } <span class="hljs-keyword">else</span> {
          cfg.increaseValue();
        }

        state.values()[index].text = cwt.Config.getValue(name).toString();
      }
    };

    state.names = cwt.lazy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">return</span> layout.getButtonsByReg(<span class="hljs-regexp">/(PARAMETER_CONFIG_)(\d+)$/</span>);
    });

    state.values = cwt.lazy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">return</span> layout.getButtonsByReg(<span class="hljs-regexp">/(PARAMETER_CONFIG_)(\d+)(_VALUE)$/</span>);
    });
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.configAttrPage.selectPage(<span class="hljs-number">0</span>);
  },

  doLayout: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(layout)</span> {</span>
    <span class="hljs-keyword">var</span> ENTRIES_PARAMETERS = <span class="hljs-number">6</span>;

    <span class="hljs-keyword">var</span> h = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_HEIGHT - (<span class="hljs-number">8</span> + (ENTRIES_PARAMETERS * <span class="hljs-number">2</span>))) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_WIDTH - <span class="hljs-number">18</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);

    layout
      .addRowGap(h)</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .repeat(ENTRIES_PARAMETERS, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(i)</span> {</span>
        <span class="hljs-keyword">var</span> style1, style2, style3;

        <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) {
          style1 = cwt.UIField.STYLE_NEW;
          style2 = cwt.UIField.STYLE_NW;
          style3 = cwt.UIField.STYLE_NE;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i === ENTRIES_PARAMETERS - <span class="hljs-number">1</span>) {
          style1 = cwt.UIField.STYLE_ESW;
          style2 = cwt.UIField.STYLE_SW;
          style3 = cwt.UIField.STYLE_ES;
        } <span class="hljs-keyword">else</span> {
          style1 = cwt.UIField.STYLE_EW;
          style2 = cwt.UIField.STYLE_W;
          style3 = cwt.UIField.STYLE_E;
        }

        <span class="hljs-keyword">this</span>
          .addColGap(w)
          .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_LEFT"</span>, style1, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.changeConfigValue(i, <span class="hljs-literal">true</span>);
          })
          .addColGap(<span class="hljs-number">1</span>)
          .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PARAMETER_CONFIG_"</span> + i, style2, <span class="hljs-number">8</span>)
          .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PARAMETER_CONFIG_"</span> + i + <span class="hljs-string">"_VALUE"</span>, style3, <span class="hljs-number">8</span>)
          .addColGap(<span class="hljs-number">1</span>)
          .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_RIGHT"</span>, style1, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.changeConfigValue(i, <span class="hljs-literal">false</span>);
          })
          .breakLine()
      })</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w + <span class="hljs-number">6</span>)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_LEFT"</span>, cwt.UIField.STYLE_NSW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.configAttrPage.selectPage(<span class="hljs-keyword">this</span>.configAttrPage.page - <span class="hljs-number">1</span>);
      })
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PARAMETER_CONFIG_PAGE"</span>, cwt.UIField.STYLE_NS, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_RIGHT"</span>, cwt.UIField.STYLE_NES, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.configAttrPage.selectPage(<span class="hljs-keyword">this</span>.configAttrPage.page + <span class="hljs-number">1</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">3</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_BACK"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"PLAYER_SETUP_SCREEN"</span>);
      })
      .addColGap(<span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_NEXT"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_ENTER"</span>);
      })
      .breakLine();
  }
});
cwt.Gameflow.addMenuState({

  id: <span class="hljs-string">"PLAYER_SETUP_SCREEN"</span>,
  last: <span class="hljs-string">"VERSUS"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.GameSelectionDTO.preProcess();
    <span class="hljs-keyword">this</span>.selectSlot(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">this</span>.updateGameModeBtn();
  },

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(layout)</span> {</span>

    <span class="hljs-keyword">var</span> TEAM_IDENTIFIERS = [
      <span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>
    ];

    <span class="hljs-keyword">this</span>.selectedSlot = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">var</span> gameModeBtn;
    <span class="hljs-keyword">var</span> playerNameBtn;
    <span class="hljs-keyword">var</span> playerTeamBtn;
    <span class="hljs-keyword">var</span> playerTypeBtn;
    <span class="hljs-keyword">var</span> playerCo_A_Btn;

    <span class="hljs-keyword">this</span>.updateGameModeBtn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      gameModeBtn.text = (cwt.Gameround.gameMode === cwt.Gameround.GAME_MODE_AW1) ? <span class="hljs-string">"Advance Wars 1"</span> : <span class="hljs-string">"Advance Wars 2"</span>;
    };

    <span class="hljs-keyword">this</span>.selectSlot = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(i)</span> {</span>
      <span class="hljs-keyword">this</span>.selectedSlot = i;
      updateSlotButtons();
    }).bind(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">var</span> updateSlotButtons = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">var</span> i = <span class="hljs-keyword">this</span>.selectedSlot;

      <span class="hljs-keyword">if</span> (cwt.GameSelectionDTO.type[i] === cwt.INACTIVE) {
        playerTypeBtn.text = <span class="hljs-string">"config.player.off"</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cwt.GameSelectionDTO.type[i] === cwt.DESELECT_ID) {
        playerTypeBtn.text = <span class="hljs-string">"config.player.disabled"</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cwt.GameSelectionDTO.type[i] === <span class="hljs-number">0</span>) {
        playerTypeBtn.text = <span class="hljs-string">"config.player.human"</span>;
      } <span class="hljs-keyword">else</span> {
        playerTypeBtn.text = <span class="hljs-string">"config.player.AI"</span>;
      }
      playerTypeBtn.text = cwt.Localization.forKey(playerTypeBtn.text);

      <span class="hljs-keyword">if</span> (cwt.GameSelectionDTO.type[i] === cwt.DESELECT_ID) {
        playerNameBtn.text = <span class="hljs-string">"Slot "</span> + (i + <span class="hljs-number">1</span>);
        playerTeamBtn.text = <span class="hljs-string">""</span>;
        playerCo_A_Btn.text = <span class="hljs-string">""</span>;

      } <span class="hljs-keyword">else</span> {
        playerNameBtn.text = <span class="hljs-string">"Player "</span> + (i + <span class="hljs-number">1</span>);
        playerTeamBtn.text = TEAM_IDENTIFIERS[cwt.GameSelectionDTO.team[i]];

        <span class="hljs-keyword">if</span> (cwt.GameSelectionDTO.co[i] === cwt.INACTIVE) {
          playerCo_A_Btn.text = cwt.Localization.forKey(<span class="hljs-string">"config.player.co.none"</span>);
        } <span class="hljs-keyword">else</span> {
          playerCo_A_Btn.text = cwt.CoSheet.types[cwt.GameSelectionDTO.co[i]];
        }
      }

    }).bind(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">var</span> changeValue = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(type, isPrev)</span> {</span>
      cwt.GameSelectionDTO.changeParameter(<span class="hljs-keyword">this</span>.selectedSlot, type, isPrev);
      updateSlotButtons();
    }).bind(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">var</span> h = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_HEIGHT - <span class="hljs-number">20</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_WIDTH - <span class="hljs-number">18</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);

    layout

      .addRowGap(h)</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_LEFT"</span>, cwt.UIField.STYLE_NSW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        changeValue(cwt.GameSelectionDTO.CHANGE_TYPE.GAME_TYPE, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">this</span>.updateGameModeBtn();

      })
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_GAMEMODE"</span>, cwt.UIField.STYLE_NS, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_GAMEMODE_VALUE"</span>, cwt.UIField.STYLE_NS, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_RIGHT"</span>, cwt.UIField.STYLE_NES, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        changeValue(cwt.GameSelectionDTO.CHANGE_TYPE.GAME_TYPE, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">this</span>.updateGameModeBtn();
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">2</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">""</span>, cwt.UIField.STYLE_NSW, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_SLOT1"</span>, cwt.UIField.STYLE_NS, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.selectSlot(<span class="hljs-number">0</span>);
      })
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_SLOT2"</span>, cwt.UIField.STYLE_NS, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.selectSlot(<span class="hljs-number">1</span>);
      })
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_SLOT3"</span>, cwt.UIField.STYLE_NS, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.selectSlot(<span class="hljs-number">2</span>);
      })
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_SLOT4"</span>, cwt.UIField.STYLE_NS, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.selectSlot(<span class="hljs-number">3</span>);
      })
      .addButton(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">""</span>, cwt.UIField.STYLE_NES, <span class="hljs-number">8</span>)
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">2</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w + <span class="hljs-number">3</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_NAME"</span>, cwt.UIField.STYLE_NW, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_NAME_VALUE"</span>, cwt.UIField.STYLE_NE, <span class="hljs-number">8</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>.addColGap(2)
.addButton(2, 2, 0, â€œMENU_LEFTâ€, cwt.UIField.STYLE_NSW, 8, function () {})
.addButton(2, 2, 0, â€œMENU_RIGHTâ€, cwt.UIField.STYLE_NES, 8, function () {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_LEFT"</span>, cwt.UIField.STYLE_NEW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        changeValue(cwt.GameSelectionDTO.CHANGE_TYPE.PLAYER_TYPE, <span class="hljs-literal">false</span>);
      })
      .addColGap(<span class="hljs-number">1</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_TYPE"</span>, cwt.UIField.STYLE_W, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_TYPE_VALUE"</span>, cwt.UIField.STYLE_E, <span class="hljs-number">8</span>)
      .addColGap(<span class="hljs-number">1</span>)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_RIGHT"</span>, cwt.UIField.STYLE_NEW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        changeValue(cwt.GameSelectionDTO.CHANGE_TYPE.PLAYER_TYPE, <span class="hljs-literal">true</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_LEFT"</span>, cwt.UIField.STYLE_EW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        changeValue(cwt.GameSelectionDTO.CHANGE_TYPE.TEAM, <span class="hljs-literal">false</span>);
      })
      .addColGap(<span class="hljs-number">1</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_TEAM"</span>, cwt.UIField.STYLE_W, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_TEAM_VALUE"</span>, cwt.UIField.STYLE_E, <span class="hljs-number">8</span>)
      .addColGap(<span class="hljs-number">1</span>)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_RIGHT"</span>, cwt.UIField.STYLE_EW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        changeValue(cwt.GameSelectionDTO.CHANGE_TYPE.TEAM, <span class="hljs-literal">true</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_LEFT"</span>, cwt.UIField.STYLE_ESW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        changeValue(cwt.GameSelectionDTO.CHANGE_TYPE.CO_MAIN, <span class="hljs-literal">true</span>);
      })
      .addColGap(<span class="hljs-number">1</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_CO_A"</span>, cwt.UIField.STYLE_SW, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"PLAYER_CONFIG_CO_A_VALUE"</span>, cwt.UIField.STYLE_ES, <span class="hljs-number">8</span>)
      .addColGap(<span class="hljs-number">1</span>)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_RIGHT"</span>, cwt.UIField.STYLE_ESW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        changeValue(cwt.GameSelectionDTO.CHANGE_TYPE.CO_MAIN, <span class="hljs-literal">false</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">2</span>)

      .addColGap(w)
      .addButton(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_BACK"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"VERSUS"</span>);
      })

      .addColGap(<span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_NEXT"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"PARAMETER_SETUP_SCREEN"</span>);
      })
      .breakLine();


    <span class="hljs-keyword">var</span> gameModeBtn = <span class="hljs-keyword">this</span>.gameModeBtn = layout.getButtonByKey(<span class="hljs-string">"PLAYER_CONFIG_GAMEMODE_VALUE"</span>);
    <span class="hljs-keyword">var</span> playerNameBtn = <span class="hljs-keyword">this</span>.playerNameBtn = layout.getButtonByKey(<span class="hljs-string">"PLAYER_CONFIG_NAME_VALUE"</span>);
    <span class="hljs-keyword">var</span> playerTeamBtn = <span class="hljs-keyword">this</span>.playerTeamBtn = layout.getButtonByKey(<span class="hljs-string">"PLAYER_CONFIG_TEAM_VALUE"</span>);
    <span class="hljs-keyword">var</span> playerTypeBtn = <span class="hljs-keyword">this</span>.playerTypeBtn = layout.getButtonByKey(<span class="hljs-string">"PLAYER_CONFIG_TYPE_VALUE"</span>);
    <span class="hljs-keyword">var</span> playerCo_A_Btn = <span class="hljs-keyword">this</span>.playerCo_A_Btn = layout.getButtonByKey(<span class="hljs-string">"PLAYER_CONFIG_CO_A_VALUE"</span>);
  }
});
cwt.Gameflow.addMenuState({

  id: <span class="hljs-string">"VERSUS"</span>,
  last: <span class="hljs-string">"MAIN_MENU"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.selectedMap = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.selectPage(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">this</span>.layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_NAME"</span>).text = <span class="hljs-string">""</span>;
  },

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(layout)</span> {</span>

    <span class="hljs-keyword">var</span> MAP_LIST_SIZE = <span class="hljs-number">7</span>;

    <span class="hljs-keyword">var</span> h = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_HEIGHT - <span class="hljs-number">22</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_WIDTH - <span class="hljs-number">18</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">var</span> state = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> cPage = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">var</span> buttonList;
    <span class="hljs-keyword">var</span> mapList = [
      <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>
    ];

    <span class="hljs-keyword">var</span> selectPage = <span class="hljs-keyword">this</span>.selectPage = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(i)</span> {</span>
      <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span> || (i * MAP_LIST_SIZE) &gt;= cwt.Maps.maps.length) {
        <span class="hljs-keyword">return</span>;
      }

      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_PAGE"</span>).text = (i + <span class="hljs-number">1</span>).toString();

      i = (i * MAP_LIST_SIZE);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; MAP_LIST_SIZE; n++) {
        <span class="hljs-keyword">if</span> (i + n &gt;= cwt.Maps.maps.length) {
          buttonList[n].text = <span class="hljs-string">""</span>;
          mapList[n] = <span class="hljs-literal">null</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">var</span> map = cwt.Maps.maps[i + n];
          buttonList[n].text = map;
          mapList[n] = map;
        }
      }
    };

    <span class="hljs-keyword">var</span> selectMapCallback_ = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> {</span>
      state.selectedMap = obj.value;
      state.rendered = <span class="hljs-literal">false</span>;
      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_NAME"</span>).text = obj.key;
      cwt.Input.releaseBlock();
    };

    <span class="hljs-keyword">var</span> selectMap = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
      <span class="hljs-keyword">if</span> (!mapList[index]) {
        <span class="hljs-keyword">return</span>;
      }

      cwt.Input.requestBlock();
      cwt.Storage.mapStorage.get(mapList[index], selectMapCallback_);
    };

    layout

      .addRowGap(h)</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)

      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PAGE_LEFT"</span>, cwt.UIField.STYLE_NW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      })
      .addButton(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PAGE"</span>, cwt.UIField.STYLE_N, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PAGE_RIGHT"</span>, cwt.UIField.STYLE_NE, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      })

      .addColGap(<span class="hljs-number">4</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_NAME"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>)
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_1"</span>, cwt.UIField.STYLE_EW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        selectMap(<span class="hljs-number">0</span>);
      })

      .addColGap(<span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>map preview canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .addCustomField(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PREVIEW"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ctx)</span> {</span>
        ctx.clearRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y, <span class="hljs-keyword">this</span>.width, <span class="hljs-keyword">this</span>.height);

        <span class="hljs-keyword">if</span> (state.selectedMap) {
          <span class="hljs-keyword">var</span> BASE = (state.selectedMap.mpw &gt;= cwt.MAX_MAP_WIDTH / <span class="hljs-number">2</span>) ? <span class="hljs-number">2</span> : <span class="hljs-number">4</span>;

          <span class="hljs-keyword">var</span> miniMapImg = cwt.Image.sprites.MINIMAP.getImage(
            BASE === <span class="hljs-number">2</span> ? cwt.Sprite.MINIMAP_2x2 : cwt.Sprite.MINIMAP_4x4);

          <span class="hljs-keyword">var</span> map = state.selectedMap.map;
          <span class="hljs-keyword">var</span> typeMap = state.selectedMap.typeMap;
          <span class="hljs-keyword">var</span> xe = state.selectedMap.mpw;
          <span class="hljs-keyword">var</span> ye = state.selectedMap.mph;
          <span class="hljs-keyword">var</span> startX = <span class="hljs-keyword">this</span>.x + <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.width / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>) - <span class="hljs-built_in">parseInt</span>(state.selectedMap.mpw / <span class="hljs-number">2</span> * BASE, <span class="hljs-number">10</span>);
          <span class="hljs-keyword">var</span> startY = <span class="hljs-keyword">this</span>.y + <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.height / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>) - <span class="hljs-built_in">parseInt</span>(state.selectedMap.mph / <span class="hljs-number">2</span> * BASE, <span class="hljs-number">10</span>);

          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; xe; x++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>; y &lt; ye; y++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>3.1. tiles first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> type = typeMap[ map[x][y] ];
              <span class="hljs-keyword">if</span> (cwt.MiniMapIndexes[type] !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {

                ctx.drawImage(
                  miniMapImg,
                  cwt.MiniMapIndexes[type] * BASE, <span class="hljs-number">0</span>,
                  BASE, BASE,
                  startX + (x * BASE),
                  startY + (y * BASE),
                  BASE, BASE
                );

              } <span class="hljs-keyword">else</span> {
                ctx.fillStyle = <span class="hljs-string">"#FF0000"</span>;
                ctx.fillRect(x * BASE, y * BASE, BASE, BASE);
              }

            }
          }
        }
      }, <span class="hljs-literal">true</span>)
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_2"</span>, cwt.UIField.STYLE_EW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        selectMap(<span class="hljs-number">1</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_3"</span>, cwt.UIField.STYLE_EW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        selectMap(<span class="hljs-number">2</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_4"</span>, cwt.UIField.STYLE_EW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        selectMap(<span class="hljs-number">3</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_5"</span>, cwt.UIField.STYLE_EW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        selectMap(<span class="hljs-number">4</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_6"</span>, cwt.UIField.STYLE_EW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        selectMap(<span class="hljs-number">5</span>);
      })
      .addColGap(<span class="hljs-number">1</span>)
      .addCustomField(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PREVIEW_1"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      }, <span class="hljs-literal">true</span>)
      .addCustomField(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PREVIEW_2"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      }, <span class="hljs-literal">true</span>)
      .addCustomField(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PREVIEW_3"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      }, <span class="hljs-literal">true</span>)
      .addCustomField(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PREVIEW_4"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      }, <span class="hljs-literal">true</span>)
      .addCustomField(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_PREVIEW_5"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      }, <span class="hljs-literal">true</span>)
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MAP_SELECT_7"</span>, cwt.UIField.STYLE_ESW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        selectMap(<span class="hljs-number">6</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">2</span>)

      .addColGap(w)
      .addButton(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_BACK"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"MAIN_MENU"</span>);
      })

      .addColGap(<span class="hljs-number">5</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_CONFIGURED_MATCH"</span>, cwt.UIField.STYLE_NEW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.GameSelectionDTO.map = <span class="hljs-keyword">this</span>.selectedMap;
        <span class="hljs-keyword">this</span>.selectedMap = <span class="hljs-literal">null</span>;
        cwt.Gameflow.changeState(<span class="hljs-string">"PLAYER_SETUP_SCREEN"</span>);
      })
      .breakLine()

      .addColGap(w + <span class="hljs-number">10</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"MENU_FAST_MATCH"</span>, cwt.UIField.STYLE_ESW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>cwt.Gameflow.changeState(â€œPLAYER_SETUP_SCREENâ€);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      });

    buttonList = [
      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_1"</span>),
      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_2"</span>),
      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_3"</span>),
      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_4"</span>),
      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_5"</span>),
      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_6"</span>),
      layout.getButtonByKey(<span class="hljs-string">"MAP_SELECT_7"</span>)
    ];
  }
});
cwt.Gameflow.addMenuState({

  id: <span class="hljs-string">"CONFIRM_WIPE_OUT_SCREEN"</span>,

  last: <span class="hljs-string">"OPTIONS"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(layout)</span> {</span>

    <span class="hljs-keyword">var</span> h = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_HEIGHT - <span class="hljs-number">18</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_WIDTH - <span class="hljs-number">16</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);

    layout

      .addRowGap(h)</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w).addButton(<span class="hljs-number">16</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_WIPE_OUT_TEXT"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>)
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">2</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_WIPE_OUT_NO"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"OPTIONS"</span>);
      })
      .addColGap(<span class="hljs-number">4</span>)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_WIPE_OUT_YES"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Storage.wipeOutAll(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
          <span class="hljs-keyword">delete</span> localStorage.cwt_hasCache;
          document.location.reload();
        });
      });
  }
});
cwt.Gameflow.addMenuState({

  id: <span class="hljs-string">"OPTIONS"</span>,
  last: <span class="hljs-string">"MAIN_MENU"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.layout.getButtonByKey(<span class="hljs-string">"OPTIONS_CHECKBOX_FORCE_TOUCH"</span>).checked = cwt.Options.forceTouch;
    <span class="hljs-keyword">this</span>.layout.getButtonByKey(<span class="hljs-string">"OPTIONS_CHECKBOX_ANIMATED_TILES"</span>).checked = cwt.Options.animatedTiles;
    <span class="hljs-keyword">this</span>.layout.getButtonByKey(<span class="hljs-string">"OPTIONS_SFX_VOL"</span>).text = <span class="hljs-built_in">Math</span>.round(cwt.Audio.getSfxVolume() * <span class="hljs-number">100</span>).toString();
    <span class="hljs-keyword">this</span>.layout.getButtonByKey(<span class="hljs-string">"OPTIONS_MUSIC_VOL"</span>).text = <span class="hljs-built_in">Math</span>.round(cwt.Audio.getMusicVolume() * <span class="hljs-number">100</span>).toString();
  },

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(layout)</span> {</span>

    <span class="hljs-keyword">var</span> h = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_HEIGHT - <span class="hljs-number">18</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_WIDTH - <span class="hljs-number">16</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);

    <span class="hljs-keyword">var</span> sfxButton;
    <span class="hljs-keyword">var</span> musicButton;

    <span class="hljs-keyword">var</span> saveStep1 = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      cwt.Audio.saveConfigs(saveStep2);
    };

    <span class="hljs-keyword">var</span> saveStep2 = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      cwt.Gameflow.changeState(<span class="hljs-string">"MAIN_MENU"</span>);
    };

    <span class="hljs-keyword">var</span> updateSound = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(isSFX, change, state)</span> {</span>
      <span class="hljs-keyword">var</span> vol = ((isSFX) ? cwt.Audio.getSfxVolume() : cwt.Audio.getMusicVolume()) + change;
      (isSFX) ? cwt.Audio.setSfxVolume(vol) : cwt.Audio.setMusicVolume(vol);
      ((isSFX) ? sfxButton : musicButton).text = <span class="hljs-built_in">Math</span>.round(vol * <span class="hljs-number">100</span>).toString();
      state.rendered = <span class="hljs-literal">false</span>;
    }

    layout

      .addRowGap(h)</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_SFX_VOL_DOWN"</span>, cwt.UIField.STYLE_NW, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        updateSound(<span class="hljs-literal">true</span>, -<span class="hljs-number">0.05</span>, <span class="hljs-keyword">this</span>);
      })
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_SFX_VOL"</span>, cwt.UIField.STYLE_N, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_SFX_VOL_UP"</span>, cwt.UIField.STYLE_NE, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        updateSound(<span class="hljs-literal">true</span>, +<span class="hljs-number">0.05</span>, <span class="hljs-keyword">this</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_MUSIC_VOL_DOWN"</span>, cwt.UIField.STYLE_SW, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        updateSound(<span class="hljs-literal">false</span>, -<span class="hljs-number">0.05</span>, <span class="hljs-keyword">this</span>);
      })
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_MUSIC_VOL"</span>, cwt.UIField.STYLE_S, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_MUSIC_VOL_UP"</span>, cwt.UIField.STYLE_ES, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        updateSound(<span class="hljs-literal">false</span>, +<span class="hljs-number">0.05</span>, <span class="hljs-keyword">this</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addCheckbox(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_CHECKBOX_ANIMATED_TILES"</span>, cwt.UIField.STYLE_NW)
      .addButton(<span class="hljs-number">14</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_CHECKBOX_ANIMATED_TILES_TEXT"</span>, cwt.UIField.STYLE_NE, <span class="hljs-number">8</span>)
      .breakLine()

      .addColGap(w)
      .addCheckbox(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_CHECKBOX_FORCE_TOUCH"</span>, cwt.UIField.STYLE_SW)
      .addButton(<span class="hljs-number">14</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_CHECKBOX_FORCE_TOUCH_TEXT"</span>, cwt.UIField.STYLE_ES, <span class="hljs-number">8</span>)
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_MENU_CHANGE_KEYBOARD_LAYOUT"</span>, cwt.UIField.STYLE_NSW, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"REMAP_KEY_MAPPING"</span>);
        cwt.Gameflow.activeState.mode = <span class="hljs-number">0</span>;
      })
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_MENU_CHANGE_GAMEPAD_LAYOUT"</span>, cwt.UIField.STYLE_NES, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"REMAP_KEY_MAPPING"</span>);
        cwt.Gameflow.activeState.mode = <span class="hljs-number">1</span>;
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">16</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_MENU_WIPE_OUT"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Gameflow.changeState(<span class="hljs-string">"CONFIRM_WIPE_OUT_SCREEN"</span>);
      })
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_MENU_GO_BACK"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>update options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        cwt.Options.forceTouch = (<span class="hljs-keyword">this</span>.layout.getButtonByKey(<span class="hljs-string">"OPTIONS_CHECKBOX_FORCE_TOUCH"</span>).checked === <span class="hljs-literal">true</span>);
        cwt.Options.animatedTiles = (<span class="hljs-keyword">this</span>.layout.getButtonByKey(<span class="hljs-string">"OPTIONS_CHECKBOX_ANIMATED_TILES"</span>).checked === <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>save options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        cwt.Options.saveOptions(saveStep1);
      });

    sfxButton = layout.getButtonByKey(<span class="hljs-string">"OPTIONS_SFX_VOL"</span>);
    musicButton = layout.getButtonByKey(<span class="hljs-string">"OPTIONS_MUSIC_VOL"</span>);
  }
});
cwt.Gameflow.addMenuState({

  id: <span class="hljs-string">"REMAP_KEY_MAPPING"</span>,
  last: <span class="hljs-string">"OPTIONS"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> map = cwt.Input.types.keyboard.MAPPING;

    <span class="hljs-keyword">this</span>.mappingKeys[<span class="hljs-number">0</span>].text = cwt.Input.codeToChar(map.RIGHT);
    <span class="hljs-keyword">this</span>.mappingKeys[<span class="hljs-number">1</span>].text = cwt.Input.codeToChar(map.LEFT);
    <span class="hljs-keyword">this</span>.mappingKeys[<span class="hljs-number">2</span>].text = cwt.Input.codeToChar(map.DOWN);
    <span class="hljs-keyword">this</span>.mappingKeys[<span class="hljs-number">3</span>].text = cwt.Input.codeToChar(map.UP);
    <span class="hljs-keyword">this</span>.mappingKeys[<span class="hljs-number">4</span>].text = cwt.Input.codeToChar(map.ACTION);
    <span class="hljs-keyword">this</span>.mappingKeys[<span class="hljs-number">5</span>].text = cwt.Input.codeToChar(map.CANCEL);
  },

  genericInput: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(keyCode)</span> {</span>

    <span class="hljs-keyword">var</span> code = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.index) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
        code = <span class="hljs-string">"RIGHT"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        code = <span class="hljs-string">"LEFT"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
        code = <span class="hljs-string">"DOWN"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        code = <span class="hljs-string">"UP"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
        code = <span class="hljs-string">"ACTION"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
        code = <span class="hljs-string">"CANCEL"</span>;
        <span class="hljs-keyword">break</span>;
    }

    cwt.assert(code);</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>set string conversion of code into the field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.mappingKeys[<span class="hljs-keyword">this</span>.index].text = (<span class="hljs-keyword">this</span>.mode === <span class="hljs-number">0</span>) ? cwt.Input.codeToChar(keyCode) : keyCode;
    ((<span class="hljs-keyword">this</span>.mode === <span class="hljs-number">0</span>) ? cwt.Input.types.keyboard.MAPPING : cwt.Input.types.gamePad.MAPPING)[code] = keyCode;</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>invoke re-rendering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.rendered = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>increase index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.index++;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.index &gt;= <span class="hljs-keyword">this</span>.mappingKeys.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>release generic input request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.Input.genericInput = <span class="hljs-literal">false</span>;
    }
  },

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(layout)</span> {</span>
    <span class="hljs-keyword">this</span>.mode = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">var</span> h = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_HEIGHT - <span class="hljs-number">16</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>((cwt.SCREEN_WIDTH - <span class="hljs-number">12</span>) / <span class="hljs-number">2</span>, <span class="hljs-number">10</span>);

    layout

      .addRowGap(h)</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_KEYMAP_RIGHT"</span>, cwt.UIField.STYLE_NW, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"VALUE_R"</span>, cwt.UIField.STYLE_NE, <span class="hljs-number">8</span>)
      .breakLine()

      .addColGap(w)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_KEYMAP_LEFT"</span>, cwt.UIField.STYLE_W, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"VALUE_L"</span>, cwt.UIField.STYLE_E, <span class="hljs-number">8</span>)
      .breakLine()

      .addColGap(w)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_KEYMAP_DOWN"</span>, cwt.UIField.STYLE_W, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"VALUE_D"</span>, cwt.UIField.STYLE_E, <span class="hljs-number">8</span>)
      .breakLine()

      .addColGap(w)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_KEYMAP_UP"</span>, cwt.UIField.STYLE_W, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"VALUE_U"</span>, cwt.UIField.STYLE_E, <span class="hljs-number">8</span>)
      .breakLine()

      .addColGap(w)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_KEYMAP_ACTION"</span>, cwt.UIField.STYLE_W, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"VALUE_A"</span>, cwt.UIField.STYLE_E, <span class="hljs-number">8</span>)
      .breakLine()

      .addColGap(w)
      .addButton(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_KEYMAP_CANCEL"</span>, cwt.UIField.STYLE_SW, <span class="hljs-number">8</span>)
      .addButton(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"VALUE_C"</span>, cwt.UIField.STYLE_ES, <span class="hljs-number">8</span>)
      .breakLine()</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addRowGap(<span class="hljs-number">2</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
      .addColGap(w)
      .addButton(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_KEYMAP_GOBACK"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        cwt.Input.saveKeyMapping();
        cwt.Gameflow.changeState(<span class="hljs-string">"OPTIONS"</span>);
      })
      .addColGap(<span class="hljs-number">2</span>)
      .addButton(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"OPTIONS_KEYMAP_SET"</span>, cwt.UIField.STYLE_NORMAL, <span class="hljs-number">8</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>setup generic input request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        cwt.Input.genericInput = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.index = (<span class="hljs-keyword">this</span>.mode === <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : <span class="hljs-number">4</span>;
      });

    <span class="hljs-keyword">this</span>.mappingKeys = [
      layout.getButtonByKey(<span class="hljs-string">"VALUE_R"</span>),
      layout.getButtonByKey(<span class="hljs-string">"VALUE_L"</span>),
      layout.getButtonByKey(<span class="hljs-string">"VALUE_D"</span>),
      layout.getButtonByKey(<span class="hljs-string">"VALUE_U"</span>),
      layout.getButtonByKey(<span class="hljs-string">"VALUE_A"</span>),
      layout.getButtonByKey(<span class="hljs-string">"VALUE_C"</span>)
    ];
  }
});

cwt.Gameflow.addState({
  id: <span class="hljs-string">"INGAME_ENTER"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.globalData.inGameRound = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (cwt.DEBUG) {
      console.log(<span class="hljs-string">"entering game round"</span>);
    }

    cwt.Cursor.hideNativeCursor();</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <ol>
<li>load map</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cwt.GameData.loadGame(cwt.GameSelectionDTO.map, <span class="hljs-literal">false</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      cwt.GameSelectionDTO.map = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <ol>
<li>change game data by the given configuration</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.GameSelectionDTO.postProcess();
      cwt.Turn.startsTurn_(cwt.Player.getInstance(<span class="hljs-number">0</span>));
      cwt.Fog.fullRecalculation();</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <ol>
<li>update screen</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.Screen.layerUI.clear();
      cwt.TileVariants.updateTileSprites();</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <ol>
<li>render screen</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.MapRenderer.renderScreen();
      cwt.MapRenderer.renderCursor();</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <ol>
<li>start game :P</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_IDLE"</span>);
    });
    <span class="hljs-comment">/*
     controller.commandStack_resetData();

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>start first turn</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>     if (model.round_turnOwner === -1) {
     model.events.gameround_start();
     controller.commandStack_localInvokement("nextTurn_invoked");
     if (controller.network_isHost()) model.events.weather_calculateNext();
     }
     */
  }
});
cwt.Gameflow.addState({
  id: "INGAME_FLUSH_ACTION",

  init: function () {
    var gameData = this.globalData;

    /**
     *
     * @memberOf cwt.Gameflow.globalData
     * @type {boolean}
     */
    gameData.multiStepActive = false;

    /**
     * Builds several commands from collected action data.
     *
     * @memberOf cwt.Gameflow.globalData
     */
    gameData.buildFromData = function () {
      var targetDto = gameData.target;
      var sourceDto = gameData.source;
      var actionDto = gameData.action;
      var moveDto = gameData.movePath;
      var actionObject = actionDto.object;
      var dataBlock = cwt.ActionStack.acquireCommand();

      var trapped = false;
      if (!moveDto.isEmpty()) {
        trapped = cwt.Move.trapCheck(moveDto, sourceDto);
        gameData.buildMoveCommand(sourceDto, moveDto);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>convert action to trapped wait when move path is trapped</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (trapped) {
        actionObject = cwt.Action.getActionObject(<span class="hljs-string">"wait"</span>);
        dataBlock.p2 = <span class="hljs-number">1</span>; <span class="hljs-comment">// mark trapped</span>
      }

      dataBlock.id = cwt.Action.getInstanceId(actionObject);
      actionObject.toDataBlock(gameData, dataBlock);

      cwt.ActionStack.pushCommand(<span class="hljs-literal">false</span>, dataBlock);</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>all unit actions invokes automatically waiting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!trapped &amp;&amp; actionObject.unitAction &amp;&amp; !actionObject.noAutoWait) {
        dataBlock = cwt.ActionStack.acquireCommand();
        cwt.Action.getActionObject(<span class="hljs-string">"wait"</span>).toDataBlock(gameData, dataBlock);
        cwt.ActionStack.pushCommand(<span class="hljs-literal">false</span>, dataBlock);
      }

      <span class="hljs-keyword">return</span> trapped;
    }
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> gameData = <span class="hljs-keyword">this</span>.globalData;
    <span class="hljs-keyword">var</span> trapped = gameData.buildFromData();
    <span class="hljs-keyword">var</span> next = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (!trapped &amp;&amp; gameData.action.object.multiStepAction) {
      gameData.multiStepActive = <span class="hljs-literal">true</span>;

      <span class="hljs-comment">/*
       if( !controller.stateMachine.data.breakMultiStep ){
       controller.stateMachine.event("nextStep");
       } else {
       controller.stateMachine.event("nextStepBreak");
       }
       */</span>

      next = <span class="hljs-string">"INGAME_MULTISTEP_IDLE"</span>;
    } <span class="hljs-keyword">else</span> {
      next = <span class="hljs-string">"INGAME_IDLE"</span>;
    }

    cwt.Gameflow.changeState(next);
  }
});
cwt.Gameflow.addInGameState({
  id: <span class="hljs-string">"INGAME_IDLE"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>

    <span class="hljs-comment">/**
     * Position object with rich information about the selected position by an action and some relations.
     *
     * @memberOf cwt.Gameflow.globalData
     */</span>
    gameData.source = <span class="hljs-keyword">new</span> cwt.Position();

    <span class="hljs-comment">/**
     * Position object with rich information about the selected position by an action and some relations.
     *
     * @memberOf cwt.Gameflow.globalData
     */</span>
    gameData.target = <span class="hljs-keyword">new</span> cwt.Position();

    <span class="hljs-comment">/**
     * Position object with rich information about the selected position by an action and some relations.
     *
     * @memberOf cwt.Gameflow.globalData
     */</span>
    gameData.targetselection = <span class="hljs-keyword">new</span> cwt.Position();

    gameData.focusActive = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">/**
     *
     * @memberOf cwt.Gameflow.globalData
     * @implements cwt.InterfaceSelection
     */</span>
    gameData.selection = {

      <span class="hljs-comment">/** @private */</span>
      len_: cwt.MAX_MOVE_LENGTH * <span class="hljs-number">4</span>,

      <span class="hljs-comment">/** @private */</span>
      data_: <span class="hljs-literal">null</span>,

      <span class="hljs-comment">/** @private */</span>
      centerX_: <span class="hljs-number">0</span>,

      <span class="hljs-comment">/** @private */</span>
      centerY_: <span class="hljs-number">0</span>,

      <span class="hljs-comment">/** @override */</span>
      getData: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.data_;
      },

      <span class="hljs-comment">/** @override */</span>
      getCenterX: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.centerX_;
      },

      <span class="hljs-comment">/** @override */</span>
      getCenterY: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.centerY_;
      },

      <span class="hljs-comment">/** @override */</span>
      setCenter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, defValue)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>lazy initialization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.data_) {
          <span class="hljs-keyword">this</span>.data_ = [];
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.len_; i++) {
            <span class="hljs-keyword">this</span>.data_[i] = [];
          }
        }

        <span class="hljs-keyword">this</span>.centerX = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, x - (<span class="hljs-keyword">this</span>.len_ - <span class="hljs-number">1</span>));
        <span class="hljs-keyword">this</span>.centerY = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, y - (<span class="hljs-keyword">this</span>.len_ - <span class="hljs-number">1</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>clean data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> rx = <span class="hljs-number">0</span>; rx &lt; <span class="hljs-keyword">this</span>.len_; rx++) {
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> ry = <span class="hljs-number">0</span>; ry &lt; <span class="hljs-keyword">this</span>.len_; ry++) {
            <span class="hljs-keyword">this</span>.data_[rx][ry] = defValue;
          }
        }
      },

      <span class="hljs-comment">/** @override */</span>
      getValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y)</span> {</span>
        x = x - <span class="hljs-keyword">this</span>.centerX_;
        y = y - <span class="hljs-keyword">this</span>.centerY_;

        <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || y &lt; <span class="hljs-number">0</span> || x &gt;= <span class="hljs-keyword">this</span>.len_ || y &gt;= <span class="hljs-keyword">this</span>.len_) {
          <span class="hljs-keyword">return</span> cwt.INACTIVE;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.data_[x][y];
        }
      },

      <span class="hljs-comment">/** @override */</span>
      setValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, value)</span> {</span>
        x = x - <span class="hljs-keyword">this</span>.centerX_;
        y = y - <span class="hljs-keyword">this</span>.centerY_;

        <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || y &lt; <span class="hljs-number">0</span> || x &gt;= <span class="hljs-keyword">this</span>.len_ || y &gt;= <span class="hljs-keyword">this</span>.len_) {
          <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Out of Bounds"</span>);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">this</span>.data_[x][y] = value;
        }
      },

      <span class="hljs-comment">/**
       *
       * @param {number} x
       * @param {number} y
       * @return {boolean}
       */</span>
      hasActiveNeighbour: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y)</span> {</span>
        x = x - <span class="hljs-keyword">this</span>.centerX_;
        y = y - <span class="hljs-keyword">this</span>.centerY_;

        <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || y &lt; <span class="hljs-number">0</span> || x &gt;= <span class="hljs-keyword">this</span>.len_ || y &gt;= <span class="hljs-keyword">this</span>.len_) {
          <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Out of Bounds"</span>);
        }

        <span class="hljs-keyword">if</span> ((x &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.data_[x - <span class="hljs-number">1</span>][y] &gt; <span class="hljs-number">0</span>) ||
          (y &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.data_[x][y - <span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>) ||
          (x &lt; <span class="hljs-keyword">this</span>.len_ - <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">this</span>.data_[x + <span class="hljs-number">1</span>][y] &gt; <span class="hljs-number">0</span>) ||
          (y &lt; <span class="hljs-keyword">this</span>.len_ - <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">this</span>.data_[x][y + <span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>)) {

          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      },

      <span class="hljs-comment">/**
       *
       * @param {number} x
       * @param {number} y
       * @param {number} minValue
       * @param {boolean} walkLeft
       * @param {Function} cb
       * @param {*?} arg
       */</span>
      nextValidPosition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, minValue, walkLeft, cb, arg)</span> {</span>
        x = x - <span class="hljs-keyword">this</span>.centerX_;
        y = y - <span class="hljs-keyword">this</span>.centerY_;

        <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || y &lt; <span class="hljs-number">0</span> || x &gt;= <span class="hljs-keyword">this</span>.len_ || y &gt;= <span class="hljs-keyword">this</span>.len_) {
          <span class="hljs-keyword">if</span> (walkLeft) {</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>start bottom right</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            x = <span class="hljs-keyword">this</span>.len_ - <span class="hljs-number">1</span>;
            y = <span class="hljs-keyword">this</span>.len_ - <span class="hljs-number">1</span>;

          } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>start top left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            x = <span class="hljs-number">0</span>;
            y = <span class="hljs-number">0</span>;

          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>walk to the next position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> mod = (walkLeft) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>;
        y += mod;
        <span class="hljs-keyword">for</span> (; (walkLeft) ? x &gt;= <span class="hljs-number">0</span> : x &lt; <span class="hljs-keyword">this</span>.len_; x += mod) {
          <span class="hljs-keyword">for</span> (; (walkLeft) ? y &gt;= <span class="hljs-number">0</span> : y &lt; <span class="hljs-keyword">this</span>.len_; y += mod) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.data_[x][y] &gt;= minValue) {</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>valid position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              cb(x, y, arg);
              <span class="hljs-keyword">return</span>;

            }
          }

          y = (walkLeft) ? <span class="hljs-keyword">this</span>.len_ - <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        }
      },

      <span class="hljs-comment">/**
       *
       * @param {Function} cb
       * @param {*} arg
       * @param {number} minValue
       * @return {boolean}
       */</span>
      nextRandomPosition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(cb, arg, minValue)</span> {</span>
        <span class="hljs-keyword">if</span> (minValue === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
          minValue = <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">var</span> n = <span class="hljs-built_in">parseInt</span>(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-keyword">this</span>.len_, <span class="hljs-number">10</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.len_; x++) {
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>; y &lt; <span class="hljs-keyword">this</span>.len_; y++) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.data_[x][y] &gt;= minValue) {
              n--;

              <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">0</span>) {
                cb(x, y, arg);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
              }
            }
          }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    };
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    gameData.source.clean();
    gameData.target.clean();
    gameData.targetselection.clean();
  },

  ACTION: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">var</span> x = cwt.Cursor.x;
    <span class="hljs-keyword">var</span> y = cwt.Cursor.y;

    gameData.source.set(x, y);
    gameData.target.set(x, y);

    cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_MOVEPATH"</span>);
  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"INGAME_LEAVE"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.globalData.inGameRound = <span class="hljs-literal">false</span>;
    cwt.Cursor.showNativeCursor();
  }
});
cwt.Gameflow.addInGameState({
  id: <span class="hljs-string">"INGAME_MENU"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>create game round data in global data scope</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> gameData = <span class="hljs-keyword">this</span>.globalData;

    <span class="hljs-comment">/**
     * Selected game action.
     *
     * @memberOf cwt.Gameflow.globalData
     */</span>
    gameData.action = {

      <span class="hljs-comment">/**
       * Selected sub action object.
       */</span>
      selectedEntry: <span class="hljs-literal">null</span>,

      <span class="hljs-comment">/**
       * Selected sub action object.
       */</span>
      selectedSubEntry: <span class="hljs-literal">null</span>,

      <span class="hljs-comment">/**
       * Action object that represents the selected action.
       */</span>
      object: <span class="hljs-literal">null</span>
    };

    <span class="hljs-comment">/**
     * Game menu.
     *
     * @memberOf cwt.Gameflow.globalData
     * @implements {cwt.InterfaceMenu.&lt;String&gt;}
     */</span>
    gameData.menu = {

      getSelectedIndex: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.selectedIndex;
      },

      <span class="hljs-comment">/**
       * @type {cwt.CircularBuffer.&lt;String&gt;}
       */</span>
      entries_: <span class="hljs-keyword">new</span> cwt.CircularBuffer(),

      <span class="hljs-comment">/**
       * @type {cwt.CircularBuffer.&lt;boolean&gt;}
       */</span>
      enabled_: <span class="hljs-keyword">new</span> cwt.CircularBuffer(),

      selectedIndex: <span class="hljs-number">0</span>,

      getContent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span>) {
          index = <span class="hljs-keyword">this</span>.selectedIndex;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.entries_.get(index);
      },

      getSize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.enabled_.size;
      },

      <span class="hljs-comment">/**
       *
       * @return {boolean}
       */</span>
      isEnabled: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.enabled_.get(<span class="hljs-keyword">this</span>.selectedIndex) === <span class="hljs-literal">true</span>;
      },

      clean: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.enabled_.clear();
        <span class="hljs-keyword">this</span>.entries_.clear();
        <span class="hljs-keyword">this</span>.selectedIndex = <span class="hljs-number">0</span>;
      },

      addEntry: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(content, enabled)</span> {</span>
        <span class="hljs-keyword">this</span>.entries_.push(content);
        <span class="hljs-keyword">this</span>.enabled_.push(enabled);
      },

      commandKeys_: <span class="hljs-literal">null</span>,

      checkRelation_: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(action, relationList, sMode, stMode)</span> {</span>
        <span class="hljs-keyword">var</span> checkMode;

        <span class="hljs-keyword">switch</span> (relationList[<span class="hljs-number">1</span>]) {
          <span class="hljs-keyword">case</span> <span class="hljs-string">"T"</span> :
            checkMode = sMode;
            <span class="hljs-keyword">break</span>;

          <span class="hljs-keyword">case</span> <span class="hljs-string">"ST"</span> :
            checkMode = stMode;
            <span class="hljs-keyword">break</span>;

          <span class="hljs-keyword">default</span> :
            checkMode = <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> si = <span class="hljs-number">2</span>, se = action.relationToProp.length; si &lt; se; si++) {
          <span class="hljs-keyword">if</span> (action.relationToProp[si] === checkMode) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      },

      <span class="hljs-comment">/**
       * Generates the action menu based on the given position data.
       */</span>
      generate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.commandKeys) {
          <span class="hljs-keyword">this</span>.commandKeys = cwt.Action.getRegisteredNames();
        }

        <span class="hljs-keyword">var</span> st_mode;
        <span class="hljs-keyword">var</span> sst_mode;
        <span class="hljs-keyword">var</span> pr_st_mode;
        <span class="hljs-keyword">var</span> pr_sst_mode;
        <span class="hljs-keyword">var</span> sPos = gameData.source;
        <span class="hljs-keyword">var</span> tPos = gameData.target;
        <span class="hljs-keyword">var</span> tsPos = gameData.targetselection;
        <span class="hljs-keyword">var</span> ChkU = cwt.Relationship.CHECK_UNIT;
        <span class="hljs-keyword">var</span> ChkP = cwt.Relationship.CHECK_PROPERTY;
        <span class="hljs-keyword">var</span> sProp = sPos.property;
        <span class="hljs-keyword">var</span> sUnit = sPos.unit;
        <span class="hljs-keyword">var</span> unitActable = (!(!sUnit || sUnit.owner !== cwt.Gameround.turnOwner || !sUnit.canAct));
        <span class="hljs-keyword">var</span> propertyActable = (!(sUnit || !sProp || sProp.owner !== cwt.Gameround.turnOwner || sProp.type.blocker));
        <span class="hljs-keyword">var</span> mapActable = (!unitActable &amp;&amp; !propertyActable);</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>check_ all game action objects and fill menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.commandKeys.length; i &lt; e; i++) {
          <span class="hljs-keyword">var</span> action = cwt.Action.getActionObject(<span class="hljs-keyword">this</span>.commandKeys[i]);

          <span class="hljs-keyword">switch</span> (action.type) {

            <span class="hljs-keyword">case</span> cwt.Action.CLIENT_ACTION:</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>TODO: ai check</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> (!mapActable || cwt.Player.activeClientPlayer !== cwt.Gameround.turnOwner) {
                <span class="hljs-keyword">continue</span>;
              }
              <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> cwt.Action.PROPERTY_ACTION:
              <span class="hljs-keyword">if</span> (!propertyActable) {
                <span class="hljs-keyword">continue</span>;
              }
              <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> cwt.Action.MAP_ACTION:
              <span class="hljs-keyword">if</span> (!mapActable) {
                <span class="hljs-keyword">continue</span>;
              }
              <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> cwt.Action.UNIT_ACTION:
              <span class="hljs-keyword">if</span> (!unitActable) {
                <span class="hljs-keyword">continue</span>;
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>extract relationships</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> (st_mode === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
                st_mode = cwt.Relationship.getRelationShipTo(sPos, tPos, ChkU, ChkU);
                sst_mode = cwt.Relationship.getRelationShipTo(sPos, tsPos, ChkU, ChkU);
                pr_st_mode = cwt.Relationship.getRelationShipTo(sPos, tPos, ChkU, ChkP);
                pr_sst_mode = cwt.Relationship.getRelationShipTo(sPos, tsPos, ChkU, ChkP);
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>relation to unit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> (action.relation) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.checkRelation_(action, action.relation, st_mode, sst_mode)) {
                  <span class="hljs-keyword">continue</span>;
                }
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>relation to property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> (action.relationToProp) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.checkRelation_(action, action.relationToProp, pr_st_mode, pr_sst_mode)) {
                  <span class="hljs-keyword">continue</span>;
                }
              }
              <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> cwt.Action.ENGINE_ACTION:
              <span class="hljs-keyword">continue</span>;
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>if condition matches then add the entry to the menu list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (action.condition &amp;&amp; action.condition(gameData) !== <span class="hljs-literal">false</span>) {
            gameData.menu.addEntry(<span class="hljs-keyword">this</span>.commandKeys[i], <span class="hljs-literal">true</span>)
          }
        }
      }
    };
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    cwt.Cursor.showNativeCursor();

    gameData.menu.clean();
    gameData.menu.generate();</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>go back when no entries exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!gameData.menu.getSize()) {
      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_IDLE"</span>);
    } <span class="hljs-keyword">else</span> {
      cwt.Screen.layerUI.clear(<span class="hljs-number">0</span>);
      cwt.MapRenderer.prepareMenu(gameData.menu);
      cwt.Screen.layerUI.renderLayer(<span class="hljs-number">0</span>);
    }
  },

  exit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.Cursor.hideNativeCursor();
    cwt.Screen.layerUI.clear(<span class="hljs-number">0</span>);
    cwt.Screen.layerUI.clear();
  },

  inputMove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData, x, y)</span> {</span>
    cwt.MapRenderer.layoutGenericMenu_.updateIndex(x, y);
    gameData.menu.selectedIndex = cwt.MapRenderer.layoutGenericMenu_.selected;
    cwt.MapRenderer.renderMenu(gameData.menu);
    cwt.Screen.layerUI.renderLayer(<span class="hljs-number">0</span>);
  },

  UP: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.MapRenderer.layoutGenericMenu_.handleInput(cwt.Input.TYPE_UP)) {
      gameData.menu.selectedIndex = cwt.MapRenderer.layoutGenericMenu_.selected;
      cwt.MapRenderer.renderMenu(gameData.menu);
      cwt.Screen.layerUI.renderLayer(<span class="hljs-number">0</span>);
    }
  },

  DOWN: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.MapRenderer.layoutGenericMenu_.handleInput(cwt.Input.TYPE_DOWN)) {
      gameData.menu.selectedIndex = cwt.MapRenderer.layoutGenericMenu_.selected;
      cwt.MapRenderer.renderMenu(gameData.menu);
      cwt.Screen.layerUI.renderLayer(<span class="hljs-number">0</span>);
    }
  },

  ACTION: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">var</span> actName = gameData.menu.getContent();
    <span class="hljs-keyword">var</span> actObj = cwt.Action.getActionObject(actName);</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>select action in data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    gameData.action.selectedEntry = actName;
    gameData.action.object = actObj;</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>calculate next state from the given action object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> next = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (actObj.prepareMenu !== <span class="hljs-literal">null</span>) {
      next = <span class="hljs-string">"INGAME_SUBMENU"</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (actObj.isTargetValid !== <span class="hljs-literal">null</span>) {
      next = <span class="hljs-string">"INGAME_SELECT_TILE"</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (actObj.prepareTargets !== <span class="hljs-literal">null</span> &amp;&amp; actObj.targetSelectionType === <span class="hljs-string">"A"</span>) {
      next = <span class="hljs-string">"INGAME_SELECT_TILE_TYPE_A"</span>;
    } <span class="hljs-keyword">else</span> {
      next = <span class="hljs-string">"INGAME_FLUSH_ACTION"</span>;
    }

    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(next);
    cwt.Gameflow.changeState(next);
  },

  CANCEL: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">var</span> unit = gameData.source.unit;
    <span class="hljs-keyword">var</span> next = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (unit &amp;&amp; unit.owner.activeClientPlayer) {</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>unit was selected and it is controlled by the active player, so it means that this unit
is the acting unit -&gt; go back to INGAME_MOVEPATH state without erasing the existing move data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      gameData.preventMovePathGeneration = <span class="hljs-literal">true</span>;
      next = <span class="hljs-string">"INGAME_MOVEPATH"</span>;

    } <span class="hljs-keyword">else</span> {
      next = <span class="hljs-string">"INGAME_IDLE"</span>;
    }

    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(next);
    cwt.Gameflow.changeState(next);
  }
});
cwt.Gameflow.addInGameState({
  id: <span class="hljs-string">"INGAME_MOVEPATH"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> gameData = <span class="hljs-keyword">this</span>.globalData;

    <span class="hljs-comment">/**
     *
     * @type {cwt.CircularBuffer}
     * @memberOf cwt.Gameflow.globalData
     */</span>
    gameData.movePath = <span class="hljs-keyword">new</span> cwt.CircularBuffer(cwt.MAX_MOVE_LENGTH);

    <span class="hljs-comment">/**
     *
     * @type {boolean}
     */</span>
    gameData.preventMovePathGeneration = <span class="hljs-literal">false</span>;

    gameData.buildLoadMoveCommand = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(source, moveDto)</span> {</span>

    };

    gameData.buildUnloadMoveCommand = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(source, moveDto)</span> {</span>

    };</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>TODO: load/unload</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    gameData.buildMoveCommand = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(source, moveDto)</span> {</span>
      gameData.buildMoveCommand_(source, moveDto, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    };

    <span class="hljs-comment">/**
     *
     * @param source
     * @param moveDto
     * @param noFuel
     * @param posSet
     * @private
     */</span>
    gameData.buildMoveCommand_ = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(source, moveDto, noFuel, posSet)</span> {</span>
      <span class="hljs-keyword">var</span> dataBlock;

      dataBlock = cwt.ActionStack.acquireCommand();
      dataBlock.id = cwt.Action.getInstanceId(cwt.Action.getInstance(<span class="hljs-string">"clearMove"</span>));
      cwt.ActionStack.pushCommand(<span class="hljs-literal">false</span>, dataBlock);</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>push codes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = moveDto.size; i &lt; e; i += <span class="hljs-number">5</span>) {
        dataBlock = cwt.ActionStack.acquireCommand();
        dataBlock.id = cwt.Action.getInstanceId(cwt.Action.getInstance(<span class="hljs-string">"pushToMove"</span>));

        <span class="hljs-keyword">if</span> (moveDto.get(i) !== cwt.INACTIVE) dataBlock.p1 = moveDto.get(i);
        <span class="hljs-keyword">if</span> (moveDto.get(i + <span class="hljs-number">1</span>) !== cwt.INACTIVE) dataBlock.p2 = moveDto.get(i + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> (moveDto.get(i + <span class="hljs-number">2</span>) !== cwt.INACTIVE) dataBlock.p3 = moveDto.get(i + <span class="hljs-number">2</span>);
        <span class="hljs-keyword">if</span> (moveDto.get(i + <span class="hljs-number">3</span>) !== cwt.INACTIVE) dataBlock.p4 = moveDto.get(i + <span class="hljs-number">3</span>);
        <span class="hljs-keyword">if</span> (moveDto.get(i + <span class="hljs-number">4</span>) !== cwt.INACTIVE) dataBlock.p5 = moveDto.get(i + <span class="hljs-number">4</span>);

        cwt.ActionStack.pushCommand(<span class="hljs-literal">false</span>, dataBlock);
      }

      dataBlock = cwt.ActionStack.acquireCommand();
      dataBlock.id = cwt.Action.getInstanceId(cwt.Action.getInstance(<span class="hljs-string">"flushMove"</span>));
      dataBlock.p1 = cwt.Unit.getInstanceId(source.unit);
      dataBlock.p2 = source.x;
      dataBlock.p3 = source.y;
      dataBlock.p4 = noFuel;
      dataBlock.p5 = posSet;
      cwt.ActionStack.pushCommand(<span class="hljs-literal">false</span>, dataBlock);
    };
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>when we do back steps in the game flow then we donâ€™t want to recreate an already created move way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (gameData.preventMovePathGeneration) {
      gameData.preventMovePathGeneration = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> breakMove = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (cwt.Gameround.isTurnOwnerObject(gameData.source.unit) &amp;&amp; gameData.source.unit.canAct) {</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>prepare move map and clean way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      gameData.movePath.clear();

      cwt.Move.fillMoveMap(
        gameData.source,
        gameData.selection,
        gameData.source.x,
        gameData.source.y,
        gameData.source.unit
      );</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>go directly into action menu when the unit cannot move</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!gameData.selection.hasActiveNeighbour(gameData.source.x, gameData.source.y)) {
        breakMove = <span class="hljs-literal">true</span>;
      }
    } <span class="hljs-keyword">else</span> {
      breakMove = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">if</span> (breakMove) {
      gameData.focusActive = <span class="hljs-literal">false</span>;
      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_MENU"</span>);
    } <span class="hljs-keyword">else</span> {
      gameData.focusActive = <span class="hljs-literal">true</span>;
      cwt.MapRenderer.renderFocusOnScreen(gameData.selection);
    }
  },

  exit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    gameData.focusActive = <span class="hljs-literal">false</span>;
    cwt.Screen.layerFocus.clearAll();
  },

  ACTION: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">var</span> x = cwt.Cursor.x;
    <span class="hljs-keyword">var</span> y = cwt.Cursor.y;</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>selected tile is not in the selection -&gt; ignore action</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (gameData.selection.getValue(x, y) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> ox = gameData.target.x;
    <span class="hljs-keyword">var</span> oy = gameData.target.y;
    <span class="hljs-keyword">var</span> dis = cwt.Map.getDistance(ox, oy, x, y);

    gameData.target.set(x, y);

    <span class="hljs-keyword">if</span> (dis === <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Try to add the cursor move as code to the move path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.Move.addCodeToMovePath(
        cwt.Move.codeFromAtoB(ox, oy, x, y),
        gameData.movePath,
        gameData.selection,
        x,
        y
      );

    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Generate a complete new path because between the old tile and the new tile is at least another one tile</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.Move.generateMovePath(
        gameData.source.x,
        gameData.source.y,
        x,
        y,
        gameData.selection,
        gameData.movePath
      );
    }

    <span class="hljs-keyword">if</span> (dis === <span class="hljs-number">0</span> || cwt.Options.fastClickMode) {
      cwt.Gameflow.changeState(next);
    }
  },

  CANCEL: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_IDLE"</span>);
  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"INGAME_MULTISTEP_IDLE"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> gameData = <span class="hljs-keyword">this</span>.globalData;

    gameData.inMultiStep = <span class="hljs-literal">false</span>;

    gameData.nextStep = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      gameData.movePath.clean();
      gameData.menu.clean();
      gameData.action.object.prepareMenu(<span class="hljs-keyword">this</span>.data);

      <span class="hljs-keyword">if</span> (!gameData.menu.getSize()) {
        cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_IDLE"</span>);
      }

      gameData.menu.addEntry(<span class="hljs-string">"done"</span>, <span class="hljs-literal">true</span>);
      gameData.inMultiStep = <span class="hljs-literal">true</span>;

      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_SUBMENU"</span>);
    };

    gameData.nextStepBreak = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_IDLE"</span>);
    };
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.globalData.inMultiStep = <span class="hljs-literal">false</span>;
  }
});
cwt.Gameflow.addInGameState({
  id: <span class="hljs-string">"INGAME_SELECT_TILE"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    gameData.targetselection.clean();

    <span class="hljs-comment">/*
     var prepareSelection = this.data.action.object.prepareSelection;
     if (prepareSelection) prepareSelection(this.data);
     else this.data.selectionRange = 1;
     */</span>
  },

  ACTION: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">if</span> (gameData.action.object.isTargetValid(gameData, cwt.Cursor.x, cwt.Cursor.y)) {
      gameData.targetselection.set(cwt.Cursor.x, cwt.Cursor.y);
      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_FLUSH_ACTIONS"</span>);
    }
  },

  CANCEL: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_MENU"</span>);
  }
});
cwt.Gameflow.addInGameState({
  id: <span class="hljs-string">"INGAME_SHOW_ATTACK_RANGE"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>TODO: prepare range
TODO: render range to layer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  },

  exit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.Screen.layerEffects.clear();
  },

  CANCEL: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_IDLE"</span>);
  }
});
cwt.Gameflow.addInGameState({
  id: <span class="hljs-string">"INGAME_SUBMENU"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    gameData.menu.clean();
    gameData.menu.generate();</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>go back when no entries exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!gameData.menu.getSize()) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"sub menu cannot be empty"</span>);
    }
  },

  ACTION: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">if</span> (gameData.menu.isEnabled()) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> actName = gameData.menu.getContent();

    <span class="hljs-keyword">if</span> (actName === <span class="hljs-string">"done"</span>) {
      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_IDLE"</span>);
      <span class="hljs-keyword">return</span>;
    }

    gameData.action.selectedSubEntry = actName;
    <span class="hljs-keyword">var</span> actObj = cwt.Action.getActionObject(actName);

    <span class="hljs-keyword">var</span> next = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (actObj.prepareTargets &amp;&amp; actObj.targetSelectionType === <span class="hljs-string">"B"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>return this.data.selection.prepare();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    } <span class="hljs-keyword">else</span> {
      next = <span class="hljs-string">"INGAME_FLUSH_ACTIONS"</span>;
    }

    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(next);
    cwt.Gameflow.changeState(next);
  },

  CANCEL: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_MENU"</span>);
  }
});
cwt.Gameflow.addInGameState({
  id: <span class="hljs-string">"INGAME_SELECT_TILE_TYPE_A"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    gameData.targetselection.clean();
  },

  ACTION: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">if</span> (gameData.selection.getValue(cwt.Cursor.x, cwt.Cursor.y) &gt;= <span class="hljs-number">0</span>) {
      gameData.targetselection.set(cwt.Cursor.x, cwt.Cursor.y);
      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_FLUSH_ACTIONS"</span>);
    }
  },

  CANCEL: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_MENU"</span>);
  }
});
cwt.Gameflow.addInGameState({
  id: <span class="hljs-string">"INGAME_SELECT_TILE_TYPE_B"</span>,

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    gameData.targetselection.clean();
  },

  ACTION: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    <span class="hljs-keyword">if</span> (gameData.selection.getValue(cwt.Cursor.x, cwt.Cursor.y) &gt;= <span class="hljs-number">0</span>) {
      gameData.targetselection.set(cwt.Cursor.x, cwt.Cursor.y);
      cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_FLUSH_ACTIONS"</span>);
    }
  },

  CANCEL: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(gameData)</span> {</span>
    cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_MENU"</span>);
  }
});

cwt.Gameflow.addState({
  id: <span class="hljs-string">"ANIMATION_BALLISTIC"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>

  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>

  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"ANIMATION_CAPTURE_PROPERTY"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>

  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>

  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"ANIMATION_CHANGE_WEATHER"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>

  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>

  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"ANIMATION_DESTROY_UNIT"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>

  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>

  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"ANIMATION_MOVE"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>

  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>

  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"ANIMATION_NEXT_TURN"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.state = -<span class="hljs-number">1</span>;
  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.state = <span class="hljs-number">99</span>;
  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.state) {</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>render bottom line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>render text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>load and play co music</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
        <span class="hljs-keyword">var</span> co = cwt.Gameround.turnOwner.coA;
        <span class="hljs-keyword">if</span> (co) {
          cwt.Audio.playMusic(co.music);
          <span class="hljs-keyword">this</span>.state++;
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        <span class="hljs-keyword">if</span> (!cwt.Audio.currentMusic_.inLoadProcess) {
          <span class="hljs-keyword">this</span>.state++;
        }
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>hide both</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>go into idle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-number">99</span>:
        cwt.Gameflow.changeState(<span class="hljs-string">"INGAME_IDLE"</span>);
        <span class="hljs-keyword">break</span>;
    }
  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.state) {</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>render bottom line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>render text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>hide both</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
        <span class="hljs-keyword">break</span>;
    }
  }
});
cwt.Gameflow.addState({
  id: <span class="hljs-string">"ANIMATION_TRAPPED"</span>,

  init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  enter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

  },

  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta, lastInput)</span> {</span>

  },

  render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>

  }
});

<span class="hljs-comment">/*
 util.scoped(function(){

 var expl_img;
 var rocket_img;
 var rocket_img_inv;

 function renderSmoke( x,y, step, distance ){
 step -= (distance-1);
 if( step &lt; 0 || step &gt; 9 ) return;

 var tileSize = TILE_LENGTH;
 var scx = 48*step;
 var scy = 0;
 var scw = 48;
 var sch = 48;
 var tcx = (x)*tileSize;
 var tcy = (y)*tileSize;
 var tcw = tileSize;
 var tch = tileSize;

 view.canvasCtx.drawImage(
 expl_img,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );

 view.redraw_markPos(x,y);
 }

 function checkStatus( x,y ){
 if( model.map_isValidPosition(x,y) ){
 var unit = model.unit_posData[x][y];
 if( unit !== null ){
 controller.updateUnitStatus( model.unit_extractId(unit) );
 }
 }
 }

 view.registerAnimationHook({
 key: "rocketFly",

 prepare: function( x,y, tx,ty,siloId ){
 if( !rocket_img ) rocket_img = view.getInfoImageForType("FLYING_ROCKET");
 if( !rocket_img_inv ) rocket_img_inv = view.getInfoImageForType("FLYING_ROCKET_INV");

 this.siloX   = controller.getCanvasPosX(x);
 this.siloY   = controller.getCanvasPosY(y);
 this.targetX = controller.getCanvasPosX(tx);
 this.targetY = controller.getCanvasPosY(ty);
 this.curX    = this.siloX;
 this.curY    = this.siloY;
 this.phase = 0;
 },

 render: function(){
 var tileSize = TILE_LENGTH;
 var scx = 0;
 var scy = 0;
 var scw = 24;
 var sch = 24;
 var tcx = this.curX;
 var tcy = this.curY;
 var tcw = tileSize +8;
 var tch = tileSize +8;

 if( tcy &lt; 0 ){
 scw += tcy;
 scy -= tcy;
 tcy = 0;
 }

 view.canvasCtx.drawImage(
 (this.phase===0)? rocket_img : rocket_img_inv,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );

 view.redraw_markPosWithNeighboursRing(
 parseInt(this.curX/TILE_LENGTH, 10),
 parseInt(this.curY/TILE_LENGTH, 10)
 );
 },

 update: function( delta ){
 var shift = ( delta/1000 ) * ( TILE_LENGTH*14);

 if( this.phase === 0 ){

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>rocket flies up</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">this</span>.curY -= shift;

 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.curY &lt;= <span class="hljs-number">0</span> ){</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>controller.setScreenPosition( this.targetX, this.targetY, true );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
 <span class="hljs-keyword">this</span>.curX = <span class="hljs-keyword">this</span>.targetX;
 <span class="hljs-keyword">this</span>.curY = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.phase = <span class="hljs-number">1</span>;
 }
 }
 <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>rocket flies down</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">this</span>.curY += shift;

 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.curY &gt;= <span class="hljs-keyword">this</span>.targetY ){
 <span class="hljs-keyword">this</span>.phase = <span class="hljs-number">2</span>;
 }
 }
 },

 isDone: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
 <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.phase === <span class="hljs-number">2</span>);
 }
 });

 view.registerAnimationHook({

 key: <span class="hljs-string">"explode_invoked"</span>,

 prepare: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( tx,ty, range, damage, owner )</span>{</span>
 <span class="hljs-keyword">if</span>( !expl_img ) expl_img = view.getInfoImageForType(<span class="hljs-string">"EXPLOSION_GROUND"</span>);
 controller.audio_playSound(<span class="hljs-string">"ROCKET_IMPACT"</span>);

 <span class="hljs-keyword">this</span>.x = tx;
 <span class="hljs-keyword">this</span>.y = ty;
 <span class="hljs-keyword">this</span>.range = range;
 <span class="hljs-keyword">this</span>.maxStep = <span class="hljs-number">10</span>+range+<span class="hljs-number">1</span>;
 <span class="hljs-keyword">this</span>.step = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.time = <span class="hljs-number">0</span>;
 },

 render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
 model.map_doInRange( <span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y, <span class="hljs-keyword">this</span>.range, renderSmoke, <span class="hljs-keyword">this</span>.step );
 },

 update: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( delta )</span>{</span>
 <span class="hljs-keyword">this</span>.time += delta;
 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.time &gt; <span class="hljs-number">75</span> ){
 <span class="hljs-keyword">this</span>.step++;
 <span class="hljs-keyword">this</span>.time = <span class="hljs-number">0</span>;
 }
 },

 isDone: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
 <span class="hljs-keyword">var</span> done = <span class="hljs-keyword">this</span>.step === <span class="hljs-keyword">this</span>.maxStep;</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>RENDER HP LOST</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">if</span>( done ) model.map_doInRange( <span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y, <span class="hljs-keyword">this</span>.range, checkStatus );

 <span class="hljs-keyword">return</span> done;
 }

 });

 view.registerAnimationHook({

 key: <span class="hljs-string">"bombs_fireCannon"</span>,

 prepare: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( ox,oy,x,y,tp )</span>{</span>
 <span class="hljs-keyword">var</span> type = model.data_tileSheets[tp];

 <span class="hljs-keyword">var</span> fireAnim = type.assets.fireAnimation;
 cwt.assert( fireAnim.length === <span class="hljs-number">5</span> );

 <span class="hljs-keyword">this</span>.pic     = view.getInfoImageForType(fireAnim[<span class="hljs-number">0</span>]);
 <span class="hljs-keyword">this</span>.sizeX   = fireAnim[<span class="hljs-number">1</span>];
 <span class="hljs-keyword">this</span>.sizeY   = fireAnim[<span class="hljs-number">2</span>];
 <span class="hljs-keyword">this</span>.offsetX = fireAnim[<span class="hljs-number">3</span>];
 <span class="hljs-keyword">this</span>.offsetY = fireAnim[<span class="hljs-number">4</span>];

 <span class="hljs-keyword">this</span>.curX    = ox;
 <span class="hljs-keyword">this</span>.curY    = oy;

 <span class="hljs-keyword">this</span>.step    = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.time    = <span class="hljs-number">0</span>;

 controller.audio_playSound( type.assets.fireSound);
 },

 render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
 <span class="hljs-keyword">var</span> tileSize = TILE_LENGTH;
 <span class="hljs-keyword">var</span> scx = <span class="hljs-keyword">this</span>.sizeX*<span class="hljs-keyword">this</span>.step;
 <span class="hljs-keyword">var</span> scy = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">var</span> scw = <span class="hljs-keyword">this</span>.sizeX;
 <span class="hljs-keyword">var</span> sch = <span class="hljs-keyword">this</span>.sizeY;
 <span class="hljs-keyword">var</span> tcx = (<span class="hljs-keyword">this</span>.curX)*tileSize + <span class="hljs-keyword">this</span>.offsetX;
 <span class="hljs-keyword">var</span> tcy = (<span class="hljs-keyword">this</span>.curY)*tileSize + <span class="hljs-keyword">this</span>.offsetY;
 <span class="hljs-keyword">var</span> tcw = <span class="hljs-keyword">this</span>.sizeX;
 <span class="hljs-keyword">var</span> tch = <span class="hljs-keyword">this</span>.sizeY;

 view.canvasCtx.drawImage(
 <span class="hljs-keyword">this</span>.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );

 },

 update: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( delta )</span>{</span>
 <span class="hljs-keyword">this</span>.time += delta;
 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.time &gt; <span class="hljs-number">100</span> ){
 <span class="hljs-keyword">this</span>.step++;
 <span class="hljs-keyword">this</span>.time = <span class="hljs-number">0</span>;
 }
 },

 isDone: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
 <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.step === <span class="hljs-number">6</span>;
 }

 });

 view.registerAnimationHook({

 key: <span class="hljs-string">"bombs_fireLaser"</span>,

 prepare: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( ox,oy )</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>var type = model.data_tileSheets[tp];</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">var</span> type = model.property_posMap[ox][oy].type;

 <span class="hljs-keyword">var</span> fireAnimA = type.assets.chargeAnimation;
 <span class="hljs-keyword">var</span> fireAnimB = type.assets.fireAnimation;
 <span class="hljs-keyword">var</span> fireAnimC = type.assets.streamAnimation;
 cwt.assert( fireAnimA.length === <span class="hljs-number">5</span> );
 cwt.assert( fireAnimB.length === <span class="hljs-number">5</span> );
 cwt.assert( fireAnimC.length === <span class="hljs-number">5</span> );
 <span class="hljs-keyword">this</span>.a      = {
 pic     : view.getInfoImageForType(fireAnimA[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimB[<span class="hljs-number">1</span>],
 sizeY   : fireAnimB[<span class="hljs-number">2</span>],
 offsetX : fireAnimB[<span class="hljs-number">3</span>],
 offsetY : fireAnimB[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.b      = {
 pic     : view.getInfoImageForType(fireAnimB[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimA[<span class="hljs-number">1</span>],
 sizeY   : fireAnimA[<span class="hljs-number">2</span>],
 offsetX : fireAnimA[<span class="hljs-number">3</span>],
 offsetY : fireAnimA[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.c      = {
 pic     : view.getInfoImageForType(fireAnimC[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimC[<span class="hljs-number">1</span>],
 sizeY   : fireAnimC[<span class="hljs-number">2</span>],
 offsetX : fireAnimC[<span class="hljs-number">3</span>],
 offsetY : fireAnimC[<span class="hljs-number">4</span>]
 };</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>W</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> fireAnimA = type.assets.chargeAnimation3;
 fireAnimB = type.assets.fireAnimation3;
 fireAnimC = type.assets.streamAnimation3;
 cwt.assert( fireAnimA.length === <span class="hljs-number">5</span> );
 cwt.assert( fireAnimB.length === <span class="hljs-number">5</span> );
 cwt.assert( fireAnimC.length === <span class="hljs-number">5</span> );

 <span class="hljs-keyword">this</span>.a2      = {
 pic     : view.getInfoImageForType(fireAnimA[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimB[<span class="hljs-number">1</span>],
 sizeY   : fireAnimB[<span class="hljs-number">2</span>],
 offsetX : fireAnimB[<span class="hljs-number">3</span>],
 offsetY : fireAnimB[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.b2      = {
 pic     : view.getInfoImageForType(fireAnimB[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimA[<span class="hljs-number">1</span>],
 sizeY   : fireAnimA[<span class="hljs-number">2</span>],
 offsetX : fireAnimA[<span class="hljs-number">3</span>],
 offsetY : fireAnimA[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.c2      = {
 pic     : view.getInfoImageForType(fireAnimC[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimC[<span class="hljs-number">1</span>],
 sizeY   : fireAnimC[<span class="hljs-number">2</span>],
 offsetX : fireAnimC[<span class="hljs-number">3</span>],
 offsetY : fireAnimC[<span class="hljs-number">4</span>]
 };</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>S</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> fireAnimA = type.assets.chargeAnimation2;
 fireAnimB = type.assets.fireAnimation2;
 fireAnimC = type.assets.streamAnimation2;
 cwt.assert( fireAnimA.length === <span class="hljs-number">5</span> );
 cwt.assert( fireAnimB.length === <span class="hljs-number">5</span> );
 cwt.assert( fireAnimC.length === <span class="hljs-number">5</span> );

 <span class="hljs-keyword">this</span>.a3      = {
 pic     : view.getInfoImageForType(fireAnimA[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimB[<span class="hljs-number">1</span>],
 sizeY   : fireAnimB[<span class="hljs-number">2</span>],
 offsetX : fireAnimB[<span class="hljs-number">3</span>],
 offsetY : fireAnimB[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.b3      = {
 pic     : view.getInfoImageForType(fireAnimB[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimA[<span class="hljs-number">1</span>],
 sizeY   : fireAnimA[<span class="hljs-number">2</span>],
 offsetX : fireAnimA[<span class="hljs-number">3</span>],
 offsetY : fireAnimA[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.c3      = {
 pic     : view.getInfoImageForType(fireAnimC[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimC[<span class="hljs-number">1</span>],
 sizeY   : fireAnimC[<span class="hljs-number">2</span>],
 offsetX : fireAnimC[<span class="hljs-number">3</span>],
 offsetY : fireAnimC[<span class="hljs-number">4</span>]
 };</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>N</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> fireAnimA = type.assets.chargeAnimation4;
 fireAnimB = type.assets.fireAnimation4;
 fireAnimC = type.assets.streamAnimation4;
 cwt.assert( fireAnimA.length === <span class="hljs-number">5</span> );
 cwt.assert( fireAnimB.length === <span class="hljs-number">5</span> );
 cwt.assert( fireAnimC.length === <span class="hljs-number">5</span> );

 <span class="hljs-keyword">this</span>.a4      = {
 pic     : view.getInfoImageForType(fireAnimA[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimB[<span class="hljs-number">1</span>],
 sizeY   : fireAnimB[<span class="hljs-number">2</span>],
 offsetX : fireAnimB[<span class="hljs-number">3</span>],
 offsetY : fireAnimB[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.b4      = {
 pic     : view.getInfoImageForType(fireAnimB[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimA[<span class="hljs-number">1</span>],
 sizeY   : fireAnimA[<span class="hljs-number">2</span>],
 offsetX : fireAnimA[<span class="hljs-number">3</span>],
 offsetY : fireAnimA[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.c4      = {
 pic     : view.getInfoImageForType(fireAnimC[<span class="hljs-number">0</span>]),
 sizeX   : fireAnimC[<span class="hljs-number">1</span>],
 sizeY   : fireAnimC[<span class="hljs-number">2</span>],
 offsetX : fireAnimC[<span class="hljs-number">3</span>],
 offsetY : fireAnimC[<span class="hljs-number">4</span>]
 };

 <span class="hljs-keyword">this</span>.curX    = ox;
 <span class="hljs-keyword">this</span>.curY    = oy;

 <span class="hljs-keyword">this</span>.phase   = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.step    = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.time    = <span class="hljs-number">0</span>;

 controller.audio_playSound( type.assets.fireSound );
 },

 render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
 <span class="hljs-keyword">var</span> data = (<span class="hljs-keyword">this</span>.phase === <span class="hljs-number">0</span>)? <span class="hljs-keyword">this</span>.a : <span class="hljs-keyword">this</span>.b;
 <span class="hljs-keyword">var</span> data2 = (<span class="hljs-keyword">this</span>.phase === <span class="hljs-number">0</span>)? <span class="hljs-keyword">this</span>.a2 : <span class="hljs-keyword">this</span>.b2;
 <span class="hljs-keyword">var</span> data3 = (<span class="hljs-keyword">this</span>.phase === <span class="hljs-number">0</span>)? <span class="hljs-keyword">this</span>.a3 : <span class="hljs-keyword">this</span>.b3;
 <span class="hljs-keyword">var</span> data4 = (<span class="hljs-keyword">this</span>.phase === <span class="hljs-number">0</span>)? <span class="hljs-keyword">this</span>.a4 : <span class="hljs-keyword">this</span>.b4;</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>E</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">var</span> tileSize = TILE_LENGTH;
 <span class="hljs-keyword">var</span> scx = data.sizeX*<span class="hljs-keyword">this</span>.step;
 <span class="hljs-keyword">var</span> scy = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">var</span> scw = data.sizeX;
 <span class="hljs-keyword">var</span> sch = data.sizeY;
 <span class="hljs-keyword">var</span> tcx = (<span class="hljs-keyword">this</span>.curX)*tileSize + data.offsetX;
 <span class="hljs-keyword">var</span> tcy = (<span class="hljs-keyword">this</span>.curY)*tileSize + data.offsetY;
 <span class="hljs-keyword">var</span> tcw = data.sizeX;
 <span class="hljs-keyword">var</span> tch = data.sizeY;
 view.canvasCtx.drawImage(
 data.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>W</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> tileSize = TILE_LENGTH;
 scx = data2.sizeX*<span class="hljs-keyword">this</span>.step;
 scy = <span class="hljs-number">0</span>;
 scw = data2.sizeX;
 sch = data2.sizeY;
 tcx = (<span class="hljs-keyword">this</span>.curX)*tileSize + data2.offsetX;
 tcy = (<span class="hljs-keyword">this</span>.curY)*tileSize + data2.offsetY;
 tcw = data2.sizeX;
 tch = data2.sizeY;
 view.canvasCtx.drawImage(
 data2.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>S</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> tileSize = TILE_LENGTH;
 scx = data3.sizeX*<span class="hljs-keyword">this</span>.step;
 scy = <span class="hljs-number">0</span>;
 scw = data3.sizeX;
 sch = data3.sizeY;
 tcx = (<span class="hljs-keyword">this</span>.curX)*tileSize + data3.offsetX;
 tcy = (<span class="hljs-keyword">this</span>.curY)*tileSize + data3.offsetY;
 tcw = data3.sizeX;
 tch = data3.sizeY;
 view.canvasCtx.drawImage(
 data3.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>N</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> tileSize = TILE_LENGTH;
 scx = data4.sizeX*<span class="hljs-keyword">this</span>.step;
 scy = <span class="hljs-number">0</span>;
 scw = data4.sizeX;
 sch = data4.sizeY;
 tcx = (<span class="hljs-keyword">this</span>.curX)*tileSize + data4.offsetX;
 tcy = (<span class="hljs-keyword">this</span>.curY)*tileSize + data4.offsetY;
 tcw = data4.sizeX;
 tch = data4.sizeY;
 view.canvasCtx.drawImage(
 data4.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>redraw</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> view.redraw_markPosWithNeighboursRing(<span class="hljs-keyword">this</span>.curX, <span class="hljs-keyword">this</span>.curY);</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>TODO: streched over all tiles in the cross</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">if</span>( data === <span class="hljs-keyword">this</span>.b ){
 data = <span class="hljs-keyword">this</span>.c;
 data2 = <span class="hljs-keyword">this</span>.c2;
 data3 = <span class="hljs-keyword">this</span>.c3;
 data4 = <span class="hljs-keyword">this</span>.c4;</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>E</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> scx = data.sizeX*<span class="hljs-keyword">this</span>.step;
 scy = <span class="hljs-number">0</span>;
 scw = data.sizeX;
 sch = data.sizeY;
 <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> ci = <span class="hljs-keyword">this</span>.curX+<span class="hljs-number">1</span>, ce=model.map_width; ci &lt; ce; ci++ ){
 tcx = (ci)*tileSize + data.offsetX;
 tcy = (<span class="hljs-keyword">this</span>.curY)*tileSize + data.offsetY;
 tcw = data.sizeX;
 tch = data.sizeY;

 view.canvasCtx.drawImage(
 data.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );

 view.redraw_markPos( ci, <span class="hljs-keyword">this</span>.curY-<span class="hljs-number">1</span> );
 view.redraw_markPos( ci, <span class="hljs-keyword">this</span>.curY );
 view.redraw_markPos( ci, <span class="hljs-keyword">this</span>.curY+<span class="hljs-number">1</span> );
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>W</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> scx = data2.sizeX*<span class="hljs-keyword">this</span>.step;
 scy = <span class="hljs-number">0</span>;
 scw = data2.sizeX;
 sch = data2.sizeY;
 <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> ci = <span class="hljs-keyword">this</span>.curX-<span class="hljs-number">1</span>, ce=<span class="hljs-number">0</span>; ci &gt;= ce; ci-- ){
 tcx = (ci)*tileSize + data2.offsetX;
 tcy = (<span class="hljs-keyword">this</span>.curY)*tileSize + data2.offsetY;
 tcw = data2.sizeX;
 tch = data2.sizeY;

 view.canvasCtx.drawImage(
 data2.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );

 view.redraw_markPos( ci, <span class="hljs-keyword">this</span>.curY-<span class="hljs-number">1</span> );
 view.redraw_markPos( ci, <span class="hljs-keyword">this</span>.curY );
 view.redraw_markPos( ci, <span class="hljs-keyword">this</span>.curY+<span class="hljs-number">1</span> );
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>S</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> scx = data3.sizeX*<span class="hljs-keyword">this</span>.step;
 scy = <span class="hljs-number">0</span>;
 scw = data3.sizeX;
 sch = data3.sizeY;
 <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> ci = <span class="hljs-keyword">this</span>.curY+<span class="hljs-number">1</span>, ce=model.map_height; ci &lt; ce; ci++ ){
 tcx = (<span class="hljs-keyword">this</span>.curX)*tileSize + data3.offsetX;
 tcy = (ci)*tileSize + data3.offsetY;
 tcw = data3.sizeX;
 tch = data3.sizeY;

 view.canvasCtx.drawImage(
 data3.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );

 view.redraw_markPos( <span class="hljs-keyword">this</span>.curX+<span class="hljs-number">1</span>,ci );
 view.redraw_markPos( <span class="hljs-keyword">this</span>.curX,ci );
 view.redraw_markPos( <span class="hljs-keyword">this</span>.curX-<span class="hljs-number">1</span>,ci);
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>N</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> scx = data4.sizeX*<span class="hljs-keyword">this</span>.step;
 scy = <span class="hljs-number">0</span>;
 scw = data4.sizeX;
 sch = data4.sizeY;
 <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> ci = <span class="hljs-keyword">this</span>.curY-<span class="hljs-number">1</span>, ce=<span class="hljs-number">0</span>; ci &gt;= <span class="hljs-number">0</span>; ci-- ){
 tcx = (<span class="hljs-keyword">this</span>.curX)*tileSize + data4.offsetX;
 tcy = (ci)*tileSize + data4.offsetY;
 tcw = data4.sizeX;
 tch = data4.sizeY;

 view.canvasCtx.drawImage(
 data4.pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );

 view.redraw_markPos( <span class="hljs-keyword">this</span>.curX+<span class="hljs-number">1</span>,ci );
 view.redraw_markPos( <span class="hljs-keyword">this</span>.curX,ci );
 view.redraw_markPos( <span class="hljs-keyword">this</span>.curX-<span class="hljs-number">1</span>,ci );
 }
 }
 },

 update: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( delta )</span>{</span>
 <span class="hljs-keyword">this</span>.time += delta;
 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.time &gt; <span class="hljs-number">100</span> ){
 <span class="hljs-keyword">this</span>.step++;
 <span class="hljs-keyword">this</span>.time = <span class="hljs-number">0</span>;

 <span class="hljs-keyword">switch</span>( <span class="hljs-keyword">this</span>.phase ){</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>charge phase</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.step === <span class="hljs-number">10</span> ){
 <span class="hljs-keyword">this</span>.step = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.phase++;
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>fire phase</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> case 1:
 if( this.step === 12 ){
 this.step = 0;
 this.phase++;
 }
 }
 }
 },

 isDone: function(){
 return this.phase === 2;
 }

 });

 });

 */
/*
 view.registerAnimationHook({

 key: "capture_invoked",

 prepare: function( prid, cid ){
 controller.updateUnitStatus( cid );

 var property = model.property_data[ prid ];
 if( model.fog_clientData[property.x][property.y] &gt; 0 ){

 if( property.capturePoints === 20 ){
 view.showInfoMessage(
 model.data_localized("propertyCaptured")
 );
 } else {
 view.showInfoMessage(
 model.data_localized("propertyPointsLeft")+" "+property.capturePoints
 );
 }
 }
 },

 render: function(){},
 update: function(){},

 isDone: function(){
 return !view.hasInfoMessage();
 }

 });
 */
/*
 view.registerAnimationHook({

 key: "weather_change",

 prepare: function( wth ){
 view.showInfoMessage( model.data_localized("weatherChange")+" "+model.data_localized( wth ) );
 },

 render: function(){},
 update: function(){},

 isDone: function(){
 return !view.hasInfoMessage();
 }

 });
 */
/*
 view.registerAnimationHook({

 key: "destroyUnit",

 prepare: function( id ){
 var unit = model.unit_data[ id ];

 this.step = 0;
 this.time = 0;

 this.x = -unit.x;
 this.y = -unit.y;

 controller.audio_playSound("EXPLODE");
 },

 render: function(){
 var step = this.step;

 var pic = view.getInfoImageForType("EXPLOSION_GROUND");

 var x = this.x;
 var y = this.y;

 var tileSize = TILE_LENGTH;
 var scx = 48*step;
 var scy = 0;
 var scw = 48;
 var sch = 48;
 var tcx = (x)*tileSize;
 var tcy = (y)*tileSize;
 var tcw = tileSize;
 var tch = tileSize;

 view.canvasCtx.drawImage(
 pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );

 view.redraw_markPos(x,y);
 },

 update: function( delta ){
 this.time += delta;
 if( this.time &gt; 75 ){
 this.step++;
 this.time = 0;
 }
 },

 isDone: function(){
 return this.step === 10;
 }

 });
 */
/*
 view.registerAnimationHook({

 key: "move_moveByCache",

 prepare: function( uid, x,y ){

 this.moveAnimationX     = x;
 this.moveAnimationY     = y;
 this.moveAnimationIndex = 0;
 this.moveAnimationPath  = model.move_pathCache;
 this.moveAnimationUid   = uid;
 this.moveAnimationClientOwned = model.fog_visibleClientPids[
 model.unit_data[ uid ].owner ];
 this.moveAnimationShift = 0;

 this.moveAnimationDustX = -1;
 this.moveAnimationDustY = -1;
 this.moveAnimationDustTime = -1;
 this.moveAnimationDustStep = -1;
 this.moveAnimationDustPic = null;

 view.preventRenderUnit = model.unit_data[ uid ];
 var mvType = model.unit_data[ uid ].type.movetype;

 if( this.DEBUG ){
 util.log(
 "drawing move from",
 "(",this.moveAnimationX,",",this.moveAnimationY,")",
 "with path",
 "(",this.moveAnimationPath,")"
 );
 }
 },

 update: function( delta ){
 var tileSize = TILE_LENGTH;</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>MOVE 4 TILES / SECOND</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">this</span>.moveAnimationShift += ( delta/<span class="hljs-number">1000</span> ) * ( tileSize*<span class="hljs-number">8</span>);

 view.redraw_markPosWithNeighboursRing(
 <span class="hljs-keyword">this</span>.moveAnimationX, <span class="hljs-keyword">this</span>.moveAnimationY
 );</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>DUST</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.moveAnimationDustStep !== -<span class="hljs-number">1</span> ){

 <span class="hljs-keyword">this</span>.moveAnimationDustTime += delta;
 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.moveAnimationDustTime &gt; <span class="hljs-number">30</span> ){

 <span class="hljs-keyword">this</span>.moveAnimationDustStep++;
 <span class="hljs-keyword">this</span>.moveAnimationDustTime = <span class="hljs-number">0</span>;

 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.moveAnimationDustStep === <span class="hljs-number">3</span> ){
 <span class="hljs-keyword">this</span>.moveAnimationDustStep = -<span class="hljs-number">1</span>;
 }
 }
 }

 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.moveAnimationShift &gt; tileSize ){

 <span class="hljs-keyword">this</span>.moveAnimationDustX = <span class="hljs-keyword">this</span>.moveAnimationX;
 <span class="hljs-keyword">this</span>.moveAnimationDustY = <span class="hljs-keyword">this</span>.moveAnimationY;
 <span class="hljs-keyword">this</span>.moveAnimationDustTime = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.moveAnimationDustStep = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>UPDATE ANIMATION POS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">switch</span>( <span class="hljs-keyword">this</span>.moveAnimationPath[ <span class="hljs-keyword">this</span>.moveAnimationIndex ] ){

 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.UP :
 <span class="hljs-keyword">this</span>.moveAnimationY--;
 <span class="hljs-keyword">this</span>.moveAnimationDustPic = view.getInfoImageForType(<span class="hljs-string">"DUST_U"</span>);
 <span class="hljs-keyword">break</span>;

 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.RIGHT :
 <span class="hljs-keyword">this</span>.moveAnimationX++;
 <span class="hljs-keyword">this</span>.moveAnimationDustPic = view.getInfoImageForType(<span class="hljs-string">"DUST_R"</span>);
 <span class="hljs-keyword">break</span>;

 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.DOWN :
 <span class="hljs-keyword">this</span>.moveAnimationY++;
 <span class="hljs-keyword">this</span>.moveAnimationDustPic = view.getInfoImageForType(<span class="hljs-string">"DUST_D"</span>);
 <span class="hljs-keyword">break</span>;

 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.LEFT :
 <span class="hljs-keyword">this</span>.moveAnimationX--;
 <span class="hljs-keyword">this</span>.moveAnimationDustPic = view.getInfoImageForType(<span class="hljs-string">"DUST_L"</span>);
 <span class="hljs-keyword">break</span>;
 }

 <span class="hljs-keyword">this</span>.moveAnimationIndex++;

 <span class="hljs-keyword">this</span>.moveAnimationShift -= tileSize;</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>this.moveAnimationShift = 0;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
 <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.moveAnimationIndex === <span class="hljs-keyword">this</span>.moveAnimationPath.length ||
 <span class="hljs-keyword">this</span>.moveAnimationPath[<span class="hljs-keyword">this</span>.moveAnimationIndex] === cwt.INACTIVE ){
 <span class="hljs-keyword">this</span>.moveAnimationX     = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.moveAnimationY     = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.moveAnimationIndex = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">this</span>.moveAnimationPath  = <span class="hljs-literal">null</span>;
 <span class="hljs-keyword">this</span>.moveAnimationUid   = -<span class="hljs-number">1</span>;
 <span class="hljs-keyword">this</span>.moveAnimationShift = <span class="hljs-number">0</span>;
 view.preventRenderUnit = <span class="hljs-literal">null</span>; <span class="hljs-comment">// RENDER UNIT NOW NORMALLY</span>
 }
 }
 },

 render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
 <span class="hljs-keyword">var</span> uid      = <span class="hljs-keyword">this</span>.moveAnimationUid;
 <span class="hljs-keyword">var</span> cx       = <span class="hljs-keyword">this</span>.moveAnimationX;
 <span class="hljs-keyword">var</span> cy       = <span class="hljs-keyword">this</span>.moveAnimationY;
 <span class="hljs-keyword">var</span> shift    = <span class="hljs-keyword">this</span>.moveAnimationShift;
 <span class="hljs-keyword">var</span> moveCode = <span class="hljs-keyword">this</span>.moveAnimationPath[ <span class="hljs-keyword">this</span>.moveAnimationIndex ];
 <span class="hljs-keyword">var</span> unit     = model.unit_data[ uid ];
 <span class="hljs-keyword">var</span> color = view.colorArray[ unit.owner ];
 <span class="hljs-keyword">var</span> state;
 <span class="hljs-keyword">var</span> tp = unit.type;</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>check_ visibility</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.moveAnimationClientOwned &amp;&amp; !model.fog_clientData[cx][cy] ){
 <span class="hljs-keyword">return</span>;
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>GET CORRECT IMAGE STATE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">switch</span>( moveCode ){
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.UP :    state = view.IMAGE_CODE_UP;    <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.RIGHT : state = view.IMAGE_CODE_RIGHT; <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.DOWN :  state = view.IMAGE_CODE_DOWN;  <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.LEFT :  state = view.IMAGE_CODE_LEFT;  <span class="hljs-keyword">break</span>;
 }

 <span class="hljs-keyword">var</span> pic = view.getUnitImageForType( tp.ID, state, color );

 <span class="hljs-keyword">var</span> tileSize = TILE_LENGTH;
 <span class="hljs-keyword">var</span> BASESIZE = controller.baseSize;
 <span class="hljs-keyword">var</span> scx = (BASESIZE*<span class="hljs-number">2</span>)*view.getSpriteStep(<span class="hljs-string">"UNIT"</span>);
 <span class="hljs-keyword">var</span> scy = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">var</span> scw = BASESIZE*<span class="hljs-number">2</span>;
 <span class="hljs-keyword">var</span> sch = BASESIZE*<span class="hljs-number">2</span>;
 <span class="hljs-keyword">var</span> tcx = ( cx )*tileSize -tileSize/<span class="hljs-number">2</span>; <span class="hljs-comment">// TODO</span>
 <span class="hljs-keyword">var</span> tcy = ( cy )*tileSize -tileSize/<span class="hljs-number">2</span>;
 <span class="hljs-keyword">var</span> tcw = tileSize+tileSize;
 <span class="hljs-keyword">var</span> tch = tileSize+tileSize;</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>ADD SHIFT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">switch</span>( moveCode ){
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.UP:    tcy -= shift; <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.LEFT:  tcx -= shift; <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.RIGHT: tcx += shift; <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.DOWN:  tcy += shift; <span class="hljs-keyword">break</span>;
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>DRAW IT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">if</span>( pic !== <span class="hljs-literal">undefined</span> ){
 view.canvasCtx.drawImage(
 pic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tcw
 );
 }
 <span class="hljs-keyword">else</span>{
 tcx = ( cx )*tileSize;
 tcy = ( cy )*tileSize;
 tcw = tileSize;
 tch = tileSize;</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>ADD SHIFT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">switch</span>( moveCode ){
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.UP:    tcy -= shift; <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.LEFT:  tcx -= shift; <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.RIGHT: tcx += shift; <span class="hljs-keyword">break</span>;
 <span class="hljs-keyword">case</span> model.move_MOVE_CODES.DOWN:  tcy += shift; <span class="hljs-keyword">break</span>;
 }

 view.canvasCtx.fillStyle=<span class="hljs-string">"rgb(255,0,0)"</span>;
 view.canvasCtx.fillRect(
 tcx,tcy,
 tcw,tch
 );
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>DUST</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> if( this.moveAnimationDustStep !== -1 ){

 var tileSize = TILE_LENGTH;
 scx = (BASESIZE*2)*this.moveAnimationDustStep;
 scy = 0;
 scw = BASESIZE*2;
 sch = BASESIZE*2;
 tcx = ( this.moveAnimationDustX )*tileSize -tileSize/2;
 tcy = ( this.moveAnimationDustY )*tileSize -tileSize/2;
 tcw = tileSize+tileSize;
 tch = tileSize+tileSize;

 view.canvasCtx.drawImage(
 this.moveAnimationDustPic,
 scx,scy,
 scw,sch,
 tcx,tcy,
 tcw,tch
 );
 }
 },

 isDone: function(){
 var done = (this.moveAnimationUid === -1);
 return done;
 }

 });

 */
/*
 view.registerAnimationHook({

 key:"trapwait_invoked",

 prepare: function( uid ){
 var unit = model.unit_data[ uid ];
 this.time = 0;
 this.xp = unit.x+1;
 this.yp = unit.y;
 this.x = (unit.x+1) * TILE_LENGTH;
 this.y = unit.y * TILE_LENGTH;
 },

 render: function(){
 var pic = view.getInfoImageForType("TRAPPED");
 view.canvasCtx.drawImage( pic, this.x, this.y );
 },

 update: function( delta ){
 this.time += delta;
 },

 isDone: function(){
 var res = this.time &gt; 1000;
 if( res ){
 var pic = view.getInfoImageForType("TRAPPED");
 var y = this.yp;
 for( var i=this.xp,e=i+( parseInt(pic.width/TILE_LENGTH,10) ); i&lt;=e; i++ ){
 view.redraw_markPos( i , y );
 }
 }
 return res;
 }

 });

 */</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>