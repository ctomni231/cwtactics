<!DOCTYPE html>

<html>
<head>
  <title>input.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="doc.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ai.html">
                  ai.js
                </a>
              
                
                <a class="source" href="base.html">
                  base.js
                </a>
              
                
                <a class="source" href="commands.html">
                  commands.js
                </a>
              
                
                <a class="source" href="controller.html">
                  controller.js
                </a>
              
                
                <a class="source" href="datatypes.html">
                  datatypes.js
                </a>
              
                
                <a class="source" href="dependencies.html">
                  dependencies.js
                </a>
              
                
                <a class="source" href="flow.html">
                  flow.js
                </a>
              
                
                <a class="source" href="input.html">
                  input.js
                </a>
              
                
                <a class="source" href="language.html">
                  language.js
                </a>
              
                
                <a class="source" href="loading.html">
                  loading.js
                </a>
              
                
                <a class="source" href="logic.html">
                  logic.js
                </a>
              
                
                <a class="source" href="model.html">
                  model.js
                </a>
              
                
                <a class="source" href="modification.html">
                  modification.js
                </a>
              
                
                <a class="source" href="renderer.html">
                  renderer.js
                </a>
              
                
                <a class="source" href="test.html">
                  test.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>input.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-comment">/**
 * Represents a given data set of an input call.
 *
 * @class
 */</span>
cwt.InputData = my.Class({
  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.resetStatus();
  },

  resetStatus: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.key = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.d1 = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.d2 = -<span class="hljs-number">1</span>;
  }
});

<span class="hljs-comment">/**
 *
 * @class
 */</span>
cwt.Input = {

  MAPPING_STORAGE_KEY: <span class="hljs-string">"__user_key_map__"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>all input command types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  TYPE_LEFT: <span class="hljs-number">1</span>,
  TYPE_RIGHT: <span class="hljs-number">2</span>,
  TYPE_UP: <span class="hljs-number">3</span>,
  TYPE_DOWN: <span class="hljs-number">4</span>,
  TYPE_ACTION: <span class="hljs-number">5</span>,
  TYPE_CANCEL: <span class="hljs-number">6</span>,
  TYPE_HOVER: <span class="hljs-number">7</span>,
  TYPE_SET_INPUT: <span class="hljs-number">8</span>,

  <span class="hljs-comment">/**
   * @type cwt.CircularBuffer&lt;cwt.InputData&gt;
   */</span>
  stack: <span class="hljs-keyword">new</span> cwt.CircularBuffer(<span class="hljs-number">10</span>),

  <span class="hljs-comment">/**
   * @type cwt.CircularBuffer&lt;cwt.InputData&gt;
   */</span>
  pool: <span class="hljs-keyword">new</span> cwt.CircularBuffer(<span class="hljs-number">10</span>),

  types: {},

  <span class="hljs-comment">/**
   * If true, then every user input will be blocked.
   */</span>
  blocked: <span class="hljs-literal">false</span>,

  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.Input.initialize = <span class="hljs-literal">null</span>;

    <span class="hljs-built_in">Object</span>.keys(cwt.Input.types).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(inp)</span> {</span>
      cwt.Input.types[inp].factory();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>create data holder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">while</span> (!<span class="hljs-keyword">this</span>.pool.isFull()) {
      <span class="hljs-keyword">this</span>.pool.push(<span class="hljs-keyword">new</span> cwt.InputData());
    }
  },

  <span class="hljs-comment">/**
   *
   */</span>
  requestBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.blocked = <span class="hljs-literal">true</span>;
  },

  <span class="hljs-comment">/**
   *
   */</span>
  releaseBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.blocked = <span class="hljs-literal">false</span>;
  },

  genericInput: <span class="hljs-literal">false</span>,

  <span class="hljs-comment">/**
   * Creates an input object. The factory function will be called directly after creating
   * the instance. Furthermore the created object will be inserted into cwt.Input as property
   * with the name given by the 'key' argument.
   *
   * @param key
   * @param factory
   */</span>
  create: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key, factory)</span> {</span>
    <span class="hljs-keyword">var</span> obj = {};
    obj.factory = factory;
    <span class="hljs-keyword">this</span>.types[key] = obj;
  },

  <span class="hljs-comment">/**
   * Pushes an input key into the input stack. The parameters d1 and d2 has to be integers.
   *
   * @param {number} key
   * @param {number=} d1
   * @param {number=} d2
   */</span>
  pushAction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key, d1, d2)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.blocked || <span class="hljs-keyword">this</span>.pool.isEmpty()) {
      <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>convert undefined and null data arguments to the inactive code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (d1 !== <span class="hljs-number">0</span> &amp;&amp; !d1) {
      d1 = cwt.INACTIVE;
    }
    <span class="hljs-keyword">if</span> (d2 !== <span class="hljs-number">0</span> &amp;&amp; !d2) {
      d2 = cwt.INACTIVE;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>push command into buffer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> cmd = <span class="hljs-keyword">this</span>.pool.popFirst();
    cmd.d1 = d1;
    cmd.d2 = d2;
    cmd.key = key;

    <span class="hljs-keyword">this</span>.stack.push(cmd);
  },

  <span class="hljs-comment">/**
   * Grabs an input key from the input stack. -1 if no key is in the stack.
   *
   * @returns {null|cwt.InputData}
   */</span>
  popAction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.stack.isEmpty()) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.stack.popFirst();
  },

  <span class="hljs-comment">/**
   * Saves the current active input mapping into the user storage.
   */</span>
  saveKeyMapping: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.Storage.generalStorage.set(
      <span class="hljs-keyword">this</span>.MAPPING_STORAGE_KEY,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>extract custom mapping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      {
        keyboard: <span class="hljs-keyword">this</span>.types.keyboard.MAPPING,
        gamePad: <span class="hljs-keyword">this</span>.types.gamePad.MAPPING
      },
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (cwt.DEBUG) {
          console.log(<span class="hljs-string">"successfully saved user input mapping"</span>);
        }
      }
    );
  },

  <span class="hljs-comment">/**
   * Loads the keyboard input mapping from the user storage. If no
   * user input setting will be found then the default mapping will
   * be used.
   *
   * @param cb
   */</span>
  loadKeyMapping: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(cb)</span> {</span>
    cwt.Storage.generalStorage.get(
      <span class="hljs-keyword">this</span>.MAPPING_STORAGE_KEY,
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> {</span>
        <span class="hljs-keyword">if</span> (obj &amp;&amp; obj.value) {
          <span class="hljs-keyword">if</span> (cwt.DEBUG) {
            console.log(<span class="hljs-string">"loading custom key configuration"</span>);
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>inject custom mapping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (obj.value.keyboard) {
            cwt.Input.types.keyboard.MAPPING = obj.value.keyboard;
          }
          <span class="hljs-keyword">if</span> (obj.value.gamePad) {
            cwt.Input.types.gamePad.MAPPING = obj.value.gamePad;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>call callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (cb) {
          cb(obj != <span class="hljs-literal">null</span>);
        }
      }
    );
  },

  <span class="hljs-comment">/**
   *
   * @param charCode
   * @return {String|null} Returns a string that represents the given keycode.
   */</span>
  codeToChar: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(charCode)</span> {</span>
    <span class="hljs-keyword">if</span> (charCode === -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">var</span> value = <span class="hljs-built_in">String</span>.fromCharCode(charCode);
    <span class="hljs-keyword">switch</span> (charCode) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
        value = <span class="hljs-string">"Mac"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:
        value = <span class="hljs-string">"Backspace"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:
        value = <span class="hljs-string">"Tab"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">13</span>:
        value = <span class="hljs-string">"Enter"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">16</span>:
        value = <span class="hljs-string">"Shift"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">17</span>:
        value = <span class="hljs-string">"CTRL"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">18</span>:
        value = <span class="hljs-string">"ALT"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">19</span>:
        value = <span class="hljs-string">"Pause/Break"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">20</span>:
        value = <span class="hljs-string">"Caps Lock"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">27</span>:
        value = <span class="hljs-string">"ESC"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">32</span>:
        value = <span class="hljs-string">"Space"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">33</span>:
        value = <span class="hljs-string">"Page Up"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">34</span>:
        value = <span class="hljs-string">"Page Down"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">35</span>:
        value = <span class="hljs-string">"End"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">36</span>:
        value = <span class="hljs-string">"Home"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">37</span>:
        value = <span class="hljs-string">"Arrow Left"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">38</span>:
        value = <span class="hljs-string">"Arrow Up"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">39</span>:
        value = <span class="hljs-string">"Arrow Right"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">40</span>:
        value = <span class="hljs-string">"Arrow Down"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">43</span>:
        value = <span class="hljs-string">"Plus"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">45</span>:
        value = <span class="hljs-string">"Insert"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">46</span>:
        value = <span class="hljs-string">"Delete"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">91</span>:
        value = <span class="hljs-string">"Left Window Key"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">92</span>:
        value = <span class="hljs-string">"Right Window Key"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">93</span>:
        value = <span class="hljs-string">"Select Key"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">96</span>:
        value = <span class="hljs-string">"Numpad 0"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">97</span>:
        value = <span class="hljs-string">"Numpad 1"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">98</span>:
        value = <span class="hljs-string">"Numpad 2"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">99</span>:
        value = <span class="hljs-string">"Numpad 3"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">100</span>:
        value = <span class="hljs-string">"Numpad 4"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">101</span>:
        value = <span class="hljs-string">"Numpad 5"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">102</span>:
        value = <span class="hljs-string">"Numpad 6"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">103</span>:
        value = <span class="hljs-string">"Numpad 7"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">104</span>:
        value = <span class="hljs-string">"Numpad 8"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">105</span>:
        value = <span class="hljs-string">"Numpad 9"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">106</span>:
        value = <span class="hljs-string">"*"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">107</span>:
        value = <span class="hljs-string">"+"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">109</span>:
        value = <span class="hljs-string">"-"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">110</span>:
        value = <span class="hljs-string">";"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">111</span>:
        value = <span class="hljs-string">"/"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">112</span>:
        value = <span class="hljs-string">"F1"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">113</span>:
        value = <span class="hljs-string">"F2"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">114</span>:
        value = <span class="hljs-string">"F3"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">115</span>:
        value = <span class="hljs-string">"F4"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">116</span>:
        value = <span class="hljs-string">"F5"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">117</span>:
        value = <span class="hljs-string">"F6"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">118</span>:
        value = <span class="hljs-string">"F7"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">119</span>:
        value = <span class="hljs-string">"F8"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">120</span>:
        value = <span class="hljs-string">"F9"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">121</span>:
        value = <span class="hljs-string">"F10"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">122</span>:
        value = <span class="hljs-string">"F11"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">123</span>:
        value = <span class="hljs-string">"F12"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">144</span>:
        value = <span class="hljs-string">"Num Lock"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">145</span>:
        value = <span class="hljs-string">"Scroll Lock"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">186</span>:
        value = <span class="hljs-string">";"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">187</span>:
        value = <span class="hljs-string">"="</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">188</span>:
        value = <span class="hljs-string">","</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">189</span>:
        value = <span class="hljs-string">"-"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">190</span>:
        value = <span class="hljs-string">"."</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">191</span>:
        value = <span class="hljs-string">"/"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">192</span>:
        value = <span class="hljs-string">"`"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">219</span>:
        value = <span class="hljs-string">"["</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">220</span>:
        value = <span class="hljs-string">"\\"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">221</span>:
        value = <span class="hljs-string">"]"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">222</span>:
        value = <span class="hljs-string">"'"</span>;
        <span class="hljs-keyword">break</span>;
    }

    <span class="hljs-keyword">return</span> value;
  }
};

cwt.Input.create(<span class="hljs-string">"gamePad"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>not supported ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!cwt.ClientFeatures.gamePad) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">var</span> prevTimestamps = [];
  <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

  that.MAPPING = {
    ACTION: <span class="hljs-number">0</span>,
    CANCEL: <span class="hljs-number">1</span>
  };

  <span class="hljs-keyword">this</span>.update = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> gamePads = navigator.webkitGetGamepads();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-number">4</span>; i &lt; e; i++) {
      <span class="hljs-keyword">var</span> gamePad = gamePads[i];
      <span class="hljs-keyword">if</span> (!gamePad) <span class="hljs-keyword">continue</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>check_ timestamp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (prevTimestamps[i] &amp;&amp; (gamePad.timestamp == prevTimestamps[i])) <span class="hljs-keyword">continue</span>;
      prevTimestamps[i] = gamePad.timestamp;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>in key mapping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (cwt.Input.genericInput) {
        <span class="hljs-keyword">if</span> (cwt.Gameflow.activeState.mode != <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">var</span> code = -<span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>grab key code of the pressed button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">0</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">1</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">2</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">3</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">3</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">4</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">4</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">5</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">5</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">6</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">6</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">7</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">7</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">8</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">8</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">9</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">9</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">10</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">10</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">11</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">11</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">12</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">12</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.elements[<span class="hljs-number">13</span>] === <span class="hljs-number">1</span>) code = <span class="hljs-number">13</span>;

        <span class="hljs-keyword">if</span> (code &gt; -<span class="hljs-number">1</span>) {
          cwt.Gameflow.activeState.genericInput(code);
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> key = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>try to extract key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (gamePad.buttons[that.MAPPING.ACTION] === <span class="hljs-number">1</span>) {
          key = cwt.Input.TYPE_ACTION;

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.buttons[that.MAPPING.CANCEL] === <span class="hljs-number">1</span>) {
          key = cwt.Input.TYPE_CANCEL;

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.axes[<span class="hljs-number">1</span>] &lt; -<span class="hljs-number">0.5</span>) {
          key = cwt.Input.TYPE_UP;

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.axes[<span class="hljs-number">1</span>] &gt; +<span class="hljs-number">0.5</span>) {
          key = cwt.Input.TYPE_DOWN;

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.axes[<span class="hljs-number">0</span>] &lt; -<span class="hljs-number">0.5</span>) {
          key = cwt.Input.TYPE_LEFT;

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gamePad.axes[<span class="hljs-number">0</span>] &gt; +<span class="hljs-number">0.5</span>) {
          key = cwt.Input.TYPE_RIGHT;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>invoke input event when a known key was pressed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (key) {
          cwt.Input.pushAction(key, cwt.INACTIVE, cwt.INACTIVE);
        }
      }
    }
  }
});
cwt.Input.create(<span class="hljs-string">"keyboard"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
  <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

  <span class="hljs-keyword">var</span> CONSOLE_TOGGLE_KEY = <span class="hljs-number">192</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>not supported ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!cwt.ClientFeatures.keyboard) {
    <span class="hljs-keyword">return</span>;
  }

  that.MAPPING = {
    UP: <span class="hljs-number">38</span>,
    DOWN: <span class="hljs-number">40</span>,
    LEFT: <span class="hljs-number">37</span>,
    RIGHT: <span class="hljs-number">39</span>,
    ACTION: <span class="hljs-number">13</span>,
    CANCEL: <span class="hljs-number">8</span>
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>register key down listener</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  document.onkeydown = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev)</span> {</span>
    <span class="hljs-keyword">var</span> key = cwt.INACTIVE;

    <span class="hljs-keyword">if</span> (cwt.Input.genericInput) {
      <span class="hljs-keyword">if</span> (cwt.Gameflow.activeState.mode != <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span>;
      }

      cwt.Gameflow.activeState.genericInput(ev.keyCode);

    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>extract code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">switch</span> (ev.keyCode) {

        <span class="hljs-keyword">case</span> CONSOLE_TOGGLE_KEY:
          console.toggle();
          <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> that.MAPPING.LEFT:
          key = cwt.Input.TYPE_LEFT;
          <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> that.MAPPING.UP:
          key = cwt.Input.TYPE_UP;
          <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> that.MAPPING.RIGHT:
          key = cwt.Input.TYPE_RIGHT;
          <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> that.MAPPING.DOWN:
          key = cwt.Input.TYPE_DOWN;
          <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> that.MAPPING.CANCEL:
          key = cwt.Input.TYPE_CANCEL;
          <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> that.MAPPING.ACTION:
          key = cwt.Input.TYPE_ACTION;
          <span class="hljs-keyword">break</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>push key into input stack</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (key !== cwt.INACTIVE) {
        cwt.Input.pushAction(key, cwt.INACTIVE, cwt.INACTIVE);
      }
    }
  };
});
cwt.Input.create(<span class="hljs-string">"mouse"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>not supported ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!cwt.ClientFeatures.mouse) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">var</span> canvas = document.getElementById(<span class="hljs-string">"canvas_layer7"</span>);
  <span class="hljs-keyword">var</span> sx = <span class="hljs-number">1.0</span>;
  <span class="hljs-keyword">var</span> sy = <span class="hljs-number">1.0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>register move listener</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  canvas.onmousemove = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev)</span> {</span>
    <span class="hljs-keyword">var</span> id = ev.target.id;

    <span class="hljs-keyword">var</span> x, y;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>extract real x,y position on the canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ev = ev || window.event;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ev.offsetX === <span class="hljs-string">'number'</span>) {
      x = ev.offsetX;
      y = ev.offsetY;
    }
    <span class="hljs-keyword">else</span> {
      x = ev.layerX;
      y = ev.layerY;
    }

    <span class="hljs-keyword">var</span> cw = canvas.width;
    <span class="hljs-keyword">var</span> ch = canvas.height;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>get the scale based on actual width;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sx = cw / canvas.offsetWidth;
    sy = ch / canvas.offsetHeight;

    <span class="hljs-keyword">var</span> data = cwt.Gameflow.activeState.data;
    <span class="hljs-keyword">if</span> (data.inputMove) {
      data.inputMove(<span class="hljs-built_in">parseInt</span>(x*sx),<span class="hljs-built_in">parseInt</span>(y*sy));
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>convert to a tile position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/*
    x = cwt.Screen.offsetX + parseInt(x / cwt.Screen.TILE_BASE, 10);
    y = cwt.Screen.offsetY + parseInt(y / cwt.Screen.TILE_BASE, 10);

    if (x !== cwt.Cursor.x || y !== cwt.Cursor.y) {
      cwt.Input.pushAction(cwt.Input.TYPE_HOVER, x, y);
    }
    */</span>
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>register click listener</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  canvas.onmouseup = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev)</span> {</span>
    <span class="hljs-keyword">var</span> key = cwt.INACTIVE;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>click on canvas while menu is open -&gt; cancel always</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ev = ev || window.event;
    <span class="hljs-keyword">switch</span> (ev.which) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>LEFT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        key = cwt.Input.TYPE_ACTION;
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>MIDDLE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>RIGHT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        key = cwt.Input.TYPE_CANCEL;
        <span class="hljs-keyword">break</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>push command into the stack</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (key !== cwt.INACTIVE) {
      cwt.Input.pushAction(key, cwt.INACTIVE, cwt.INACTIVE);
    }
  };

});
cwt.Input.create(<span class="hljs-string">"touch"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>not supported ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!cwt.ClientFeatures.touch) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">var</span> input = <span class="hljs-keyword">this</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inSelection</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> state = cwt.Gameflow.activeStateId;
    <span class="hljs-keyword">return</span> (
      state === <span class="hljs-string">"INGAME_MOVEPATH"</span>
        || state === <span class="hljs-string">"INGAME_SELECT_TILE_TYPE_A"</span>
        || state === <span class="hljs-string">"INGAME_SELECT_TILE_TYPE_B"</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>|| controller.attackRangeVisible );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inMenu</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> state = cwt.Gameflow.activeStateId;
    <span class="hljs-keyword">return</span> (
      state === <span class="hljs-string">"INGAME_MENU"</span>
        || state === <span class="hljs-string">"INGAME_SUBMENU"</span> );
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Called when an one finger tap occur</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">oneFingerTap</span><span class="hljs-params">(event, x, y)</span> {</span>
    <span class="hljs-keyword">if</span> (input.disabled) <span class="hljs-keyword">return</span>;

    x = cwt.Screen.offsetX + <span class="hljs-built_in">parseInt</span>(x / cwt.Screen.TILE_BASE, <span class="hljs-number">10</span>);
    y = cwt.Screen.offsetY + <span class="hljs-built_in">parseInt</span>(y / cwt.Screen.TILE_BASE, <span class="hljs-number">10</span>);


    <span class="hljs-keyword">if</span> (!inMenu()) {
      <span class="hljs-keyword">if</span> (inSelection()) {
        <span class="hljs-keyword">if</span> (cwt.Gameflow.globalData.selection.getValue(x, y) &gt; <span class="hljs-number">0</span>) {
          cwt.Input.pushAction(cwt.Input.TYPE_ACTION, x, y);
        } <span class="hljs-keyword">else</span> {
          cwt.Input.pushAction(cwt.Input.TYPE_CANCEL, x, y);
        }
      } <span class="hljs-keyword">else</span> {
        cwt.Input.pushAction(cwt.Input.TYPE_ACTION, x, y);
      }

    } <span class="hljs-keyword">else</span> {


      <span class="hljs-keyword">if</span> (event.target.id === <span class="hljs-string">"cwt_menu"</span>) {
        cwt.Input.pushAction(cwt.Input.TYPE_ACTION, cwt.INACTIVE, cwt.INACTIVE);
      } <span class="hljs-keyword">else</span> {
        cwt.Input.pushAction(cwt.Input.TYPE_CANCEL, cwt.INACTIVE, cwt.INACTIVE);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Called when a two finger tap occur</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">twoFingerTap</span><span class="hljs-params">(event, x, y)</span> {</span>
    cwt.Input.pushAction(cwt.Input.TYPE_CANCEL, cwt.INACTIVE, cwt.INACTIVE);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Called when a swipe occur</p>
<p>if dx is not 0 then dy is 0
if dy is not 0 then dx is 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">swipe</span><span class="hljs-params">(event, dx, dy)</span> {</span>
    <span class="hljs-keyword">var</span> key = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (dx === <span class="hljs-number">1</span>) key = cwt.Input.TYPE_RIGHT;
    <span class="hljs-keyword">if</span> (dy === <span class="hljs-number">1</span>) key = cwt.Input.TYPE_DOWN;
    <span class="hljs-keyword">if</span> (dx === -<span class="hljs-number">1</span>) key = cwt.Input.TYPE_LEFT;
    <span class="hljs-keyword">if</span> (dy === -<span class="hljs-number">1</span>) key = cwt.Input.TYPE_UP;

    cwt.Input.pushAction(key, ( cwt.Gameflow.state === <span class="hljs-string">"GAME_ROUND"</span> ) ? <span class="hljs-number">10</span> : <span class="hljs-number">1</span>, cwt.INACTIVE);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Called when a drag occur. A drag happens when a one finger tap occurs
and wont be released for a longer time. The drag happens when the
finger moves into one direction during the hold.</p>
<p>if dx is not 0 then dy is 0
if dy is not 0 then dx is 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">oneFingerDrag</span><span class="hljs-params">(event, dx, dy)</span> {</span>
    <span class="hljs-keyword">if</span> (input.disabled) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">var</span> key = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (dx === <span class="hljs-number">1</span>) key = cwt.Input.TYPE_RIGHT;
    <span class="hljs-keyword">if</span> (dy === <span class="hljs-number">1</span>) key = cwt.Input.TYPE_DOWN;
    <span class="hljs-keyword">if</span> (dx === -<span class="hljs-number">1</span>) key = cwt.Input.TYPE_LEFT;
    <span class="hljs-keyword">if</span> (dy === -<span class="hljs-number">1</span>) key = cwt.Input.TYPE_UP;

    cwt.Input.pushAction(key, <span class="hljs-number">1</span>, cwt.INACTIVE);

    <span class="hljs-keyword">if</span> (!inMenu()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>ON THE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (event.target.id === <span class="hljs-string">"cwt_menu"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>INSIDE THE MENU
MOVE SELECTION IN DIRECTION OF DRAG</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>OUTSIDE THE MENU</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        cwt.Input.pushAction(cwt.Input.TYPE_CANCEL, cwt.INACTIVE, cwt.INACTIVE);
      }
    }

  }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Called when a one finger tap is invoked and released after
a longer time ( &gt;= 500ms )
the position of the finger is fixed in a hold ( at least the finger
does not really moved )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">holdOneFingerTap</span><span class="hljs-params">(event, x, y)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>OKAY FOR HOLD, this is tricky
Again separated for map and menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">if</span> (!inMenu()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>IF ATTACK RANGE VISIBLE IN RANGE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.Input.pushAction(cwt.Input.TYPE_ACTION, x, y);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p> OUTSIDE RANGE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.Input.pushAction(cwt.Input.TYPE_CANCEL, x, y);</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>IF ATTACK RANGE IS NOT  VISIBLE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.Input.pushAction(cwt.Input.TYPE_ACTION, x, y);

    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (event.target.id === <span class="hljs-string">"cwt_menu"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>WHEN HOLD HAPPENS IN THE MENU THEN
SLOWLY MOVE DOWN OR UP THROUGH
OPTIONS IN DIRECTION OF DRAG</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>WHEN TAP HAPPENS OUTSIDE THE MENU</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Called when the user pinches
delta is not 0 and
  delta &lt; 0 means pinch in
  delta &gt; 0 means pinch out</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pinch</span><span class="hljs-params">(event, delta)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>if (delta &lt; 0) controller.setScreenScale(controller.screenScale - 1);
else           controller.setScreenScale(controller.screenScale + 1);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>positions</p>
<ul>
<li>first finger</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> sx, sy;
  <span class="hljs-keyword">var</span> ex, ey;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <ul>
<li>second finger</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> s2x, s2y;
  <span class="hljs-keyword">var</span> e2x, e2y;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>timestamp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> st;</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>PINCH VARS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> pinDis, pinDis2;</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>DRAG VARS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> dragDiff = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> isDrag = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>TOUCH STARTS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  document.addEventListener(<span class="hljs-string">'touchstart'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> {</span>
    event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>SAVE POSITION AND CLEAR OLD DATA</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sx = event.touches[<span class="hljs-number">0</span>].clientX;
    sy = event.touches[<span class="hljs-number">0</span>].clientY;
    ex = sx;
    ey = sy;
    isDrag = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>IF A SECOND FINGER IS ON THE SCREEN THEN REMEMBER ITS POSITION</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (event.touches.length === <span class="hljs-number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>SAVE POSITION AND CLEAR OLD DATA</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      s2x = event.touches[<span class="hljs-number">1</span>].clientX;
      s2y = event.touches[<span class="hljs-number">1</span>].clientY;
      e2x = s2x;
      e2y = s2y;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>REMEMBER DISTANCE BETWEEN FIRST AND SECOND FINGER</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> dx = <span class="hljs-built_in">Math</span>.abs(sx - s2x);
      <span class="hljs-keyword">var</span> dy = <span class="hljs-built_in">Math</span>.abs(sy - s2y);
      pinDis = <span class="hljs-built_in">Math</span>.sqrt(dx * dx + dy * dy)

    } <span class="hljs-keyword">else</span> s2x = -<span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>REMEMBER TIME STAMP</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    st = event.timeStamp;
  }, <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>TOUCH MOVES</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  document.addEventListener(<span class="hljs-string">'touchmove'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> {</span>
    event.preventDefault();

    <span class="hljs-keyword">var</span> dx, dy;
    ex = event.touches[<span class="hljs-number">0</span>].clientX;
    ey = event.touches[<span class="hljs-number">0</span>].clientY;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>IF A SECOND FINGER IS ON THE SCREEN THEN REMEMBER ITS POSITION</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (event.touches.length === <span class="hljs-number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>SAVE POSITION</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      e2x = event.touches[<span class="hljs-number">1</span>].clientX;
      e2y = event.touches[<span class="hljs-number">1</span>].clientY;</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>REMEMBER NEW DISTANCE BETWEEN FIRST AND SECOND FINGER
TO BE ABLE TO CALCULATION A PINCH MOVE IF TOUCH END EVENT
WILL BE TRIGGERED</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      dx = <span class="hljs-built_in">Math</span>.abs(ex - e2x);
      dy = <span class="hljs-built_in">Math</span>.abs(ey - e2y);
      pinDis2 = <span class="hljs-built_in">Math</span>.sqrt(dx * dx + dy * dy)
    } <span class="hljs-keyword">else</span> s2x = -<span class="hljs-number">1</span>;

    dx = <span class="hljs-built_in">Math</span>.abs(sx - ex);
    dy = <span class="hljs-built_in">Math</span>.abs(sy - ey);
    <span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Math</span>.sqrt(dx * dx + dy * dy);
    <span class="hljs-keyword">var</span> timeDiff = event.timeStamp - st;

    <span class="hljs-keyword">if</span> (d &gt; <span class="hljs-number">16</span>) {

      <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">300</span>) {

        isDrag = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (dragDiff &gt; <span class="hljs-number">75</span>) {
          <span class="hljs-keyword">if</span> (dx &gt; dy) oneFingerDrag(event, (sx &gt; ex) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
          <span class="hljs-keyword">else</span>         oneFingerDrag(event, <span class="hljs-number">0</span>, (sy &gt; ey) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>);
          dragDiff = <span class="hljs-number">0</span>;
          sx = ex;
          sy = ey;
        } <span class="hljs-keyword">else</span> {
          dragDiff += timeDiff;
        }
      }
    }
  }, <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>TOUCH END</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  document.addEventListener(<span class="hljs-string">'touchend'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> {</span>
    event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>CALCULATE DISTANCE AND TIME GAP BETWEEN START AND END EVENT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> dx = <span class="hljs-built_in">Math</span>.abs(sx - ex);
    <span class="hljs-keyword">var</span> dy = <span class="hljs-built_in">Math</span>.abs(sy - ey);
    <span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Math</span>.sqrt(dx * dx + dy * dy);
    <span class="hljs-keyword">var</span> timeDiff = event.timeStamp - st;</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>IS IT A TWO PINCH GESTURE?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (s2x !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(pinDis2 - pinDis) &lt;= <span class="hljs-number">32</span>) {
        twoFingerTap(event, ex, ey);
      } <span class="hljs-keyword">else</span> pinch(event, (pinDis2 &lt; pinDis) ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>controller.inputCoolDown = 500;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (d &lt;= <span class="hljs-number">16</span>) {
        <span class="hljs-keyword">if</span> (timeDiff &lt;= <span class="hljs-number">500</span>) oneFingerTap(event, ex, ey);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (timeDiff &lt;= <span class="hljs-number">300</span>) {
        <span class="hljs-keyword">if</span> (dx &gt; dy) swipe(event, (sx &gt; ex) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">else</span>         swipe(event, <span class="hljs-number">0</span>, (sy &gt; ey) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>);
      }
    }

  }, <span class="hljs-literal">false</span>);

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>