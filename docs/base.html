<!DOCTYPE html>

<html>
<head>
  <title>base.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="doc.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ai.html">
                  ai.js
                </a>
              
                
                <a class="source" href="base.html">
                  base.js
                </a>
              
                
                <a class="source" href="commands.html">
                  commands.js
                </a>
              
                
                <a class="source" href="controller.html">
                  controller.js
                </a>
              
                
                <a class="source" href="datatypes.html">
                  datatypes.js
                </a>
              
                
                <a class="source" href="dependencies.html">
                  dependencies.js
                </a>
              
                
                <a class="source" href="flow.html">
                  flow.js
                </a>
              
                
                <a class="source" href="input.html">
                  input.js
                </a>
              
                
                <a class="source" href="loading.html">
                  loading.js
                </a>
              
                
                <a class="source" href="logic.html">
                  logic.js
                </a>
              
                
                <a class="source" href="model.html">
                  model.js
                </a>
              
                
                <a class="source" href="modification.html">
                  modification.js
                </a>
              
                
                <a class="source" href="renderer.html">
                  renderer.js
                </a>
              
                
                <a class="source" href="test.html">
                  test.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>base.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Defines the base package of the whole game here.
Everything part of the game will be defined as property
of this object. Normally the stuff of the game should
be defined as module in this root object.</p>
<p>Example for a module function:</p>
<blockquote>
<p>cwt.MyModule = { 
  a:function() { … } 
};</p>
<p>cwt.MyModule.a();</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>window.cwt = {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><strong>GAME_FONT (const)</strong> </p>
<p>Name of the font that will be used to render text.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  GAME_FONT: <span class="hljs-string">"Gamefont"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><strong>MOD_PATH (const)</strong> </p>
<p>URL of the active server where the game was downloaded from. 
This server will be used to grab the game data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  MOD_PATH: <span class="hljs-string">"http://localhost:8000/"</span>,
  <span class="hljs-comment">/* MOD_PATH: "http://192.168.1.30:8000/", */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><strong>TILE_BASE (const)</strong> </p>
<p>The size of a tile on the screen. Every screen interaction will
use that value to handle input mechanics and rendering. The graphic
must be in the same size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  TILE_BASE: <span class="hljs-number">16</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><strong>INACTIVE (const)</strong> </p>
<p>Represents a numeric code which means no data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  INACTIVE: -<span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>DESELECT_ID (const)</strong> </p>
<p>Represents a numeric code which means no data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  DESELECT_ID: -<span class="hljs-number">2</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>NOT_AVAILABLE (const)</strong> </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  NOT_AVAILABLE: -<span class="hljs-number">2</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>DEBUG: bool</strong> </p>
<p>Determines the debug mode. Can be changed at runtime to 
enable/disable runtime assertions and debug outputs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  DEBUG: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>SCREEN_WIDTH (const)</strong> </p>
<p>Screen width in tiles. The screen contains always only this given number 
of tiles in a row. If the screen is smaller or bigger than the tile base 
multiplized with this value, then the game screen will be scaled to fit 
the device screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  SCREEN_WIDTH: <span class="hljs-number">32</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>SCREEN_HEIGHT (const)</strong> </p>
<p>Screen height in tiles.</p>
<p>The screen contains always only this given number of tiles in a column.
If the screen is smaller or bigger than the tile base multiplized with 
this value, then the game screen will be scaled to fit the device screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  SCREEN_HEIGHT: <span class="hljs-number">24</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>MAX_MAP_WIDTH (const)</strong> </p>
<p>Maximum width of a map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  MAX_MAP_WIDTH: <span class="hljs-number">60</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>MAX_MAP_HEIGHT (const)</strong> </p>
<p>Maximum height of a map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  MAX_MAP_HEIGHT: <span class="hljs-number">40</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>MAX_MOVE_LENGTH (const)</strong> </p>
<p>Maximum range of a move action.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  MAX_MOVE_LENGTH: <span class="hljs-number">15</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>DEV_NO_CACHE (const)</strong> </p>
<p>The game won’t cache data when this variable is set to true.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  DEV_NO_CACHE: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><strong>emptyFunction (const)</strong> </p>
<p>Special static property that contains a fucntion with an empty body. 
This object can be used when a property with type function should be
disabled without having to modify other code that calls it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  emptyFunction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>},</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>doFunction(function): any</strong> </p>
<p>This function imediatly calls the given argument 
<em>fn</em> and returns the result of <em>fn</em> to the caller of this function. It 
realize the following javascript pattern:</p>
<blockquote>
<p>var my = (function(){
  return …;
})();</p>
</blockquote>
<p>With this function you can produce the same as above with the following
call:</p>
<blockquote>
<p>var my = cwt.doFunction(function(){
  return …;
});</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>  doFunction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fn)</span> {</span>
    <span class="hljs-keyword">return</span> fn();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>createModuleCaller(string): function</strong> </p>
<p>Creates a function that calls every function of a module in the cwt 
namespace which name is equal to the given event name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createModuleCaller: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(eventName)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> cwt) {
        <span class="hljs-keyword">var</span> module = cwt[prop];
        <span class="hljs-keyword">if</span> (module[eventName]) {
          module[eventName].apply(module, <span class="hljs-built_in">arguments</span>);
        }
      }
    };
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>assert(bool, string?)</strong> </p>
<p>Asserts that <em>expr</em> is true. If <em>expr</em> is false then an Error will be thrown.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  assert: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(expr, msgA)</span> {</span>
    <span class="hljs-keyword">if</span> (!expr) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> msgA === <span class="hljs-string">"undefined"</span>) {
        msgA = <span class="hljs-string">"FAIL"</span>;
      }

      <span class="hljs-keyword">if</span> (console.error) {
        console.error(msgA);
      }

      <span class="hljs-keyword">throw</span> msgA;
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>lazy(function): any</strong> </p>
<p>Calls a function lazy. This means the factory function 
<em>fn</em> will be called when the curried function <em>(returned value)</em> will be 
called the first time. The factory function needs to return the value
that should be returned by the curried function in future.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lazy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fn)</span> {</span>
    <span class="hljs-keyword">var</span> value = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) {
        value = fn();
      }

      <span class="hljs-keyword">return</span> value;
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>repeat(int, function): window.cwt</strong> </p>
<p>Repeats the given function <em>f</em> <em>n</em> times and returns the <em>cwt</em> object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  repeat: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n, f)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
      f.call(<span class="hljs-keyword">this</span>, i);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><strong>selectRandomListElement(array, any?): any</strong> </p>
<p>Selects a random element from the given <em>list</em>. It’s possible
to ship an argument <em>notWanted</em> which represents an element of <em>list</em> that 
will not selected randomly.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  selectRandomListElement: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(list, notWanted)</span> {</span>
    <span class="hljs-keyword">var</span> el;

    <span class="hljs-keyword">do</span> {
      <span class="hljs-keyword">var</span> index = <span class="hljs-built_in">parseInt</span>(<span class="hljs-built_in">Math</span>.random() * list.length, <span class="hljs-number">10</span>);
      el = list[index];
    }
    <span class="hljs-keyword">while</span> (el === notWanted);

    <span class="hljs-keyword">return</span> el;
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Registers a generic error listener which works in browser environments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>window.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, file, line, column, errorObj)</span> {</span>
  <span class="hljs-keyword">if</span> (cwt.Error) {
    <span class="hljs-comment">/* cwt.Error("Critical Game Fault","ERR_UNKNOWN"); */</span>
  }
  
  console.error(e, (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">0</span>) ? file + <span class="hljs-string">" line:"</span> + line : <span class="hljs-literal">null</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><strong>Class CircularBuffer</strong> </p>
<p>An implementation of the concept of a circular buffer.
Internally a circular buffer has a fixed size that makes the whole 
object very memory constant.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>cwt.CircularBuffer = my.Class({</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><strong>CircularBuffer(int?):</strong> </p>
<p>You can set <em>size</em> to set the maximum size of the buffer <em>(default is 32)</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(size)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span>) {
      size = <span class="hljs-number">32</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"size cannot be 0 or lower"</span>);
    }

    <span class="hljs-keyword">this</span>.index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.size = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.data = [];
    <span class="hljs-keyword">this</span>.maxSize = size;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>CircularBuffer.isEmpty(): bool</strong></p>
<p>true when no entries are in the buffer, else false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isEmpty: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.size === <span class="hljs-number">0</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><strong>CircularBuffer.isFull(): bool</strong></p>
<p>true when buffer is full, else false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isFull: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.size === <span class="hljs-keyword">this</span>.maxSize;
  },

  <span class="hljs-comment">/**
   * Returns an element at a given index. The element won't be returned.
   *
   * @param {number} index
   * @return {T}
   */</span>
  get: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span> || index &gt;= <span class="hljs-keyword">this</span>.size) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"illegal index"</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.data[(<span class="hljs-keyword">this</span>.index + index) % <span class="hljs-keyword">this</span>.maxSize];
  },

  <span class="hljs-comment">/**
   * Returns the oldest object from the buffer. The element will be removed from the buffer.
   *
   * @return {T} oldest object in the buffer
   */</span>
  popFirst: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.size === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"buffer is empty"</span>);
    }

    <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.data[<span class="hljs-keyword">this</span>.index];</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>remove entry to prevent memory leaks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.data[<span class="hljs-keyword">this</span>.index] = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">this</span>.size--;
    <span class="hljs-keyword">this</span>.index++;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.index === <span class="hljs-keyword">this</span>.maxSize) {
      <span class="hljs-keyword">this</span>.index = <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">return</span> obj;
  },

  <span class="hljs-comment">/**
   * Returns the youngest object from the buffer. The element will be removed from the buffer.
   *
   * @return {T} youngest object in the buffer
   */</span>
  popLast: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.size === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"buffer is empty"</span>);
    }

    <span class="hljs-keyword">var</span> index = (<span class="hljs-keyword">this</span>.index + <span class="hljs-keyword">this</span>.size - <span class="hljs-number">1</span>) % <span class="hljs-keyword">this</span>.maxSize;
    <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.data[index];</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>remove entry to prevent memory leaks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.data[index] = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.size--;

    <span class="hljs-keyword">return</span> obj;
  },

  <span class="hljs-comment">/**
   *
   * @param index
   * @param el
   * @return {T}
   */</span>
  set: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index, el)</span> {</span>
    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span> || index &gt;= <span class="hljs-keyword">this</span>.size) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"illegal index"</span>);
    }

    <span class="hljs-keyword">this</span>.data[(<span class="hljs-keyword">this</span>.index + index) % <span class="hljs-keyword">this</span>.maxSize] = el;
  },

  <span class="hljs-comment">/**
   * Pushes an object into the buffer.
   *
   * @param {T} el object that will be pushed into the buffer
   */</span>
  push: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.size === <span class="hljs-keyword">this</span>.maxSize) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"buffer is full"</span>);
    }

    <span class="hljs-keyword">this</span>.data[(<span class="hljs-keyword">this</span>.index + <span class="hljs-keyword">this</span>.size) % <span class="hljs-keyword">this</span>.maxSize] = el;
    <span class="hljs-keyword">this</span>.size++;
  },

  <span class="hljs-comment">/**
   * Removes everything from the buffer. After that the buffer will be empty.
   */</span>
  clear: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.size = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>remove references from list to prevent memory leaks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.data.length; i &lt; e; i++) {
      <span class="hljs-keyword">this</span>.data[i] = <span class="hljs-literal">null</span>;
    }
  }
});

<span class="hljs-comment">/**
 * Class that contains a static algorithm to register and return instances by a key. This class implements the multiton
 * pattern by a string based identifier. Usable by inheritance.
 *
 * @template T
 */</span>
cwt.IdMultiton = {

  <span class="hljs-comment">/**
   * @return {Array} Names that are registered in the multiton.
   */</span>
  getInstanceKeyList: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.classNames_;
  },

  <span class="hljs-comment">/**
   *
   * @param obj
   * @return {string}
   */</span>
  getInstanceKey: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(!!<span class="hljs-keyword">this</span>.classInstances_);
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(obj <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.classNames_.length; i &lt; e; i++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.classInstances_[<span class="hljs-keyword">this</span>.classNames_[i]] === obj) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.classNames_[i];
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param obj
   * @return {number}
   */</span>
  getInstanceId: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(!!<span class="hljs-keyword">this</span>.classInstances_);
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(obj <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.classNames_.length; i &lt; e; i++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.classInstances_[<span class="hljs-keyword">this</span>.classNames_[i]] === obj) {
        <span class="hljs-keyword">return</span> i;
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param {string} key
   * @param obj
   */</span>
  registerInstance: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(obj <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.classInstances_) {
      <span class="hljs-keyword">this</span>.classInstances_ = {};
      <span class="hljs-keyword">this</span>.classNames_ = [];
    }

    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(<span class="hljs-keyword">this</span>.MULTITON_NAMES.indexOf(key) != -<span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(!<span class="hljs-keyword">this</span>.classInstances_.hasOwnProperty(key));

    <span class="hljs-keyword">this</span>.classInstances_[key] = obj;
    <span class="hljs-keyword">this</span>.classNames_.push(key);
  },

  <span class="hljs-comment">/**
   * Returns an instance of the IdMultiton.
   *
   * @param {String} key
   * @return {T}
   */</span>
  getInstance: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>

    <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.classInstances_[key];</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>create instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!obj) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"key "</span> + key + <span class="hljs-string">" is not registered in the id multiton"</span>);
    }

    <span class="hljs-keyword">return</span> obj;
  },

  <span class="hljs-comment">/**
   * Returns an instance of the IdMultiton.
   *
   * @param {number} id
   * @return {T}
   */</span>
  getInstanceById: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id)</span> {</span>

    <span class="hljs-keyword">var</span> key = <span class="hljs-keyword">this</span>.classNames_[id];

    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(key);

    <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.classInstances_[key];</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>create instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!obj) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"key "</span> + key + <span class="hljs-string">" is not registered in the id multiton"</span>);
    }

    <span class="hljs-keyword">return</span> obj;
  }
};

<span class="hljs-comment">/**
 * Usable as super class to enable other classes to be used as
 * Multiton which allows to grab instances with Class.getInstance(id).
 * If the instance with the given id does not exists, then it will be
 * created.
 *
 * @template T
 */</span>
cwt.IndexMultiton = {

  <span class="hljs-comment">/**
   * Gets the id of a multiton object. This object must be an instance of this class.
   *
   * @param obj
   * @return {*}
   */</span>
  getInstanceId: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(!!<span class="hljs-keyword">this</span>.classInstances_);
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(obj <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.classInstances_.length; i &lt; e; i++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.classInstances_[i] === obj) <span class="hljs-keyword">return</span> i;
    }

    <span class="hljs-keyword">return</span> cwt.INACTIVE;
  },

  <span class="hljs-comment">/**
   * Returns an instance of the IndexMultiton.
   *
   * @param {Number} id
   * @param {Boolean=} nullReturn (optional)
   * @return {T}
   */</span>
  getInstance: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id, nullReturn)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> id !== <span class="hljs-string">"number"</span> || id &lt; <span class="hljs-number">0</span> || id &gt;= <span class="hljs-keyword">this</span>.MULTITON_INSTANCES) {
      <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"illegal id"</span>);
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.classInstances_ == <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.classInstances_ = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>prevent array holes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.MULTITON_INSTANCES; i &lt; e; i++) {
        <span class="hljs-keyword">this</span>.classInstances_[i] = <span class="hljs-literal">null</span>;
      }

    }

    <span class="hljs-keyword">var</span> l = <span class="hljs-keyword">this</span>.classInstances_;
    <span class="hljs-keyword">if</span> (!l[id]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>allow null as result for some calls (like turn start actions
checks all units -&gt; we won’t want to create all units then)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (nullReturn) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

      <span class="hljs-keyword">if</span> (cwt.DEBUG) {
        console.log(<span class="hljs-string">"creating instance for with id "</span> + id);
      }

      l[id] = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>();
    }

    <span class="hljs-keyword">return</span> l[id];
  }
};

<span class="hljs-comment">/**
 *
 * @class
 */</span>
cwt.Matrix = my.Class({

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(w, h, defaultValue)</span> {</span>
    <span class="hljs-keyword">if</span> (defaultValue === <span class="hljs-literal">undefined</span>) {
      defaultValue = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">this</span>.data = [];
    <span class="hljs-keyword">this</span>.defValue = defaultValue;
    <span class="hljs-keyword">this</span>.width = w;
    <span class="hljs-keyword">this</span>.height = h;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>CREATE SUB ARRAYS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; w; i++) {
      <span class="hljs-keyword">this</span>.data[i] = [];
    }

    <span class="hljs-keyword">this</span>.resetValues();
  },

  <span class="hljs-comment">/**
   *
   */</span>
  resetValues: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> defValue = <span class="hljs-keyword">this</span>.defValue;
    <span class="hljs-keyword">var</span> w = <span class="hljs-keyword">this</span>.width;
    <span class="hljs-keyword">var</span> h = <span class="hljs-keyword">this</span>.height;
    <span class="hljs-keyword">var</span> isFN = <span class="hljs-keyword">typeof</span> defValue === <span class="hljs-string">'function'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>COMPLEX ARRAY (MATRIX) OBJECT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = w; i &lt; e; i++) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, ej = h; j &lt; ej; j++) {
        <span class="hljs-keyword">if</span> (isFN) <span class="hljs-keyword">this</span>.data[i][j] = defValue(i, j, <span class="hljs-keyword">this</span>.data[i][j]);
        <span class="hljs-keyword">else</span>       <span class="hljs-keyword">this</span>.data[i][j] = defValue;
      }
    }
  },

  <span class="hljs-comment">/**
   *
   * @param {cwt.Matrix} matrix
   */</span>
  clone: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(matrix)</span> {</span>
    <span class="hljs-keyword">var</span> w = <span class="hljs-keyword">this</span>.width;
    <span class="hljs-keyword">var</span> h = <span class="hljs-keyword">this</span>.height;
    <span class="hljs-keyword">if</span> (matrix.data.length !== <span class="hljs-keyword">this</span>.data.length) <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>COMPLEX ARRAY (MATRIX) OBJECT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = w; i &lt; e; i++) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>, ej = h; j &lt; ej; j++) {
        matrix.data[i][j] = <span class="hljs-keyword">this</span>.data[i][j];
      }
    }
  }
});

<span class="hljs-comment">/**
 * @class
 */</span>
cwt.Config = my.Class(<span class="hljs-comment">/** @lends cwt.Config.prototype */</span> {

  STATIC: <span class="hljs-comment">/** @lends cwt.Config */</span> {

    MULTITON_NAMES: [
      <span class="hljs-string">"weatherMinDays"</span>,
      <span class="hljs-string">"weatherRandomDays"</span>,
      <span class="hljs-string">"round_dayLimit"</span>,
      <span class="hljs-string">"noUnitsLeftLoose"</span>,
      <span class="hljs-string">"autoSupplyAtTurnStart"</span>,
      <span class="hljs-string">"unitLimit"</span>,
      <span class="hljs-string">"captureLimit"</span>,
      <span class="hljs-string">"timer_turnTimeLimit"</span>,
      <span class="hljs-string">"timer_gameTimeLimit"</span>,
      <span class="hljs-string">"co_getStarCost"</span>,
      <span class="hljs-string">"co_getStarCostIncrease"</span>,
      <span class="hljs-string">"co_getStarCostIncreaseSteps"</span>,
      <span class="hljs-string">"co_enabledCoPower"</span>,
      <span class="hljs-string">"daysOfPeace"</span>,
      <span class="hljs-string">"fogEnabled"</span>
    ],

    <span class="hljs-comment">/**
     *
     */</span>
    resetAll: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-keyword">this</span>.MULTITON_NAMES.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
        <span class="hljs-keyword">this</span>.getInstance(<span class="hljs-keyword">this</span>.MULTITON_NAMES[i]).resetValue();
      }
    },

    <span class="hljs-comment">/**
     *
     * @param {String} name
     * @param {Number} min
     * @param {Number} max
     * @param {Number} defaultValue
     * @param {Number=} step
     */</span>
    create: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, min, max, defaultValue, step)</span> {</span>
      cwt.Config.registerInstance(name, <span class="hljs-keyword">new</span> cwt.Config(min, max, defaultValue, step));
    },

    <span class="hljs-comment">/**
     * Returns the actual configuration value of a given configuration
     * key.
     *
     * @param {String} name
     */</span>
    getValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getInstance(name).value;
    },

    <span class="hljs-comment">/**
     * Returns the actual configuration object of a given configuration
     * key.
     *
     * @param {String} name
     */</span>
    getConfig: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getInstance(name);
    },

    $onSaveGame: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
      data.cfg = {};
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.MULTITON_NAMES.length; i &lt; e; i++) {
        <span class="hljs-keyword">var</span> key = <span class="hljs-keyword">this</span>.MULTITON_NAMES[i];
        data.cfg[key] = cwt.Config.getValue(key);
      }
    },

    $onLoadGame: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, isSave)</span> {</span>
      cwt.Config.resetAll();
      <span class="hljs-keyword">if</span> (isSave &amp;&amp; data.cfg) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.MULTITON_NAMES.length; i &lt; e; i++) {
          <span class="hljs-keyword">var</span> key = <span class="hljs-keyword">this</span>.MULTITON_NAMES[i];
          <span class="hljs-keyword">if</span> (data.cfg[key]) {
            cwt.Config.getConfig(key).setValue(data.cfg[key]);
          }
        }
      }
    }
  },

  <span class="hljs-comment">/**
   * @param {Number} min
   * @param {Number} max
   * @param {Number} defaultValue
   * @param {Number=} step (default is 1)
   */</span>
  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(min, max, defaultValue, step)</span> {</span>
    <span class="hljs-keyword">this</span>.min = min;
    <span class="hljs-keyword">this</span>.max = max;
    <span class="hljs-keyword">this</span>.def = defaultValue;
    <span class="hljs-keyword">this</span>.step = (step !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) ? step : <span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.resetValue();
  },

  <span class="hljs-comment">/**
   *
   * @param {Number} value
   */</span>
  setValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>check_ bounds</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-keyword">this</span>.min) value = <span class="hljs-keyword">this</span>.min;
    <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-keyword">this</span>.max) value = <span class="hljs-keyword">this</span>.max;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>check_ steps</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((value - <span class="hljs-keyword">this</span>.min) % <span class="hljs-keyword">this</span>.step !== <span class="hljs-number">0</span>) {
      cwt.assert(<span class="hljs-literal">false</span>, <span class="hljs-string">"step criteria is broken"</span>);
    }

    <span class="hljs-keyword">this</span>.value = value;
  },

  decreaseValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.setValue(<span class="hljs-keyword">this</span>.value - <span class="hljs-keyword">this</span>.step);
  },

  increaseValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.setValue(<span class="hljs-keyword">this</span>.value + <span class="hljs-keyword">this</span>.step);
  },

  <span class="hljs-comment">/**
   * Resets the value of the parameter back to the default
   * value.
   */</span>
  resetValue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.value = <span class="hljs-keyword">this</span>.def;
  }

});
my.extendClass(cwt.Config, { STATIC: cwt.IdMultiton });

<span class="hljs-comment">/**
 *
 * @class
 */</span>
cwt.GameState = my.Class({
  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(enterFn, exitFn, updateFn, renderFn, data)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.data = data;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.exit = exitFn;
    <span class="hljs-keyword">this</span>.enter = enterFn;
    <span class="hljs-keyword">this</span>.update = updateFn;
    <span class="hljs-keyword">this</span>.render = renderFn;
  }
});

<span class="hljs-comment">/**
 * @interface
 * @template T
 */</span>
cwt.InterfaceMenu = {

  <span class="hljs-comment">/**
   * @return {number}
   */</span>
  getSelectedIndex: cwt.emptyFunction,

  <span class="hljs-comment">/**
   * @function
   * @param {number?} index
   * @return {T}
   */</span>
  getContent: cwt.emptyFunction,

  <span class="hljs-comment">/**
   * @function
   * @param {number?} index
   * @return {*}
   */</span>
  isEnabled: cwt.emptyFunction,

  <span class="hljs-comment">/**
   * @function
   * @return {number} number of entries in the menu
   */</span>
  getSize: cwt.emptyFunction,

  <span class="hljs-comment">/**
   *
   * @function
   */</span>
  clean: cwt.emptyFunction,

  <span class="hljs-comment">/**
   *
   * @function
   * @param {T} content
   * @param {boolean?} enabled
   */</span>
  addEntry: cwt.emptyFunction
};

<span class="hljs-comment">/**
 * @interface
 */</span>
cwt.InterfaceSelection = {

  <span class="hljs-comment">/**
   *
   * @function
   * @return {Array.&lt;Array&lt;number&gt;&gt;}
   */</span>
  getData: cwt.emptyFunction,

  <span class="hljs-comment">/**
   *
   * @function
   * @return {number}
   */</span>
  getCenterY: cwt.emptyFunction,

  <span class="hljs-comment">/**
   *
   * @function
   * @return {number}
   */</span>
  getCenterX: cwt.emptyFunction,

  <span class="hljs-comment">/**
   *
   * @function
   * @param {number} x
   * @param {number} y
   * @param {number} defValue
   */</span>
  setCenter: cwt.emptyFunction,

  <span class="hljs-comment">/**
   *
   * @function
   * @param {number} x
   * @param {number} y
   */</span>
  getValue: cwt.emptyFunction,

  <span class="hljs-comment">/**
   *
   * @function
   * @param {number} x
   * @param {number} y
   * @param {number} value
   */</span>
  setValue: cwt.emptyFunction
};

<span class="hljs-comment">/**
 *
 * @class
 */</span>
cwt.Layer = my.Class(<span class="hljs-comment">/** @lends cwt.Layer.prototype */</span> {

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(config)</span> {</span>
    <span class="hljs-keyword">this</span>.canvas = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.frames = [];
    <span class="hljs-keyword">this</span>.ctx = [];
    <span class="hljs-keyword">this</span>.cFrame = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.cTime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.frameLimit = config.time;

    <span class="hljs-keyword">this</span>.drawAll = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.draw = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>create canvas objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (n &lt; frames) {
      <span class="hljs-keyword">this</span>.canvas[n] = document.createElement(<span class="hljs-string">"canvas"</span>);
      <span class="hljs-keyword">this</span>.ctx[n] = <span class="hljs-keyword">this</span>.canvas[n].getContext(<span class="hljs-string">"2d"</span>);
      n++;
    }
  },

  renderFrame: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(frame)</span> {</span>
    <span class="hljs-keyword">var</span> curCanvas = <span class="hljs-keyword">this</span>.frames[frame];
    <span class="hljs-keyword">this</span>.canvas.getContext(<span class="hljs-string">"2d"</span>).drawImage(curCanvas, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, curCanvas.width, curCanvas.height);
  },

  <span class="hljs-comment">/**
   * Hides a layer.
   */</span>
  hide: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.canvas.style.display = <span class="hljs-string">"none"</span>;
  },

  <span class="hljs-comment">/**
   * Shows a layer.
   */</span>
  show: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.canvas.style.display = <span class="hljs-string">"block"</span>;
  },

  <span class="hljs-comment">/**
   * Returns the current active canvas of the layer.
   *
   * @return {HTMLCanvasElement}
   */</span>
  getActiveFrame: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.canvas[<span class="hljs-keyword">this</span>.cFrame];
  },

  <span class="hljs-comment">/**
   * Returns the rendering context for a given frame id.
   *
   * @param {number=} frame
   * @return {CanvasRenderingContext2D}
   */</span>
  getContext: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(frame)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span>) {
      frame = <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) cwt.assert(frame &gt;= <span class="hljs-number">0</span> &amp;&amp; frame &lt; <span class="hljs-keyword">this</span>.canvas.length);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.ctx[frame];
  },

  <span class="hljs-comment">/**
   * Updates the internal timer of the layer.
   *
   * @param delta
   */</span>
  update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> {</span>
    <span class="hljs-keyword">this</span>.cTime += delta;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>increase frame</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.cTime &gt;= <span class="hljs-keyword">this</span>.frameLimit) {
      <span class="hljs-keyword">this</span>.cTime = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">this</span>.cFrame++;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>reset frame</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.cFrame === <span class="hljs-keyword">this</span>.canvas.length) {
        <span class="hljs-keyword">this</span>.cFrame = <span class="hljs-number">0</span>;
      }
    }
  },

  <span class="hljs-comment">/**
   * Resets timer and frame counter.
   */</span>
  resetTimer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.cTime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.cFrame = <span class="hljs-number">0</span>;
  }

});

<span class="hljs-comment">/**
 *
 * @class
 */</span>
cwt.LayeredCanvas = my.Class({

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(canvasId, frames, w, h)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>root canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.cv = document.getElementById(canvasId);
    <span class="hljs-keyword">this</span>.cv.width = w;
    <span class="hljs-keyword">this</span>.cv.height = h;
    <span class="hljs-keyword">this</span>.ctx = <span class="hljs-keyword">this</span>.cv.getContext(<span class="hljs-string">"2d"</span>);
    <span class="hljs-keyword">this</span>.w = w;
    <span class="hljs-keyword">this</span>.h = h;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>cached layers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (frames &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.contexts = [];
      <span class="hljs-keyword">this</span>.layers = [];

      <span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">while</span> (n &lt; frames) {
        <span class="hljs-keyword">var</span> cv = document.createElement(<span class="hljs-string">"canvas"</span>);

        cv.width = w;
        cv.height = h;

        <span class="hljs-keyword">this</span>.contexts[n] = cv.getContext(<span class="hljs-string">"2d"</span>);
        <span class="hljs-keyword">this</span>.layers[n] = cv;

        n++;
      }
    }
  },

  <span class="hljs-comment">/**
   *
   * @param {Number} index
   */</span>
  renderLayer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span> || (index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.layers.length));

    <span class="hljs-keyword">var</span> ctx = <span class="hljs-keyword">this</span>.getContext();
    ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.w, <span class="hljs-keyword">this</span>.h);
    ctx.drawImage(<span class="hljs-keyword">this</span>.getLayer(index), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.w, <span class="hljs-keyword">this</span>.h);
  },

  <span class="hljs-comment">/**
   *
   * @param {Number?} index
   * @return {HTMLCanvasElement}
   */</span>
  getLayer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(index === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> || (index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.layers.length));</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>root ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (index === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cv;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.layers[index];
  },

  <span class="hljs-comment">/**
   *
   * @param {Number?} index
   */</span>
  clear: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
    <span class="hljs-keyword">this</span>.getContext(index).clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.w, <span class="hljs-keyword">this</span>.h);
  },

  <span class="hljs-comment">/**
   * Clears all background layers and the front layer.
   */</span>
  clearAll: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> n = <span class="hljs-keyword">this</span>.layers.length - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (n &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.clear(n);
      n--;
    }
  },

  <span class="hljs-comment">/**
   *
   * @param {Number?} index
   * @return {CanvasRenderingContext2D}
   */</span>
  getContext: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(index === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> || (index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.layers.length));</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>root ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (index === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.ctx;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.contexts[index];
  }
});

<span class="hljs-comment">/**
 * @class
 */</span>
cwt.Pagination = my.Class(<span class="hljs-comment">/** @lends cwt.Pagination.prototype */</span> {

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(list, pageSize, updateFn)</span> {</span>
    <span class="hljs-keyword">this</span>.page = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.list = list;
    <span class="hljs-keyword">this</span>.entries = [];
    <span class="hljs-keyword">while</span> (pageSize &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.entries.push(<span class="hljs-literal">null</span>);
      pageSize--;
    }
    <span class="hljs-keyword">this</span>.updateFn = updateFn;
  },

  <span class="hljs-comment">/**
   *
   * @param index
   */</span>
  selectPage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
    <span class="hljs-keyword">var</span> PAGE_SIZE = <span class="hljs-keyword">this</span>.entries.length;

    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span> || index * PAGE_SIZE &gt;= <span class="hljs-keyword">this</span>.list.length) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">this</span>.page = index;

    index = (index * PAGE_SIZE);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; PAGE_SIZE; n++) {
      <span class="hljs-keyword">this</span>.entries[n] = (index + n &gt;= <span class="hljs-keyword">this</span>.list.length) ? <span class="hljs-literal">null</span> : <span class="hljs-keyword">this</span>.list[index + n];
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.updateFn) {
      <span class="hljs-keyword">this</span>.updateFn();
    }
  }

});

<span class="hljs-comment">/**
 *
 */</span>
cwt.SheetDatabase = my.Class({

  <span class="hljs-comment">/**
   * Registers a sheet in the database.
   */</span>
  registerSheet: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sheet)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>validate it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cwt.assert(!<span class="hljs-keyword">this</span>.validator_.validate(<span class="hljs-string">"constr"</span>, sheet));</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>add it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.sheets[sheet.ID] = sheet;
    <span class="hljs-keyword">this</span>.types.push(sheet.ID);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.check_) {
      <span class="hljs-keyword">this</span>.check_(sheet);
    }
  },

  <span class="hljs-comment">/**
   *
   * @param sheet
   * @return {boolean}
   */</span>
  isValidSheet: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sheet)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.types.length; i &lt; e; i++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.sheets[<span class="hljs-keyword">this</span>.types[i]] === sheet) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  },

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(impl)</span> {</span>
    cwt.assert(impl);

    <span class="hljs-comment">/**
     *
     * @type {jjv}
     */</span>
    <span class="hljs-keyword">this</span>.validator_ = <span class="hljs-keyword">new</span> jjv();

    <span class="hljs-comment">/**
     * Holds all type sheet objects.
     *
     * @type {Object}
     */</span>
    <span class="hljs-keyword">this</span>.sheets = {};

    <span class="hljs-comment">/**
     * Holds all type names.
     *
     * @type {Array}
     */</span>
    <span class="hljs-keyword">this</span>.types = [];

    <span class="hljs-comment">/**
     *
     * @type {afterCheck}
     */</span>
    <span class="hljs-keyword">this</span>.check_ = impl.afterCheck;</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>register schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.validator_.addSchema(<span class="hljs-string">"constr"</span>, impl.schema);</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>add id check</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>.validator_.addCheck(<span class="hljs-string">'isID'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(v, p)</span> {</span>
      <span class="hljs-keyword">if</span> (p) {
        <span class="hljs-keyword">return</span> !that.sheets.hasOwnProperty(v);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>add custom checks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (impl.checks) {
      <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> impl.checks) {
        <span class="hljs-keyword">if</span> (impl.checks.hasOwnProperty(key)) {
          <span class="hljs-keyword">this</span>.validator_.addCheck(key, impl.checks[key]);
        }
      }
    }
  }
});

<span class="hljs-comment">/**
 *
 * @class
 */</span>
cwt.Sprite = my.Class(<span class="hljs-comment">/** @lends cwt.Sprite.prototype */</span> {

  STATIC: {

    <span class="hljs-comment">/** @constant */</span>
    MINIMAP_2x2: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    MINIMAP_4x4: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/** @constant */</span>
    UNIT_STATES: <span class="hljs-number">30</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_RED: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_BLUE: <span class="hljs-number">6</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_GREEN: <span class="hljs-number">12</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_YELLOW: <span class="hljs-number">18</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_SHADOW_MASK: <span class="hljs-number">24</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_STATE_IDLE: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_STATE_IDLE_INVERTED: <span class="hljs-number">1</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_STATE_LEFT: <span class="hljs-number">2</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_STATE_RIGHT: <span class="hljs-number">3</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_STATE_UP: <span class="hljs-number">4</span>,

    <span class="hljs-comment">/** @constant */</span>
    UNIT_STATE_DOWN: <span class="hljs-number">5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/** @constant */</span>
    TILE_STATES: <span class="hljs-number">2</span>,

    <span class="hljs-comment">/** @constant */</span>
    TILE_SHADOW: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/** @constant */</span>
    PROPERTY_STATES: <span class="hljs-number">6</span>,

    <span class="hljs-comment">/** @constant */</span>
    PROPERTY_RED: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    PROPERTY_BLUE: <span class="hljs-number">1</span>,

    <span class="hljs-comment">/** @constant */</span>
    PROPERTY_GREEN: <span class="hljs-number">2</span>,

    <span class="hljs-comment">/** @constant */</span>
    PROPERTY_YELLOW: <span class="hljs-number">3</span>,

    <span class="hljs-comment">/** @constant */</span>
    PROPERTY_NEUTRAL: <span class="hljs-number">4</span>,

    <span class="hljs-comment">/** @constant */</span>
    PROPERTY_SHADOW_MASK: <span class="hljs-number">5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_HP: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_AMMO: <span class="hljs-number">1</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_FUEL: <span class="hljs-number">2</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_LOAD: <span class="hljs-number">3</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_CAPTURE: <span class="hljs-number">4</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_ATT: <span class="hljs-number">5</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_VISION: <span class="hljs-number">6</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_MOVE: <span class="hljs-number">7</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_UNKNOWN: <span class="hljs-number">8</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_HIDDEN: <span class="hljs-number">9</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_DEFENSE: <span class="hljs-number">10</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_RANK_1: <span class="hljs-number">11</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_RANK_2: <span class="hljs-number">12</span>,

    <span class="hljs-comment">/** @constant */</span>
    SYMBOL_RANK_3: <span class="hljs-number">13</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_N: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_S: <span class="hljs-number">1</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_W: <span class="hljs-number">2</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_E: <span class="hljs-number">3</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_SW: <span class="hljs-number">4</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_SE: <span class="hljs-number">5</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_NW: <span class="hljs-number">6</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_NE: <span class="hljs-number">7</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_NS: <span class="hljs-number">8</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_WE: <span class="hljs-number">9</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_ALL: <span class="hljs-number">8</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_UP: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_DOWN: <span class="hljs-number">1</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_LEFT: <span class="hljs-number">2</span>,

    <span class="hljs-comment">/** @constant */</span>
    DIRECTION_RIGHT: <span class="hljs-number">3</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/** @constant */</span>
    FOCUS_MOVE: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    FOCUS_ATTACK: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/** @constant */</span>
    COLOR_MAP_PROPERTY: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    COLOR_MAP_UNIT: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/** @constant */</span>
    EXPLOSION_GROUND: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/** @constant */</span>
    EXPLOSION_AIR: <span class="hljs-number">1</span>,

    <span class="hljs-comment">/** @constant */</span>
    EXPLOSION_DUST: <span class="hljs-number">2</span>,

    <span class="hljs-comment">/** @constant */</span>
    EXPLOSION_SEA: <span class="hljs-number">3</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/**
     *
     * @param {cwt.Sprite} sprite
     * @return {string}
     */</span>
    toJSON: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sprite)</span> {</span>
      <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(sprite <span class="hljs-keyword">instanceof</span> cwt.Sprite);

      <span class="hljs-keyword">var</span> data = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = sprite.images.length; i &lt; e; i++) {
        data[i] = Base64Helper.canvasToBase64(sprite.images[i]);
      }

      <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(data);
    },

    <span class="hljs-comment">/**
     * Loads a sprite from the cache.
     *
     * @param spriteData
     * @return {cwt.Sprite}
     */</span>
    fromJSON: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(spriteData)</span> {</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> spriteData === <span class="hljs-string">"string"</span>) {
        spriteData = <span class="hljs-built_in">JSON</span>.parse(spriteData);
      }

      <span class="hljs-keyword">var</span> sprite = <span class="hljs-keyword">new</span> cwt.Sprite(spriteData.length);
      <span class="hljs-keyword">var</span> data = sprite.images;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = spriteData.length; i &lt; e; i++) {
        data[i] = Base64Helper.base64ToImage(spriteData[i]);
      }

      <span class="hljs-keyword">return</span> sprite;
    }
  },

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(indexes)</span> {</span>
    <span class="hljs-keyword">this</span>.images = [];

    <span class="hljs-keyword">while</span> (indexes &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.images.push(<span class="hljs-literal">null</span>);
      indexes--;
    }
  },

  <span class="hljs-comment">/**
   *
   * @return {Number}
   */</span>
  getNumberOfImages: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.images.length;
  },

  <span class="hljs-comment">/**
   *
   * @param {number} index
   * @param {HTMLImageElement|HTMLCanvasElement} image
   */</span>
  setImage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index, image)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.images.length);
    <span class="hljs-keyword">this</span>.images[index] = image;
  },

  <span class="hljs-comment">/**
   *
   * @param index
   * @return {HTMLImageElement|HTMLCanvasElement}
   */</span>
  getImage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.images[index];
  }
});

<span class="hljs-comment">/**
 *
 * @class
 */</span>
cwt.TileVariantInfo = my.Class(<span class="hljs-comment">/** @lends cwt.TileVariantInfo.prototype */</span> {

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(desc, connection)</span> {</span>
    <span class="hljs-keyword">this</span>.desc = desc;
    <span class="hljs-keyword">this</span>.connection = connection;
  },

  <span class="hljs-comment">/**
   *
   * @param type
   * @return {string}
   */</span>
  grabShortKey: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(type)</span> {</span>
    <span class="hljs-keyword">if</span> (type &amp;&amp; <span class="hljs-keyword">this</span>.desc[type]) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.desc[type];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
  },

  <span class="hljs-comment">/**
   * Returns the variant number in relation to a given set of neighbour types.
   *
   * @param {string} typeN
   * @param {string} typeE
   * @param {string} typeS
   * @param {string} typeW
   * @param {string?} typeNE
   * @param {string?} typeSE
   * @param {string?} typeSW
   * @param {string?} typeNW
   */</span>
  getVariant: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(typeN, typeE, typeS, typeW, typeNE, typeSE, typeSW, typeNW)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>grab shorts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    typeN = <span class="hljs-keyword">this</span>.grabShortKey(typeN);
    typeNE = <span class="hljs-keyword">this</span>.grabShortKey(typeNE);
    typeE = <span class="hljs-keyword">this</span>.grabShortKey(typeE);
    typeSE = <span class="hljs-keyword">this</span>.grabShortKey(typeSE);
    typeS = <span class="hljs-keyword">this</span>.grabShortKey(typeS);
    typeSW = <span class="hljs-keyword">this</span>.grabShortKey(typeSW);
    typeW = <span class="hljs-keyword">this</span>.grabShortKey(typeW);
    typeNW = <span class="hljs-keyword">this</span>.grabShortKey(typeNW);</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>search variant</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.connection.length; i &lt; e; i++) {
      <span class="hljs-keyword">var</span> cConn = <span class="hljs-keyword">this</span>.connection[i];
      <span class="hljs-keyword">if</span> (cConn.length === <span class="hljs-number">5</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>check_ plus</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">1</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">1</span>] !== typeN) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">2</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">2</span>] !== typeE) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">3</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">3</span>] !== typeS) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">4</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">4</span>] !== typeW) <span class="hljs-keyword">continue</span>;

      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>check_ cross</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">1</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">1</span>] !== typeN) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">2</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">2</span>] !== typeNE) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">3</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">3</span>] !== typeE) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">4</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">4</span>] !== typeSE) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">5</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">5</span>] !== typeS) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">6</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">6</span>] !== typeSW) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">7</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">7</span>] !== typeW) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (cConn[<span class="hljs-number">8</span>] !== <span class="hljs-string">""</span> &amp;&amp; cConn[<span class="hljs-number">8</span>] !== typeNW) <span class="hljs-keyword">continue</span>;
      }

      <span class="hljs-keyword">return</span> cConn[<span class="hljs-number">0</span>];
    }
  }
});

<span class="hljs-comment">/**
 * @class
 */</span>
cwt.UIButtonGroup = my.Class(<span class="hljs-comment">/** @lends cwt.UIButtonGroup.prototype */</span> {

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.elements = [];
    <span class="hljs-keyword">this</span>.selected = -<span class="hljs-number">1</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param {cwt.UIField} el
   */</span>
  addElement: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el)</span> {</span>
    <span class="hljs-keyword">this</span>.elements.push(el);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected === -<span class="hljs-number">1</span> &amp;&amp; el.action) {
      <span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.elements.length - <span class="hljs-number">1</span>].inFocus = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">this</span>.selected = <span class="hljs-keyword">this</span>.elements.length - <span class="hljs-number">1</span>;
    }
  },

  <span class="hljs-comment">/**
   * Returns the current active button.
   *
   * @return {cwt.UIField}
   */</span>
  activeButton: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected];
  },

  <span class="hljs-comment">/**
   * Returns a button by it's key.
   *
   * @param {String} key
   * @return {cwt.UIField}
   */</span>
  getButtonByKey: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.elements.length; i &lt; e; i++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.elements[i].key === key) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.elements[i];
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param {RegExp} reg
   */</span>
  getButtonsByReg: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(reg)</span> {</span>
    <span class="hljs-keyword">var</span> arr = [];

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.elements.length; i &lt; e; i++) {
      <span class="hljs-keyword">if</span> (reg.test(<span class="hljs-keyword">this</span>.elements[i].key)) {
        arr.push(<span class="hljs-keyword">this</span>.elements[i]);
      }
    }

    <span class="hljs-keyword">return</span> arr;
  },

  <span class="hljs-comment">/**
   * Updates the index of the selected button in interconnection to a given position.
   *
   * @param {Number} x
   * @param {Number} y
   * @return {boolean} true, if the index was updated, else false
   */</span>
  updateIndex: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.elements.length; i &lt; e; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>inactive element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.elements[i].action || <span class="hljs-keyword">this</span>.elements[i].inactive) {
        <span class="hljs-keyword">continue</span>;
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.elements[i].positionInButton(x, y)) {
        <span class="hljs-keyword">if</span> (i === <span class="hljs-keyword">this</span>.selected) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected].inFocus = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.selected = i;
        <span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected].inFocus = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param input
   * @return {boolean} true, if the index was updated, else false
   */</span>
  handleInput: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(input)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) cwt.assert(input !== <span class="hljs-literal">null</span>);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> input !== <span class="hljs-string">"number"</span>) {
      input = input.key;
    }

    <span class="hljs-keyword">var</span> res = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected].inFocus = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">switch</span> (input) {
      <span class="hljs-keyword">case</span> cwt.Input.TYPE_UP:
      <span class="hljs-keyword">case</span> cwt.Input.TYPE_LEFT:
        <span class="hljs-keyword">do</span> {
          <span class="hljs-keyword">this</span>.selected--;
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.selected = <span class="hljs-keyword">this</span>.elements.length - <span class="hljs-number">1</span>;
          }
        } <span class="hljs-keyword">while</span> (!<span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected].action || <span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected].inactive);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.Input.TYPE_RIGHT:
      <span class="hljs-keyword">case</span> cwt.Input.TYPE_DOWN:
        <span class="hljs-keyword">do</span> {
          <span class="hljs-keyword">this</span>.selected++;
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected &gt;= <span class="hljs-keyword">this</span>.elements.length) {
            <span class="hljs-keyword">this</span>.selected = <span class="hljs-number">0</span>;
          }
        } <span class="hljs-keyword">while</span> (!<span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected].action || <span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected].inactive);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">default</span> :
        res = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">this</span>.elements[<span class="hljs-keyword">this</span>.selected].inFocus = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">return</span> res;
  },

  <span class="hljs-comment">/**
   * Draws the screen layout into a given context of a canvas object.
   *
   * @param {CanvasRenderingContext2D} ctx
   */</span>
  draw: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ctx)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.elements.length; i &lt; e; i++) {
      <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>.elements[i];

      <span class="hljs-keyword">if</span> (!el.inactive) {
        el.draw(ctx);
      }
    }
  }
});

<span class="hljs-comment">/**
 *
 * @class
 * @extends {cwt.UIField}
 */</span>
cwt.UICheckboxField = my.Class(<span class="hljs-literal">null</span>, cwt.UIField, <span class="hljs-comment">/** @lends cwt.UICheckboxField.prototype */</span> {

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, w, h, text, fsize, style)</span> {</span>
    cwt.UIField.call(<span class="hljs-keyword">this</span>, x, y, w, h, text, fsize, style, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(button, state)</span> {</span>
      state.rendered = <span class="hljs-literal">false</span>;
      button.checked = !button.checked;
    });
    <span class="hljs-keyword">this</span>.text = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">this</span>.checked = <span class="hljs-literal">false</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param {CanvasRenderingContext2D} ctx
   */</span>
  draw: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ctx)</span> {</span>
    cwt.UIField.prototype.draw.call(<span class="hljs-keyword">this</span>, ctx);

    ctx.fillStyle = <span class="hljs-string">"black"</span>;
    ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">4</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">4</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">8</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">8</span>);

    ctx.fillStyle = (<span class="hljs-keyword">this</span>.checked) ? <span class="hljs-string">"rgb(60,60,60)"</span> : <span class="hljs-string">"white"</span>;
    ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">5</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">5</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">10</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">10</span>);
  }
});

<span class="hljs-comment">/**
 *
 * @class
 * @extends {cwt.UIField}
 */</span>
cwt.UICustomField = my.Class(<span class="hljs-literal">null</span>, cwt.UIField, <span class="hljs-comment">/** @lends cwt.UIField.prototype */</span> {

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, w, h, key, drawFn)</span> {</span>
    cwt.UIField.call(<span class="hljs-keyword">this</span>, x, y, w, h, key, <span class="hljs-number">0</span>, cwt.UIField.STYLE_NORMAL);
    <span class="hljs-keyword">this</span>.text = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">this</span>.draw = drawFn;
  }
});

<span class="hljs-comment">/**
 *
 * @class
 */</span>
cwt.UIField = my.Class(<span class="hljs-comment">/** @lends cwt.UIField.prototype */</span> {

  STATIC: {
    STYLE_NONE: -<span class="hljs-number">1</span>,
    STYLE_NORMAL: <span class="hljs-number">0</span>,
    STYLE_S: <span class="hljs-number">1</span>,
    STYLE_N: <span class="hljs-number">2</span>,
    STYLE_W: <span class="hljs-number">3</span>,
    STYLE_E: <span class="hljs-number">4</span>,
    STYLE_NE: <span class="hljs-number">5</span>,
    STYLE_NW: <span class="hljs-number">6</span>,
    STYLE_ES: <span class="hljs-number">7</span>,
    STYLE_SW: <span class="hljs-number">8</span>,
    STYLE_EW: <span class="hljs-number">13</span>,
    STYLE_NS: <span class="hljs-number">14</span>,
    STYLE_ESW: <span class="hljs-number">9</span>,
    STYLE_NEW: <span class="hljs-number">10</span>,
    STYLE_NSW: <span class="hljs-number">11</span>,
    STYLE_NES: <span class="hljs-number">12</span>
  },

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, w, h, text, fsize, style, actionFn)</span> {</span>
    <span class="hljs-keyword">this</span>.x = x;
    <span class="hljs-keyword">this</span>.y = y;
    <span class="hljs-keyword">this</span>.width = w;
    <span class="hljs-keyword">this</span>.height = h;
    <span class="hljs-keyword">this</span>.fsize = fsize;
    <span class="hljs-keyword">this</span>.style = style;
    <span class="hljs-keyword">this</span>.inFocus = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.action = actionFn;
    <span class="hljs-keyword">this</span>.inactive = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.key = text;
    <span class="hljs-keyword">this</span>.text = (text) ? cwt.Localization.forKey(text) : text;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.text.search(<span class="hljs-regexp">/\n/</span>) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">this</span>.text = <span class="hljs-keyword">this</span>.text.split(<span class="hljs-string">"\n"</span>);
    }
  },

  <span class="hljs-comment">/**
   *
   * @param x
   * @param y
   * @return {boolean}
   */</span>
  positionInButton: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y)</span> {</span>
    <span class="hljs-keyword">return</span> (x &gt;= <span class="hljs-keyword">this</span>.x &amp;&amp; x &lt; <span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width &amp;&amp; y &gt;= <span class="hljs-keyword">this</span>.y &amp;&amp; y &lt; <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height);
  },

  erase: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ctx)</span> {</span>
    ctx.clearRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y, <span class="hljs-keyword">this</span>.width, <span class="hljs-keyword">this</span>.height);
  },

  <span class="hljs-comment">/**
   *
   * @param {CanvasRenderingContext2D} ctx
   */</span>
  draw: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ctx)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.style === cwt.UIField.STYLE_NONE) {
      <span class="hljs-keyword">return</span>;
    }

    ctx.fillStyle = (<span class="hljs-keyword">this</span>.inFocus) ? <span class="hljs-string">"rgb(220,220,220)"</span> : <span class="hljs-string">"white"</span>;
    ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y, <span class="hljs-keyword">this</span>.width, <span class="hljs-keyword">this</span>.height);</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>draw borders</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ctx.fillStyle = <span class="hljs-string">"rgb(60,60,60)"</span>;
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.style) {

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_NORMAL :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">2</span>);
        ctx.fillStyle = (<span class="hljs-keyword">this</span>.inFocus) ? <span class="hljs-string">"rgb(220,220,220)"</span> : <span class="hljs-string">"white"</span>;
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">6</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">6</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_N :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.width, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_E :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.y, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_S :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.width, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_W :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_NE :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_NW :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.width, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_ES :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.y, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">1</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_SW :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_EW :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.y, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_NS :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.width, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.width, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_ESW :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.y, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">1</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_NEW :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">1</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_NSW :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">2</span>);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> cwt.UIField.STYLE_NES :
        ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.y + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.height - <span class="hljs-number">2</span>);
        ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height - <span class="hljs-number">3</span>, <span class="hljs-keyword">this</span>.width - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">break</span>;
    }

    ctx.fillStyle = <span class="hljs-string">"black"</span>;
    ctx.font = <span class="hljs-keyword">this</span>.fsize + <span class="hljs-string">"pt "</span> + cwt.GAME_FONT;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.text) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.text === <span class="hljs-string">"string"</span>) {
        <span class="hljs-keyword">var</span> tw = ctx.measureText(<span class="hljs-keyword">this</span>.text);
        ctx.fillText(
          <span class="hljs-keyword">this</span>.text,
          <span class="hljs-keyword">this</span>.x + (<span class="hljs-keyword">this</span>.width / <span class="hljs-number">2</span>) - (tw.width / <span class="hljs-number">2</span>),
          <span class="hljs-keyword">this</span>.y + (<span class="hljs-keyword">this</span>.height / <span class="hljs-number">2</span>) + <span class="hljs-keyword">this</span>.fsize / <span class="hljs-number">2</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.text.length; i &lt; e; i++) {
          <span class="hljs-keyword">var</span> tw = ctx.measureText(<span class="hljs-keyword">this</span>.text[i]);
          ctx.fillText(
            <span class="hljs-keyword">this</span>.text[i],
            <span class="hljs-keyword">this</span>.x + (<span class="hljs-keyword">this</span>.width / <span class="hljs-number">2</span>) - (tw.width / <span class="hljs-number">2</span>),
            <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.fsize + ((i + <span class="hljs-number">1</span>) * (<span class="hljs-keyword">this</span>.fsize + <span class="hljs-number">8</span>)));
        }
      }
    }
  }
});

cwt.LoadingBar = my.Class({

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, w, h)</span> {</span>
    <span class="hljs-keyword">this</span>.x = x;
    <span class="hljs-keyword">this</span>.y = y;
    <span class="hljs-keyword">this</span>.width = w;
    <span class="hljs-keyword">this</span>.height = h;
    <span class="hljs-keyword">this</span>.process = <span class="hljs-number">0</span>;
  },

  draw: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ctx)</span> {</span>
    ctx.fillStyle = <span class="hljs-string">"white"</span>;
    ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y, <span class="hljs-keyword">this</span>.width, <span class="hljs-keyword">this</span>.height);

    ctx.fillStyle = <span class="hljs-string">"blue"</span>;
    ctx.fillRect(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y, (<span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.width * (<span class="hljs-keyword">this</span>.process / <span class="hljs-number">100</span>), <span class="hljs-number">10</span>)), <span class="hljs-keyword">this</span>.height);
  },

  setPercentage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(p)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.DEBUG) {
      cwt.assert(p &gt;= <span class="hljs-number">0</span> &amp;&amp; p &lt;= <span class="hljs-number">100</span>);
    }

    <span class="hljs-keyword">this</span>.process = p;
  }
});

<span class="hljs-comment">/**
 * @class
 * @extends {cwt.UIButtonGroup}
 */</span>
cwt.UIPositionableButtonGroup = my.Class(<span class="hljs-literal">null</span>, cwt.UIButtonGroup, <span class="hljs-comment">/** @lends cwt.UIPositionableButtonGroup.prototype */</span> {

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    cwt.UIButtonGroup.call(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.y = <span class="hljs-number">0</span>;
  },

  setMenuPosition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y)</span> {</span>
    <span class="hljs-keyword">var</span> diffX = x - <span class="hljs-keyword">this</span>.x;
    <span class="hljs-keyword">var</span> diffY = y - <span class="hljs-keyword">this</span>.y;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.elements.length; i &lt; e; i++) {
      <span class="hljs-keyword">var</span> element = <span class="hljs-comment">/** @type {cwt.UIField} */</span> <span class="hljs-keyword">this</span>.elements[i];

      element.x += diffX;
      element.y += diffY;
    }

    <span class="hljs-keyword">this</span>.x = x;
    <span class="hljs-keyword">this</span>.y = y;
  }
});

<span class="hljs-comment">/**
 * A screen layout is a group out of ui elements. This elements can be interactive or non-interactive. It should
 * be used to create and define a screen layout. Furthermore the screen layout offers API to interact with the
 * components.
 *
 * @class
 * @extends {cwt.UIButtonGroup}
 */</span>
cwt.UIScreenLayout = my.Class(<span class="hljs-literal">null</span>, cwt.UIButtonGroup, <span class="hljs-comment">/** @lends cwt.UIScreenLayout.prototype */</span> {

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(slotsX, slotsY, startX, startY)</span> {</span>
    cwt.UIButtonGroup.call(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">this</span>.left = startX || <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.curX = startX || <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.curY = startY || <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.curH = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.breakLine();
  },

  <span class="hljs-comment">/**
   *
   * @param f
   */</span>
  repeat: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n, f)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
      f.call(<span class="hljs-keyword">this</span>, i);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param tiles
   */</span>
  addRowGap: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(tiles)</span> {</span>
    <span class="hljs-keyword">this</span>.curY += cwt.TILE_BASE * tiles;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param tiles
   */</span>
  addColGap: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(tiles)</span> {</span>
    <span class="hljs-keyword">this</span>.curX += cwt.TILE_BASE * tiles;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  <span class="hljs-comment">/**
   * Breaks the current line
   */</span>
  breakLine: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.curX = <span class="hljs-keyword">this</span>.left;
    <span class="hljs-keyword">this</span>.curY += <span class="hljs-keyword">this</span>.curH * cwt.TILE_BASE;
    <span class="hljs-keyword">this</span>.curH = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param {Number} tilesX
   * @param {Number} tilesY
   * @param {Number} offsetY
   * @param {Number} style
   * @param key
   * @param {Function?} action
   * @return {cwt.UIScreenLayout}
   */</span>
  addButton: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(tilesX, tilesY, offsetY, key, style, fSize, action)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">5</span>) {
      action = <span class="hljs-literal">null</span>;
      fSize = <span class="hljs-number">12</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">6</span> &amp;&amp; <span class="hljs-keyword">typeof</span> fSize === <span class="hljs-string">"function"</span>) {
      action = fSize;
      fSize = <span class="hljs-number">12</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.curH &lt; tilesY) {
      <span class="hljs-keyword">this</span>.curH = tilesY;
    }

    <span class="hljs-keyword">var</span> btn = <span class="hljs-keyword">new</span> cwt.UIField(
      <span class="hljs-keyword">this</span>.curX,
      <span class="hljs-keyword">this</span>.curY + (offsetY * cwt.TILE_BASE),
      tilesX * cwt.TILE_BASE,
      tilesY * cwt.TILE_BASE,
      key,
      fSize,
      style,
      action
    );

    <span class="hljs-keyword">this</span>.curX += tilesX * cwt.TILE_BASE;

    <span class="hljs-keyword">this</span>.addElement(btn);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param {Number} tilesX
   * @param {Number} tilesY
   * @param {Number} offsetY
   * @param key
   * @param {Function?} draw
   * @param {boolean?} ignoreHeight
   * @return {cwt.UIScreenLayout}
   */</span>
  addCustomField: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(tilesX, tilesY, offsetY, key, draw, ignoreHeight)</span> {</span>
    <span class="hljs-keyword">if</span> (ignoreHeight != <span class="hljs-literal">true</span> &amp;&amp; <span class="hljs-keyword">this</span>.curH &lt; tilesY) {
      <span class="hljs-keyword">this</span>.curH = tilesY;
    }

    <span class="hljs-keyword">var</span> btn = <span class="hljs-keyword">new</span> cwt.UICustomField(
      <span class="hljs-keyword">this</span>.curX,
      <span class="hljs-keyword">this</span>.curY + (offsetY * cwt.TILE_BASE),
      tilesX * cwt.TILE_BASE,
      tilesY * cwt.TILE_BASE,
      key,
      draw
    );

    <span class="hljs-keyword">this</span>.curX += tilesX * cwt.TILE_BASE;

    <span class="hljs-keyword">this</span>.addElement(btn);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  <span class="hljs-comment">/**
   *
   * @param {Number} tilesX
   * @param {Number} tilesY
   * @param {Number} offsetY
   * @param {Number} style
   * @param key
   * @return {cwt.UIScreenLayout}
   */</span>
  addCheckbox: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(tilesX, tilesY, offsetY, key, style, fSize)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">5</span>) {
      fSize = <span class="hljs-number">12</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">6</span> &amp;&amp; <span class="hljs-keyword">typeof</span> fSize === <span class="hljs-string">"function"</span>) {
      fSize = <span class="hljs-number">12</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.curH &lt; tilesY) {
      <span class="hljs-keyword">this</span>.curH = tilesY;
    }

    <span class="hljs-keyword">var</span> btn = <span class="hljs-keyword">new</span> cwt.UICheckboxField(
      <span class="hljs-keyword">this</span>.curX,
      <span class="hljs-keyword">this</span>.curY + (offsetY * cwt.TILE_BASE),
      tilesX * cwt.TILE_BASE,
      tilesY * cwt.TILE_BASE,
      key,
      fSize,
      style
    );

    <span class="hljs-keyword">this</span>.curX += tilesX * cwt.TILE_BASE;

    <span class="hljs-keyword">this</span>.addElement(btn);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>