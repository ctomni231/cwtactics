<!DOCTYPE html>

<html>
<head>
  <title>transport.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="attack.html">
                attack.js
              </a>
            
              
              <a class="source" href="cannon.html">
                cannon.js
              </a>
            
              
              <a class="source" href="capture.html">
                capture.js
              </a>
            
              
              <a class="source" href="co.html">
                co.js
              </a>
            
              
              <a class="source" href="exploder.html">
                exploder.js
              </a>
            
              
              <a class="source" href="factory.html">
                factory.js
              </a>
            
              
              <a class="source" href="fog.html">
                fog.js
              </a>
            
              
              <a class="source" href="join.html">
                join.js
              </a>
            
              
              <a class="source" href="laser.html">
                laser.js
              </a>
            
              
              <a class="source" href="lifecycle.html">
                lifecycle.js
              </a>
            
              
              <a class="source" href="move.html">
                move.js
              </a>
            
              
              <a class="source" href="relationship.html">
                relationship.js
              </a>
            
              
              <a class="source" href="silo.html">
                silo.js
              </a>
            
              
              <a class="source" href="supply.html">
                supply.js
              </a>
            
              
              <a class="source" href="team.html">
                team.js
              </a>
            
              
              <a class="source" href="transport.html">
                transport.js
              </a>
            
              
              <a class="source" href="turn.html">
                turn.js
              </a>
            
              
              <a class="source" href="weather.html">
                weather.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>transport.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-keyword">var</span> constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../constants"</span>);
<span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../functions"</span>).assert;
<span class="hljs-keyword">var</span> model = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../model"</span>);
<span class="hljs-keyword">var</span> move = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../logic/move"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Returns true if the unit with id tid is a transporter, else false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.isTransportUnit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(unit)</span> </span>{
  <span class="hljs-keyword">if</span> (constants.DEBUG) assert(unit <span class="hljs-keyword">instanceof</span> model.Unit);
  <span class="hljs-keyword">return</span> (unit.type.maxloads &gt; <span class="hljs-number">0</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Has a transporter unit with id tid loaded units? Returns true
if yes, else false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.hasLoads = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(unit)</span> </span>{
  <span class="hljs-keyword">if</span> (constants.DEBUG) assert(unit <span class="hljs-keyword">instanceof</span> model.Unit);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = model.units.length; i &lt; e; i++) {
    <span class="hljs-keyword">if</span> (unit.loadedIn === model.units[i]) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Returns true if a transporter with id tid can load the unit with the id lid.
This function also calculates the resulting weight if the transporter would
load the unit. If the calculated weight is greater than the maximum loadable
weight false will be returned.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.canLoadUnit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(transporter, load)</span> </span>{
  <span class="hljs-keyword">if</span> (constants.DEBUG) {
    assert(transporter <span class="hljs-keyword">instanceof</span> model.Unit);
    assert(load <span class="hljs-keyword">instanceof</span> model.Unit);
    assert(load !== transporter);
    assert(<span class="hljs-keyword">this</span>.isTransportUnit(transporter));
    assert(load.loadedIn !== transporter);
  }

  <span class="hljs-keyword">return</span> (transporter.type.canload.indexOf(load.type.movetype) !== -<span class="hljs-number">1</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Loads the unit with id lid into a transporter with the id tid.</p>
<p>@param {cwt.Unit} transporter
@param {cwt.Unit} load</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.load = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(transporter, load)</span> </span>{
  <span class="hljs-keyword">if</span> (constants.DEBUG) {
    assert(transporter <span class="hljs-keyword">instanceof</span> model.Unit);
    assert(load <span class="hljs-keyword">instanceof</span> model.Unit);
    assert(<span class="hljs-keyword">this</span>.isTransportUnit(transporter));
  }

  load.loadedIn = transporter;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Unloads the unit with id lid from a transporter with the id tid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.unload = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(transport, trsx, trsy, load, tx, ty)</span> </span>{
  <span class="hljs-keyword">if</span> (constants.DEBUG) assert(load.loadedIn === transport);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>TODO: remove this later
trapped ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (tx === -<span class="hljs-number">1</span> || ty === -<span class="hljs-number">1</span> || model.mapData[tx][ty].unit) {
    controller.stateMachine.data.breakMultiStep = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>remove transport link</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  load.loadedIn = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>extract mode code id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> moveCode;
  <span class="hljs-keyword">if</span> (tx &lt; trsx) moveCode = move.MOVE_CODES_LEFT;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tx &gt; trsx) moveCode = move.MOVE_CODES_RIGHT;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ty &lt; trsy) moveCode = move.MOVE_CODES_UP;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ty &gt; trsy) moveCode = move.MOVE_CODES_DOWN;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>move load out of the transporter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  move.movePathCache.clear();
  move.movePathCache.push(moveCode);
  move.move(unit, trsx, trsy, move.movePathCache, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);

  transport.canAct = <span class="hljs-literal">false</span>;
  load.canAct = <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Returns true if a transporter unit can unload one of itâ€™s loads at a given position.
This functions understands the given pos as possible position for the transporter.</p>
<p>@param {cwt.Unit} transporter
@param x
@param y
@return {*}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.canUnloadSomethingAt = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(transporter, x, y)</span> </span>{
  <span class="hljs-keyword">var</span> pid = transporter.owner;
  <span class="hljs-keyword">var</span> unit;

  <span class="hljs-keyword">if</span> (constants.DEBUG) assert(<span class="hljs-keyword">this</span>.isTransportUnit(transporter));
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = model.units.length; i &lt;= e; i++) {

    unit = move.units[i];
    <span class="hljs-keyword">if</span> (unit.loadedIn === transporter) {
      <span class="hljs-keyword">var</span> moveType = unit.type.movetype;

      <span class="hljs-keyword">if</span> (move.canTypeMoveTo(moveType, x - <span class="hljs-number">1</span>, y)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">if</span> (move.canTypeMoveTo(moveType, x + <span class="hljs-number">1</span>, y)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">if</span> (move.canTypeMoveTo(moveType, x, y - <span class="hljs-number">1</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">if</span> (move.canTypeMoveTo(moveType, x, y + <span class="hljs-number">1</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
